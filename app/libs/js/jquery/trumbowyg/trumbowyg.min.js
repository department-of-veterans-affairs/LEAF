/*
 MIT
 @author Alexandre Demode (Alex-D)
         Twitter : @AlexandreDemode
         Website : alex-d.fr
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,g,k){f!=Array.prototype&&f!=Object.prototype&&(f[g]=k.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var f=0;return function(g){return $jscomp.SYMBOL_PREFIX+(g||"")+f++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(f){var g=0;return $jscomp.iteratorPrototype(function(){return g<f.length?{done:!1,value:f[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,g){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var k=0,e={next:function(){if(k<f.length){var l=k++;return{value:g(l,f[l]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(f,g,k,e){if(g){k=$jscomp.global;f=f.split(".");for(e=0;e<f.length-1;e++){var l=f[e];l in k||(k[l]={});k=k[l]}f=f[f.length-1];e=k[f];g=g(e);g!=e&&null!=g&&$jscomp.defineProperty(k,f,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Array.prototype.keys",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(f){return f})}},"es6","es3");
$jscomp.findInternal=function(f,g,k){f instanceof String&&(f=String(f));for(var e=f.length,l=0;l<e;l++){var a=f[l];if(g.call(k,a,l,f))return{i:l,v:a}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(f){return f?f:function(f,k){return $jscomp.findInternal(this,f,k).v}},"es6","es3");
jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Stroke",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",
justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target",width:"Width"}},plugins:{},svgPath:null,hideButtonTexts:null};
Object.defineProperty(jQuery.trumbowyg,"defaultOptions",{value:{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,autogrowOnEnter:!1,imageWidthModalEdit:!1,prefix:"trumbowyg-",semantic:!0,resetCss:!1,removeformatPasted:!1,tagsToRemove:[],btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["insertImage"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"]],
btnsDef:{},inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],plugins:{}},writable:!1,enumerable:!0,configurable:!1});
(function(f,g,k,e){e.fn.trumbowyg=function(a,b){if(a===Object(a)||!a)return this.each(function(){e(this).data("trumbowyg")||e(this).data("trumbowyg",new l(this,a))});if(1===this.length)try{var c=e(this).data("trumbowyg");switch(a){case "execCmd":return c.execCmd(b.cmd,b.param,b.forceCss);case "openModal":return c.openModal(b.title,b.content);case "closeModal":return c.closeModal();case "openModalInsert":return c.openModalInsert(b.title,b.fields,b.callback);case "saveRange":return c.saveRange();case "getRange":return c.range;
case "getRangeText":return c.getRangeText();case "restoreRange":return c.restoreRange();case "enable":return c.setDisabled(!1);case "disable":return c.setDisabled(!0);case "toggle":return c.toggle();case "destroy":return c.destroy();case "empty":return c.empty();case "html":return c.html(b)}}catch(d){}return!1};var l=function(a,b){var c=this,d=e.trumbowyg;c.doc=a.ownerDocument||k;c.$ta=e(a);c.$c=e(a);b=b||{};c.lang=null!=b.lang||null!=d.langs[b.lang]?e.extend(!0,{},d.langs.en,d.langs[b.lang]):d.langs.en;
c.hideButtonTexts=null!=d.hideButtonTexts?d.hideButtonTexts:b.hideButtonTexts;var h=null!=d.svgPath?d.svgPath:b.svgPath;c.hasSvg=!1!==h;c.svgPath=c.doc.querySelector("base")?g.location.href.split("#")[0]:"";if(0===e("#trumbowyg-icons",c.doc).length&&!1!==h){if(null==h){for(var n=k.getElementsByTagName("script"),m=0;m<n.length;m+=1){var q=n[m].src,r=q.match("trumbowyg(.min)?.js");null!=r&&(h=q.substring(0,q.indexOf(r[0]))+"/ui/icons.svg")}null==h&&console.warn("You must define svgPath: https://goo.gl/CfTY9U")}var p=
c.doc.createElement("div");p.id="trumbowyg-icons";c.doc.body.insertBefore(p,c.doc.body.childNodes[0]);e.ajax({async:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"xml",crossDomain:!0,url:h,data:null,beforeSend:null,complete:null,success:function(a){p.innerHTML=(new XMLSerializer).serializeToString(a.documentElement)}})}h=c.lang.header;n=function(){return(g.chrome||g.Intl&&Intl.v8BreakIterator)&&"CSS"in g};c.btnsDef={viewHTML:{fn:"toggle"},undo:{isSupported:n,
key:"Z"},redo:{isSupported:n,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:h+" 1"},h2:{fn:"formatBlock",title:h+" 2"},h3:{fn:"formatBlock",title:h+" 3"},h4:{fn:"formatBlock",title:h+" 4"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},
justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:"p blockquote h1 h2 h3 h4".split(" "),ico:"p"},link:{dropdown:["createLink",
"unlink"]}};c.o=e.extend(!0,{},d.defaultOptions,b);c.o.hasOwnProperty("imgDblClickHandler")||(c.o.imgDblClickHandler=c.getDefaultImgDblClickHandler());c.disabled=c.o.disabled||"TEXTAREA"===a.nodeName&&a.disabled;b.btns?c.o.btns=b.btns:c.o.semantic||(c.o.btns[3]=["bold","italic","underline","strikethrough"]);e.each(c.o.btnsDef,function(a,b){c.addBtnDef(a,b)});c.eventNamespace="trumbowyg-event";c.keys=[];c.tagToButton={};c.tagHandlers=[];c.pasteHandlers=[].concat(c.o.pasteHandlers);c.isIE=-1!==f.userAgent.indexOf("MSIE")||
-1!==f.appVersion.indexOf("Trident/");c.init()};l.prototype={init:function(){var a=this;a.height=a.$ta.height();a.initPlugins();try{a.doc.execCommand("enableObjectResizing",!1,!1),a.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(b){}a.buildEditor();a.buildBtnPane();a.fixedBtnPaneEvents();a.buildOverlay();setTimeout(function(){a.disabled&&a.setDisabled(!0);a.$c.trigger("tbwinit")})},addBtnDef:function(a,b){this.btnsDef[a]=b},buildEditor:function(){var a=this,b=a.o.prefix,c="";a.$box=e("<div/>",
{class:b+"box "+b+"editor-visible "+b+a.o.lang+" trumbowyg"});a.isTextarea=a.$ta.is("textarea");a.isTextarea?(c=a.$ta.val(),a.$ed=e("<div/>"),a.$box.insertAfter(a.$ta).append(a.$ed,a.$ta)):(a.$ed=a.$ta,c=a.$ed.html(),a.$ta=e("<textarea/>",{name:a.$ta.attr("id"),height:a.height}).val(c),a.$box.insertAfter(a.$ed).append(a.$ta,a.$ed),a.syncCode());a.$ta.addClass(b+"textarea").attr("tabindex",-1);a.$ed.addClass(b+"editor").attr({contenteditable:!0,dir:a.lang._dir||"ltr"}).html(c);a.o.tabindex&&a.$ed.attr("tabindex",
a.o.tabindex);a.$c.is("[placeholder]")&&a.$ed.attr("placeholder",a.$c.attr("placeholder"));a.$c.is("[spellcheck]")&&a.$ed.attr("spellcheck",a.$c.attr("spellcheck"));a.o.resetCss&&a.$ed.addClass(b+"reset-css");a.o.autogrow||a.$ta.add(a.$ed).css({height:a.height});a.semanticCode();a.o.autogrowOnEnter&&a.$ed.addClass(b+"autogrow-on-enter");var d=!1,h=!1,f;c=a.isIE?"keyup":"input";a.$ed.on("dblclick","img",a.o.imgDblClickHandler).on("keydown",function(b){if((b.ctrlKey||b.metaKey)&&!b.altKey){d=!0;b=a.keys[String.fromCharCode(b.which).toUpperCase()];
try{return a.execCmd(b.fn,b.param),!1}catch(q){}}}).on("compositionstart compositionupdate",function(){h=!0}).on(c+" compositionend",function(b){if("compositionend"===b.type)h=!1;else if(h)return;var c=b.which;37<=c&&40>=c||(!b.ctrlKey&&!b.metaKey||89!==c&&90!==c?d||17===c?"undefined"===typeof b.which&&a.semanticCode(!1,!1,!0):(a.semanticCode(!1,"compositionend"===b.type&&13===c),a.$c.trigger("tbwchange")):a.$c.trigger("tbwchange"),setTimeout(function(){d=!1},200))}).on("mouseup keydown keyup",function(b){(!b.ctrlKey&&
!b.metaKey||b.altKey)&&setTimeout(function(){d=!1},200);clearTimeout(f);f=setTimeout(function(){a.updateButtonPaneStatus()},50)}).on("focus blur",function(c){a.$c.trigger("tbw"+c.type);"blur"===c.type&&e("."+b+"active-button",a.$btnPane).removeClass(b+"active-button "+b+"active");a.o.autogrowOnEnter&&!a.autogrowOnEnterDontClose&&("focus"===c.type?(a.autogrowOnEnterWasFocused=!0,a.autogrowEditorOnEnter()):a.o.autogrow||(a.$ed.css({height:a.$ed.css("min-height")}),a.$c.trigger("tbwresize")))}).on("cut",
function(){setTimeout(function(){a.semanticCode(!1,!0);a.$c.trigger("tbwchange")},0)}).on("paste",function(b){if(a.o.removeformatPasted){b.preventDefault();g.getSelection&&g.getSelection().deleteFromDocument&&g.getSelection().deleteFromDocument();try{var c=g.clipboardData.getData("Text");try{a.doc.selection.createRange().pasteHTML(c)}catch(r){a.doc.getSelection().getRangeAt(0).insertNode(a.doc.createTextNode(c))}a.$c.trigger("tbwchange",b)}catch(r){a.execCmd("insertText",(b.originalEvent||b).clipboardData.getData("text/plain"))}}e.each(a.pasteHandlers,
function(a,c){c(b)});setTimeout(function(){a.semanticCode(!1,!0);a.$c.trigger("tbwpaste",b)},0)});a.$ta.on("keyup",function(){a.$c.trigger("tbwchange")}).on("paste",function(){setTimeout(function(){a.$c.trigger("tbwchange")},0)});a.$box.on("keydown",function(c){if(27===c.which&&1===e("."+b+"modal-box",a.$box).length)return a.closeModal(),!1})},autogrowEditorOnEnter:function(){var a=this;a.$ed.removeClass("autogrow-on-enter");var b=a.$ed[0].clientHeight;a.$ed.height("auto");var c=a.$ed[0].scrollHeight;
a.$ed.addClass("autogrow-on-enter");b!==c&&(a.$ed.height(b),setTimeout(function(){a.$ed.css({height:c});a.$c.trigger("tbwresize")},0))},buildBtnPane:function(){var a=this,b=a.o.prefix,c=a.$btnPane=e("<div/>",{class:b+"button-pane"});e.each(a.o.btns,function(d,h){e.isArray(h)||(h=[h]);var f=e("<div/>",{class:b+"button-group "+(0<=h.indexOf("fullscreen")?b+"right":"")});e.each(h,function(b,c){try{a.isSupportedBtn(c)&&f.append(a.buildBtn(c))}catch(r){}});0<f.html().trim().length&&c.append(f)});a.$box.prepend(c)},
buildBtn:function(a){var b=this,c=b.o.prefix,d=b.btnsDef[a],h=d.dropdown,f=null!=d.hasIcon?d.hasIcon:!0,g=b.lang[a]||a;f=e("<button/>",{type:"button",class:c+a+"-button "+(d.class||"")+(f?"":" "+c+"textual-button"),html:b.hasSvg&&f?'<svg><use xlink:href="'+b.svgPath+"#"+c+(d.ico||a).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':b.hideButtonTexts?"":d.text||d.title||b.lang[a]||a,title:(d.title||d.text||g)+(d.key?" (Ctrl + "+d.key+")":""),tabindex:-1,mousedown:function(){h&&!e("."+a+"-"+c+"dropdown",
b.$box).is(":hidden")||e("body",b.doc).trigger("mousedown");if((b.$btnPane.hasClass(c+"disable")||b.$box.hasClass(c+"disabled"))&&!e(this).hasClass(c+"active")&&!e(this).hasClass(c+"not-disable"))return!1;b.execCmd((h?"dropdown":!1)||d.fn||a,d.param||a,d.forceCss);return!1}});if(h){f.addClass(c+"open-dropdown");g=c+"dropdown";var q={class:g+"-"+a+" "+g+" "+c+"fixed-top"};q["data-"+g]=a;var r=e("<div/>",q);e.each(h,function(a,c){b.btnsDef[c]&&b.isSupportedBtn(c)&&r.append(b.buildSubBtn(c))});b.$box.append(r.hide())}else d.key&&
(b.keys[d.key]={fn:d.fn||a,param:d.param||a});h||(b.tagToButton[(d.tag||a).toLowerCase()]=a);return f},buildSubBtn:function(a){var b=this,c=b.o.prefix,d=b.btnsDef[a],h=null!=d.hasIcon?d.hasIcon:!0;d.key&&(b.keys[d.key]={fn:d.fn||a,param:d.param||a});b.tagToButton[(d.tag||a).toLowerCase()]=a;return e("<button/>",{type:"button",class:c+a+"-dropdown-button"+(d.ico?" "+c+d.ico+"-button":""),html:b.hasSvg&&h?'<svg><use xlink:href="'+b.svgPath+"#"+c+(d.ico||a).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+
(d.text||d.title||b.lang[a]||a):d.text||d.title||b.lang[a]||a,title:d.key?" (Ctrl + "+d.key+")":null,style:d.style||null,mousedown:function(){e("body",b.doc).trigger("mousedown");b.execCmd(d.fn||a,d.param||a,d.forceCss);return!1}})},isSupportedBtn:function(a){try{return this.btnsDef[a].isSupported()}catch(b){}return!0},buildOverlay:function(){return this.$overlay=e("<div/>",{class:this.o.prefix+"overlay"}).appendTo(this.$box)},showOverlay:function(){e(g).trigger("scroll");this.$overlay.fadeIn(200);
this.$box.addClass(this.o.prefix+"box-blur")},hideOverlay:function(){this.$overlay.fadeOut(50);this.$box.removeClass(this.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var a=this,b=a.o.fixedFullWidth,c=a.$box;a.o.fixedBtnPane&&(a.isFixed=!1,e(g).on("scroll."+a.eventNamespace+" resize."+a.eventNamespace,function(){if(c){a.syncCode();var d=e(g).scrollTop(),h=c.offset().top+1,f=a.$btnPane,m=f.outerHeight()-2;0<d-h&&0>d-h-a.height?(a.isFixed||(a.isFixed=!0,f.css({position:"fixed",top:0,left:b?"0":
"auto",zIndex:7}),e([a.$ta,a.$ed]).css({marginTop:f.height()})),f.css({width:b?"100%":c.width()-1+"px"}),e("."+a.o.prefix+"fixed-top",c).css({position:b?"fixed":"absolute",top:b?m:m+(d-h)+"px",zIndex:15})):a.isFixed&&(a.isFixed=!1,f.removeAttr("style"),e([a.$ta,a.$ed]).css({marginTop:0}),e("."+a.o.prefix+"fixed-top",c).css({position:"absolute",top:m}))}}))},setDisabled:function(a){var b=this.o.prefix;(this.disabled=a)?this.$ta.attr("disabled",!0):this.$ta.removeAttr("disabled");this.$box.toggleClass(b+
"disabled",a);this.$ed.attr("contenteditable",!a)},destroy:function(){var a=this.o.prefix;this.isTextarea?this.$box.after(this.$ta.css({height:""}).val(this.html()).removeClass(a+"textarea").show()):this.$box.after(this.$ed.css({height:""}).removeClass(a+"editor").removeAttr("contenteditable").removeAttr("dir").html(this.html()).show());this.$ed.off("dblclick","img");this.destroyPlugins();this.$box.remove();this.$c.removeData("trumbowyg");e("body").removeClass(a+"body-fullscreen");this.$c.trigger("tbwclose");
e(g).off("scroll."+this.eventNamespace+" resize."+this.eventNamespace)},empty:function(){this.$ta.val("");this.syncCode(!0)},toggle:function(){var a=this,b=a.o.prefix;a.o.autogrowOnEnter&&(a.autogrowOnEnterDontClose=!a.$box.hasClass(b+"editor-hidden"));a.semanticCode(!1,!0);setTimeout(function(){a.doc.activeElement.blur();a.$box.toggleClass(b+"editor-hidden "+b+"editor-visible");a.$btnPane.toggleClass(b+"disable");e("."+b+"viewHTML-button",a.$btnPane).toggleClass(b+"active");a.$box.hasClass(b+"editor-visible")?
a.$ta.attr("tabindex",-1):a.$ta.removeAttr("tabindex");a.o.autogrowOnEnter&&!a.autogrowOnEnterDontClose&&a.autogrowEditorOnEnter()},0)},dropdown:function(a){var b=this,c=b.doc,d=b.o.prefix,f=e("[data-"+d+"dropdown="+a+"]",b.$box);a=e("."+d+a+"-button",b.$btnPane);var n=f.is(":hidden");e("body",c).trigger("mousedown");n&&(n=a.offset().left,a.addClass(d+"active"),f.css({position:"absolute",top:a.offset().top-b.$btnPane.offset().top+a.outerHeight(),left:b.o.fixedFullWidth&&b.isFixed?n+"px":n-b.$btnPane.offset().left+
"px"}).show(),e(g).trigger("scroll"),e("body",c).on("mousedown."+b.eventNamespace,function(a){f.is(a.target)||(e("."+d+"dropdown",c).hide(),e("."+d+"active",c).removeClass(d+"active"),e("body",c).off("mousedown."+b.eventNamespace))}))},html:function(a){return null!=a?(this.$ta.val(a),this.syncCode(!0),this):this.$ta.val()},syncTextarea:function(){this.$ta.val(0<this.$ed.text().trim().length||0<this.$ed.find("hr,img,embed,iframe,input").length?this.$ed.html():"")},syncCode:function(a){!a&&this.$ed.is(":visible")?
this.syncTextarea():(a=e("<div>").html(this.$ta.val()),a=e("<div>").append(a),e(this.o.tagsToRemove.join(","),a).remove(),this.$ed.html(a.contents().html()));this.o.autogrow&&(this.height=this.$ed.height(),this.height!==this.$ta.css("height")&&(this.$ta.css({height:this.height}),this.$c.trigger("tbwresize")));this.o.autogrowOnEnter&&(this.$ed.height("auto"),a=this.autogrowOnEnterWasFocused?this.$ed[0].scrollHeight:this.$ed.css("min-height"),a!==this.$ta.css("height")&&(this.$ed.css({height:a}),this.$c.trigger("tbwresize")))},
semanticCode:function(a,b,c){var d=this;d.saveRange();d.syncCode(a);if(d.o.semantic){d.semanticTag("b","strong");d.semanticTag("i","em");d.semanticTag("s","del");d.semanticTag("strike","del");if(b){var f=d.o.inlineElementsSelector,g=":not("+f+")";d.$ed.contents().filter(function(){return 3===this.nodeType&&0<this.nodeValue.trim().length}).wrap("<span data-tbw/>");var m=function(a){if(0!==a.length){a=a.nextUntil(g).addBack().wrapAll("<p/>").parent();var b=a.nextAll(f).first();a.next("br").remove();
m(b)}};m(d.$ed.children(f).first());d.semanticTag("div","p",!0);d.$ed.find("p").filter(function(){return d.range&&this===d.range.startContainer?!1:0===e(this).text().trim().length&&0===e(this).children().not("br,span").length}).contents().unwrap();e("[data-tbw]",d.$ed).contents().unwrap();d.$ed.find("p:empty").remove()}c||d.restoreRange();d.syncTextarea()}},semanticTag:function(a,b,c){e(a,this.$ed).each(function(){var a=e(this);a.wrap("<"+b+"/>");c&&e.each(a.prop("attributes"),function(){a.parent().attr(this.name,
this.value)});a.contents().unwrap()})},createLink:function(){for(var a=this,b=a.doc.getSelection(),c=b.focusNode,d;0>["A","DIV"].indexOf(c.nodeName);)c=c.parentNode;if(c&&"A"===c.nodeName){var f=e(c);d=f.attr("href");f.attr("title");f.attr("target");f=a.doc.createRange();f.selectNode(c);b.removeAllRanges();b.addRange(f)}a.saveRange();a.openModalInsert(a.lang.createLink,{url:{label:"URL",required:!0,value:d},text:{label:a.lang.text,value:(new XMLSerializer).serializeToString(b.getRangeAt(0).cloneContents())}},
function(b){b=e(['<a href="',b.url,'">',b.text,"</a>"].join(""));b.attr("target","_blank");a.range.deleteContents();a.range.insertNode(b[0]);a.syncCode();a.$c.trigger("tbwchange");return!0})},unlink:function(){var a=this.doc.getSelection(),b=a.focusNode;if(a.isCollapsed){for(;0>["A","DIV"].indexOf(b.nodeName);)b=b.parentNode;if(b&&"A"===b.nodeName){var c=this.doc.createRange();c.selectNode(b);a.removeAllRanges();a.addRange(c)}}this.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var a=
this;a.saveRange();var b={url:{label:"URL",required:!0},alt:{label:a.lang.description,value:a.getRangeText()}};a.o.imageWidthModalEdit&&(b.width={});a.openModalInsert(a.lang.insertImage,b,function(b){a.execCmd("insertImage",b.url);var c=e('img[src="'+b.url+'"]:not([alt])',a.$box);c.attr("alt",b.alt);a.o.imageWidthModalEdit&&c.attr({width:b.width});a.syncCode();a.$c.trigger("tbwchange");return!0})},fullscreen:function(){var a=this.o.prefix,b=a+"fullscreen";this.$box.toggleClass(b);b=this.$box.hasClass(b);
e("body").toggleClass(a+"body-fullscreen",b);e(g).trigger("scroll");this.$c.trigger("tbw"+(b?"open":"close")+"fullscreen")},execCmd:function(a,b,c,d){d=!!d||"";"dropdown"!==a&&this.$ed.focus();try{this.doc.execCommand("styleWithCSS",!1,c||!1)}catch(h){}try{this[a+d](b)}catch(h){try{a(b)}catch(n){"insertHorizontalRule"===a?b=void 0:"formatBlock"===a&&this.isIE&&(b="<"+b+">"),this.doc.execCommand(a,!1,b),this.syncCode(),this.semanticCode(!1,!0)}"dropdown"!==a&&(this.updateButtonPaneStatus(),this.$c.trigger("tbwchange"))}},
openModal:function(a,b){var c=this,d=c.o.prefix;if(0<e("."+d+"modal-box",c.$box).length)return!1;c.o.autogrowOnEnter&&(c.autogrowOnEnterDontClose=!0);c.saveRange();c.showOverlay();c.$btnPane.addClass(d+"disable");var f=e("<div/>",{class:d+"modal "+d+"fixed-top"}).css({top:c.$btnPane.height()}).appendTo(c.$box);c.$overlay.one("click",function(){f.trigger("tbwcancel");return!1});b=e("<form/>",{action:"",html:b}).on("submit",function(){f.trigger("tbwconfirm");return!1}).on("reset",function(){f.trigger("tbwcancel");
return!1}).on("submit reset",function(){c.o.autogrowOnEnter&&(c.autogrowOnEnterDontClose=!1)});b=e("<div/>",{class:d+"modal-box",html:b}).css({top:"-"+c.$btnPane.outerHeight()+"px",opacity:0}).appendTo(f).animate({top:0,opacity:1},100);e("<span/>",{text:a,class:d+"modal-title"}).prependTo(b);f.height(b.outerHeight()+10);e("input:first",b).focus();c.buildModalBtn("submit",b);c.buildModalBtn("reset",b);e(g).trigger("scroll");return f},buildModalBtn:function(a,b){var c=this.o.prefix;return e("<button/>",
{class:c+"modal-button "+c+"modal-"+a,type:a,text:this.lang[a]||a}).appendTo(e("form",b))},closeModal:function(){var a=this,b=a.o.prefix;a.$btnPane.removeClass(b+"disable");a.$overlay.off();var c=e("."+b+"modal-box",a.$box);c.animate({top:"-"+c.height()},100,function(){c.parent().remove();a.hideOverlay()});a.restoreRange()},openModalInsert:function(a,b,c){var d=this,f=d.o.prefix,g=d.lang,m="";e.each(b,function(a,b){var c=b.label,d=b.name||a,e=b.attributes||{},h=Object.keys(e).map(function(a){return a+
'="'+e[a]+'"'}).join(" ");m+='<label><input type="'+(b.type||"text")+'" name="'+d+'" value="'+(b.value||"").replace(/"/g,"&quot;")+'"'+h+'><span class="'+f+'input-infos"><span>'+(c?g[c]?g[c]:c:g[a]?g[a]:a)+"</span></span></label>"});return d.openModal(a,m).on("tbwconfirm",function(){var a=e("form",e(this)),f=!0,h={};e.each(b,function(b,c){var g=e('input[name="'+b+'"]',a);"checkbox"===g.attr("type").toLowerCase()?h[b]=g.is(":checked"):h[b]=e.trim(g.val());c.required&&""===h[b]?(f=!1,d.addErrorOnModalField(g,
d.lang.required)):c.pattern&&!c.pattern.test(h[b])&&(f=!1,d.addErrorOnModalField(g,c.patternError))});f&&(d.restoreRange(),c(h,b)&&(d.syncCode(),d.$c.trigger("tbwchange"),d.closeModal(),e(this).off("tbwconfirm")))}).one("tbwcancel",function(){e(this).off("tbwconfirm");d.closeModal()})},addErrorOnModalField:function(a,b){var c=this.o.prefix,d=a.parent();a.on("change keyup",function(){d.removeClass(c+"input-error")});d.addClass(c+"input-error").find("input+span").append(e("<span/>",{class:c+"msg-error",
text:b}))},getDefaultImgDblClickHandler:function(){var a=this;return function(){var b=e(this),c=b.attr("src");0===c.indexOf("data:image")&&(c="(Base64)");c={url:{label:"URL",value:c,required:!0},alt:{label:a.lang.description,value:b.attr("alt")}};a.o.imageWidthModalEdit&&(c.width={value:b.attr("width")?b.attr("width"):""});a.openModalInsert(a.lang.insertImage,c,function(c){"(Base64)"!==c.src&&b.attr({src:c.src});b.attr({alt:c.alt});a.o.imageWidthModalEdit&&(0<parseInt(c.width)?b.attr({width:c.width}):
b.removeAttr("width"));return!0});return!1}},saveRange:function(){var a=this.doc.getSelection();this.range=null;if(a.rangeCount){a=this.range=a.getRangeAt(0);var b=this.doc.createRange();b.selectNodeContents(this.$ed[0]);b.setEnd(a.startContainer,a.startOffset);b=(b+"").length;this.metaRange={start:b,end:b+(a+"").length}}},restoreRange:function(){var a=this.metaRange,b=this.range,c=this.doc.getSelection(),d;if(b){if(a&&a.start!==a.end){var e=0,f=[this.$ed[0]],g,k=!1,l=!1;for(d=this.doc.createRange();!l&&
(g=f.pop());)if(3===g.nodeType){var p=e+g.length;!k&&a.start>=e&&a.start<=p&&(d.setStart(g,a.start-e),k=!0);k&&a.end>=e&&a.end<=p&&(d.setEnd(g,a.end-e),l=!0);e=p}else{p=g.childNodes;for(var t=p.length;0<t;)--t,f.push(p[t])}}c.removeAllRanges();c.addRange(d||b)}},getRangeText:function(){return this.range+""},updateButtonPaneStatus:function(){var a=this,b=a.o.prefix,c=a.getTagsRecursive(a.doc.getSelection().focusNode),d=b+"active-button "+b+"active";e("."+b+"active-button",a.$btnPane).removeClass(d);
e.each(c,function(c,f){c=a.tagToButton[f.toLowerCase()];f=e("."+b+c+"-button",a.$btnPane);if(0<f.length)f.addClass(d);else try{f=e("."+b+"dropdown ."+b+c+"-dropdown-button",a.$box);var g=f.parent().data("dropdown");e("."+b+g+"-button",a.$box).addClass(d)}catch(q){}})},getTagsRecursive:function(a,b){var c=this;b=b||(a&&a.tagName?[a.tagName]:[]);if(a&&a.parentNode)a=a.parentNode;else return b;var d=a.tagName;if("DIV"===d)return b;"P"===d&&""!==a.style.textAlign&&b.push(a.style.textAlign);e.each(c.tagHandlers,
function(d,e){b=b.concat(e(a,c))});b.push(d);return c.getTagsRecursive(a,b).filter(function(a){return null!=a})},initPlugins:function(){var a=this;a.loadedPlugins=[];e.each(e.trumbowyg.plugins,function(b,c){if(!c.shouldInit||c.shouldInit(a))c.init(a),c.tagHandler&&a.tagHandlers.push(c.tagHandler),a.loadedPlugins.push(c)})},destroyPlugins:function(){e.each(this.loadedPlugins,function(a,b){b.destroy&&b.destroy()})}}})(navigator,window,document,jQuery);
