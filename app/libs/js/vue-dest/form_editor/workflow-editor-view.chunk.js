"use strict";(self.webpackChunkleaf_vue=self.webpackChunkleaf_vue||[]).push([[160],{40:(o,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n={name:"workflow-editor-view",components:{LeafFormDialog:t(392).A},data:function(){return{loading:!0,firstWorkflowDescription:"",firstWorkflowID:0,workflows:{},currentWorkflowID:null,steps:{},currentStepID:null,routes:{},endPoints:[],endpointOptions:{isSource:!0,isTarget:!0,endpoint:["Rectangle",{cssClass:"workflowEndpoint"}],paintStyle:{width:48,height:48},maxConnections:-1}}},inject:["APIroot","libsPath","CSRFToken","getSiteSettings","siteSettings","setDefaultAjaxResponseMessage","updateChosenAttributes","showFormDialog","dialogFormContent"],beforeRouteEnter:function(o,e,t){t((function(o){o.getSiteSettings(),o.setDefaultAjaxResponseMessage()}))},mounted:function(){var o=this;this.setupJSPlumb(),this.updateChosen("workflows","Select a Workflow",(function(e){o.currentWorkflowID=e.target.value}))},created:function(){this.loadWorkflowList()},computed:{hasWorkflows:function(){var o;return(null===(o=Object.keys(this.workflows))||void 0===o?void 0:o.length)>0},selectedWorkflowDescription:function(){var o,e;return null!==(o=null===(e=this.workflows[this.currentWorkflowID])||void 0===e?void 0:e.description)&&void 0!==o?o:""},selectedWorkflowAria:function(){return this.selectedWorkflowDescription+"is selected."},selectedStepAria:function(){return"TODO:is selected."},requestorStepStyle:function(){return{left:"220px",top:"120px",backgroundColor:"#e0e0e0"}}},methods:{setupJSPlumb:function(){jsPlumb.Defaults.Container="workflow",jsPlumb.Defaults.ConnectionOverlays=[["PlainArrow",{location:.9,width:20,length:12}]],jsPlumb.Defaults.PaintStyle={stroke:"lime",lineWidth:1},jsPlumb.Defaults.Connector=["StateMachine",{curviness:10}],jsPlumb.Defaults.Anchor="Continuous",jsPlumb.Defaults.Endpoint="Blank"},updateChosen:function(){var o=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Select an Option",n=arguments.length>2?arguments[2]:void 0;console.log("updating",e),""!==e&&setTimeout((function(){$("#"+e).chosen("destroy"),$("#"+e).chosen({disable_search_threshold:5,allow_single_deselect:!0}).change((function(o){return n(o)})),o.updateChosenAttributes(e,e+"_label",t)}))},newWorkflow:function(){console.log("newWorkflow")},createStep:function(){console.log("createStep")},loadWorkflowList:function(){var o=this;fetch("".concat(this.APIroot,"workflow")).then((function(o){return o.json()})).then((function(e){var t,n,l,i,s=void 0!==(null===(t=o.$route.query)||void 0===t?void 0:t.dev),a={};e.forEach((function(o){(o.workflowID>0||s)&&(a[o.workflowID]=o)})),o.workflows=a,o.firstWorkflowDescription=(null==e||null===(n=e[0])||void 0===n?void 0:n.description)||"",o.firstWorkflowID=(null==e||null===(l=e[0])||void 0===l?void 0:l.workflowID)||0,o.loading=!1;var r=null===(i=o.$route.query)||void 0===i?void 0:i.workflowID;void 0!==r&&void 0!==o.workflows[r]?o.currentWorkflowID=r:o.currentWorkflowID=o.firstWorkflowID})).catch((function(o){return console.log(o)}))},loadWorkflow:function(){var o=this;this.endPoints=[],jsPlumb.reset(),jsPlumb.setSuspendDrawing(!0),fetch("".concat(this.APIroot,"workflow/").concat(this.currentWorkflowID)).then((function(o){return o.json()})).then((function(e){o.steps=e})).catch((function(o){return console.log(o)}))},showStepInfo:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;console.log("show step info",o)}},watch:{currentWorkflowID:function(o,e){console.log("watching currentWorkflowID",o),void 0!==this.workflows[o]&&this.loadWorkflow(o)},workflows:function(o,e){var t=this;console.log("workflows changed"),this.updateChosen("workflows","Select a Workflow",(function(o){t.currentWorkflowID=o.target.value}))},steps:function(){var o=this;this.updateChosen("workflow_steps","Select a Step",(function(e){o.currentStepID=e.target.value}))}},template:'<div v-if="loading" class="page_loading">\n            Loading...\n            <img src="../images/largespinner.gif" alt="" />\n        </div>\n        <div v-show="!loading">\n            \x3c!-- TODO: this should be assoc with nav --\x3e\n            <div v-if="siteSettings?.siteType===\'national_subordinate\'" id="subordinate_site_warning" style="padding: 0.5rem; margin: 0.5rem 0;" >\n                <h3 style="margin: 0 0 0.5rem 0; color: #a00;">This is a Nationally Standardized Subordinate Site</h3>\n                <span><b>Do not make modifications!</b> &nbsp;Synchronization problems will occur. &nbsp;Please contact your process POC if modifications need to be made.</span>\n            </div>\n            <section id="workflow_editor" v-show="hasWorkflows">\n                <div id="sideBar">\n                    <div>\n                        <label id="workflows_label" for="workflows">Workflows:</label>\n                        <div id="workflowList">\n                            <span id="workflow_select_status" role="status" aria-live="polite" :aria-label="selectedWorkflowAria"></span>\n                            <select id="workflows" title="Select a Workflow">\n                                <option v-for="w in workflows" :key="\'workflows_\' + w.workflowID" :value="w.workflowID">\n                                    {{ w.description }} (ID:# {{ w.workflowID }})\n                                </option>\n                            </select>\n                        </div>\n                        <button type="button" id="btn_newWorkflow" class="buttonNorm" @click="newWorkflow();">\n                            <img :src="libsPath + \'dynicons/svg/list-add.svg\'" alt=""> New Workflow\n                        </button>\n                    </div>\n                    <div>\n                        <label id="workflow_steps_label" for="workflow_steps">Workflow Steps:</label>\n                        <div id="stepList">\n                            <span id="step_select_status" role="status" aria-live="polite" :aria-label="selectedStepAria"></span>\n                            <select id="workflow_steps" title="Select a Workflow Step to edit it">\n                                <option>Choose a step to edit</option>\n                                <option value="-1">Requestor</option>\n                                <option v-for="s in steps" :key="\'workflow_steps_\' + s.stepID" :value="s.stepID">\n                                    {{ s.stepTitle }} (#{{ s.stepID }})\n                                </option>\n                            </select>\n                        </div>\n                        <button type="button" id="btn_createStep" class="buttonNorm" @click="createStep();">\n                            <img :src="libsPath + \'dynicons/svg/list-add.svg\'" alt=""> New Step\n                        </button>\n                    </div>\n                </div> \x3c!-- END SIDEBAR --\x3e\n\n                <div id="workflow">\n                    <button type="button" class="workflowStep" id="step_-1" :style="requestorStepStyle"\n                        aria-label="workflow step: Requestor"\n                        aria-controls="stepInfo_-1"\n                        aria-expanded="false"\n                        @click="showStepInfo(-1)">\n                        Requestor\n                    </button>\n                </div>\n            </section>\n            <p>{{ currentWorkflowID }}</p>\n            <p>{{ selectedWorkflowDescription }}</p>\n            <p>{{ steps }}</p>\n            <p>{{ currentStepID }}</p>\n        </div>\n\n        \x3c!-- DIALOGS --\x3e\n        <leaf-form-dialog v-if="showFormDialog">\n            <template #dialog-content-slot>\n                <component :is="dialogFormContent"></component>\n            </template>\n        </leaf-form-dialog>'}},392:(o,e,t)=>{t.d(e,{A:()=>n});const n={data:function(){return{scrollY:window.scrollY,initialTop:15,modalElementID:"leaf_dialog_content",modalBackgroundID:"leaf-vue-dialog-background",elBody:null,elModal:null,elBackground:null,elClose:null,lastFocus:null}},inject:["dialogTitle","closeFormDialog","formSaveFunction","dialogButtonText","lastModalTab"],created:function(){this.lastFocus=document.activeElement||null},mounted:function(){this.elBody=document.querySelector("body"),this.elModal=document.getElementById(this.modalElementID),this.elModal.style.left=window.scrollX+window.innerWidth/2-this.elModal.clientWidth/2+"px",this.elBackground=document.getElementById(this.modalBackgroundID),this.elClose=document.getElementById("leaf-vue-dialog-close"),this.makeDraggable(this.elModal);var o=document.activeElement;null===(null!==o?o.closest(".leaf-vue-dialog-content"):null)&&this.elClose.focus()},beforeUnmount:function(){var o,e=(null===(o=this.lastFocus)||void 0===o?void 0:o.id)||null;if(null!==e){var t=document.getElementById(e);null!==t&&t.focus()}else null!==this.lastFocus&&this.lastFocus.focus()},methods:{firstTab:function(o){if(!0===(null==o?void 0:o.shiftKey)){var e=document.querySelector("#ifthen_deletion_dialog button.btn-general"),t=document.getElementById("next"),n=document.getElementById("button_cancelchange"),l=e||t||n;null!==l&&"function"==typeof l.focus&&(l.focus(),o.preventDefault())}},makeDraggable:function(){var o=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,n=0,l=0,i=0,s=function(o){(o=o||window.event).preventDefault(),t=l-o.clientX,n=i-o.clientY,l=o.clientX,i=o.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px",r()},a=function(){document.onmouseup=null,document.onmousemove=null},r=function(){e.offsetTop<window.scrollY&&(e.style.top=window.scrollY+"px"),e.offsetLeft<window.scrollX&&(e.style.left=window.scrollX+"px"),e.offsetLeft+e.clientWidth+18>window.innerWidth+window.scrollX&&(e.style.left=window.innerWidth+window.scrollX-e.clientWidth-18+"px"),o.elBackground.style.minWidth=o.elBody.clientWidth+"px",o.elBackground.style.minHeight=o.elModal.offsetTop+o.elBody.clientHeight+"px"};document.getElementById(this.modalElementID+"_drag_handle")&&(document.getElementById(this.modalElementID+"_drag_handle").onmousedown=function(o){(o=o||window.event).preventDefault(),l=o.clientX,i=o.clientY,document.onmouseup=a,document.onmousemove=s})}},template:'<Teleport to="body">\n        <div id="leaf-vue-dialog-background" aria-disabled="true" aria-hidden="true"></div>\n        <div :id="modalElementID" class="leaf-vue-dialog"\n            role="dialog" aria-modal="true" :aria-labelledby="modalElementID + \'_drag_handle\'" aria-describedby="record"\n            :style="{top: scrollY + initialTop + \'px\'}">\n            <div v-html="dialogTitle" :id="modalElementID + \'_drag_handle\'" class="leaf-vue-dialog-title"></div>\n            <button type="button" @click="closeFormDialog" @keydown.tab="firstTab" id="leaf-vue-dialog-close" aria-label="Close">&#10005;</button>\n            <div id="record" style="max-height:100vh;overflow-y:auto">\n                <div id="xhr" class="leaf-vue-dialog-content">\n                    <slot name="dialog-content-slot"></slot>\n                </div>\n                <div id="leaf-vue-dialog-cancel-save">\n                    <button type="button" style="width: 90px;"\n                        id="button_save" class="btn-confirm" :title="dialogButtonText.confirm"\n                        @click="formSaveFunction">\n                        {{dialogButtonText.confirm}}\n                    </button>\n                    <button type="button" style="width: 90px;"\n                        id="button_cancelchange" class="btn-general" :title="dialogButtonText.cancel"\n                        @click="closeFormDialog" @keydown.tab="lastModalTab">\n                        {{dialogButtonText.cancel}}\n                    </button>\n                </div>\n            </div>\n        </div>\n    </Teleport>'}}}]);