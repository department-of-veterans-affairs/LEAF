"use strict";(self.webpackChunkleaf_vue=self.webpackChunkleaf_vue||[]).push([[160],{380:(t,e,o)=>{o.r(e),o.d(e,{default:()=>m});var n=o(392),i=o(424);const s={name:"workflow-action-dialog",data:function(){return{actionText:this.dialogData.actionText||"",actionTextPasttense:this.dialogData.actionTextPasttense||"",actionIcon:(this.dialogData.actionIcon||"").trim(),sort:this.dialogData.sort||0,fillDependency:this.dialogData.fillDependency||1,isNewAction:this.dialogData.isNewAction||!1}},inject:["APIroot","CSRFToken","libsPath","dialogData","setDialogSaveFunction","closeFormDialog"],created:function(){this.setDialogSaveFunction(this.onSave)},mounted:function(){document.getElementById("actionText").focus()},methods:{onSave:function(){this.closeFormDialog()}},template:'<div id="action_input_modal">\n            <div>\n                <label for="actionText" id="action_label">Action <span style="color: #c00">&nbsp;*Required</span></label>\n                <div class="helper_text">eg: Approve</div>\n                <div id="actionText_error_message" class="error_message"></div>\n                <input id="actionText" type="text" maxlength="50" v-model="actionText">\n            </div>\n            <div>\n                <label for="actionTextPasttense" id="action_past_tense_label"> Action Past Tense <span style="color: #c00">&nbsp;*Required</span></label>\n                <div class="helper_text">eg: Approved</div>\n                <input id="actionTextPasttense" type="text" maxlength="50" v-model="actionTextPasttense">\n            </div>\n            <div>\n                <label for="actionIcon" id="choose_icon_label">Icon</label>\n                <div class="helper_text">eg: go-next.svg &nbsp;<a :href="libsPath + \'dynicons/gallery.php\'" style="color:#005EA2;" target="_blank">List of available icons</a></div>\n                <div class="action_icon">\n                    <input id="actionIcon" type="text" maxlength="50" v-model="actionIcon">\n                    <img v-if="actionIcon !== \'\'" :src="libsPath + \'dynicons/svg/\' + actionIcon" class="icon_preview">\n                </div>\n            </div>\n            <div>\n                <label for="actionSortNumber" id="action_sort_label">Button Order</label>\n                <div class="helper_text">Lower numbers appear first</div>\n                <input id="actionSortNumber" type="number" min="-128" max="127" style="width:80px;" v-model="sort">\n            </div>\n            <div>\n                <label for="fillDependency">\n                    Does this action represent moving forwards or backwards in the process?\n                </label>\n                <div v-if="+fillDependency < 1" id="backwards_action_note" class="helper_text">\n                    Note: Backwards actions do not save form field data.\n                </div>\n                <select id="fillDependency" v-model="fillDependency">\n                    <option value="1">Forwards</option>\n                    <option value="-1">Backwards</option>\n                </select>\n            </div>\n        </div>'};function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function r(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function a(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?r(Object(o),!0).forEach((function(e){c(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function c(t,e,o){return(e=function(t){var e=function(t){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var o=e.call(t,"string");if("object"!=l(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==l(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}const u={name:"workflow-menu",inject:["libsPath","currentWorkflowID","currentStep","workflows","workflowsList","steps","newWorkflow","createStep","renameWorkflow","duplicateWorkflow","openHistoryDialog","listActions","listEvents","deleteWorkflow"],mounted:function(){console.log("menu mounted",Date.now());var t=document.getElementById("workflows");null!==t&&t.value!==this.currentWorkflowID&&(t.value=this.currentWorkflowID,$("#workflows").trigger("chosen:updated"))},computed:{selectedWorkflowDescription:function(){var t,e;return null!==(t=null===(e=this.workflows[this.currentWorkflowID])||void 0===e?void 0:e.description)&&void 0!==t?t:""},selectedWorkflowAria:function(){return this.selectedWorkflowDescription+"is selected."},selectedStepAria:function(){var t;return void 0!==(null===(t=this.currentStep)||void 0===t?void 0:t.stepTitle)?this.currentStep.stepTitle+"is selected.":""},stepList:function(){var t=[];for(var e in this.steps)t.push(a({},this.steps[e]));return t.sort((function(t,e){var o=t.stepTitle.toLowerCase(),n=e.stepTitle.toLowerCase();return o<n?-1:o>n?1:0}))}},template:'<div id="sideBar">\n        <div>\n            <label id="workflows_label" for="workflows">Workflows:</label>\n            <div id="workflowList">\n                <span id="workflow_select_status" role="status" aria-live="polite" :aria-label="selectedWorkflowAria"></span>\n                <select id="workflows" title="Select a Workflow">\n                    <option v-for="w in workflowsList" :key="\'workflows_\' + w.workflowID" :value="w.workflowID">\n                        {{ w.description }} (ID:# {{ w.workflowID }})\n                    </option>\n                </select>\n            </div>\n        </div>\n        <button type="button" id="btn_newWorkflow" class="buttonNorm" @click="newWorkflow();">\n            <img :src="libsPath + \'dynicons/svg/list-add.svg\'" alt="">New Workflow\n        </button>\n        \n        <div>\n            <label id="steps_label" for="workflow_steps">Workflow Steps:</label>\n            <div id="stepList">\n                <span id="step_select_status" role="status" aria-live="polite" :aria-label="selectedStepAria"></span>\n                <select id="workflow_steps" title="Select a Workflow Step to edit it">\n                    <option value="0">Choose a step to edit</option>\n                    <option value="-1">Requestor</option>\n                    <option v-for="s in stepList" :key="\'workflow_steps_\' + s.stepID" :value="s.stepID">\n                        {{ s.stepTitle }} (#{{ s.stepID }})\n                    </option>\n                </select>\n            </div>\n        </div>\n        <button type="button" id="btn_createStep" class="buttonNorm" @click="createStep">\n            <img :src="libsPath + \'dynicons/svg/list-add.svg\'" alt="">New Step\n        </button>\n        <br>\n        <button type="button" id="btn_renameWorkflow" class="buttonNorm" @click="renameWorkflow()">\n            <img :src="libsPath + \'dynicons/svg/accessories-text-editor.svg\'" alt="" />Rename Workflow\n        </button>\n        <button type="button" id="btn_duplicateWorkflow" class="buttonNorm" @click="duplicateWorkflow()">\n            <img :src="libsPath + \'dynicons/svg/edit-copy.svg\'" alt="" />Copy Workflow\n        </button>\n        <br>\n        <button type="button" id="btn_viewHistory" class="buttonNorm" @click="openHistoryDialog(currentWorkflowID,\'workflow\');">\n            <img :src="libsPath + \'dynicons/svg/appointment.svg\'" alt="" />View History\n        </button>\n        <br>\n        <button type="button" id="btn_listActionType" class="buttonNorm" @click="listActions">\n            <img :src="libsPath + \'dynicons/svg/applications-other.svg\'" alt="" /> Edit Actions\n        </button>\n        <button type="button" id="btn_listEvents" class="buttonNorm" @click="listEvents">\n            <img :src="libsPath + \'dynicons/svg/gnome-system-run.svg\'" alt="" />Edit Events\n        </button>\n        <br>\n        <button type="button" id="btn_deleteWorkflow" class="buttonNorm" @click="deleteWorkflow">\n            <img :src="libsPath + \'dynicons/svg/list-remove.svg\'" alt="" />Delete Workflow\n        </button>\n    </div>'},p={name:"workflow-step-info",data:function(){var t,e;return{stepTitle:null!==(t=null===(e=this.currentStep)||void 0===e?void 0:e.stepTitle)&&void 0!==t?t:"",viewStepActions:!1}},mounted:function(){var t=document.getElementById("btn_close_stepInfo");null!==t&&t.focus()},inject:["workflowStepInfoType","currentStep","currentJSPlumbParams","steps","routes","closeWorkflowStepInfo"],computed:{stepID:function(){var t,e;return null!==(t=null===(e=this.currentStep)||void 0===e?void 0:e.stepID)&&void 0!==t?t:null},actionType:function(){var t,e;return null!==(t=null===(e=this.currentJSPlumbParams)||void 0===e?void 0:e.action)&&void 0!==t?t:null},fromStepID:function(){var t,e;return null!==(t=null===(e=this.currentJSPlumbParams)||void 0===e?void 0:e.stepID)&&void 0!==t?t:null},fromStepTitle:function(){var t,e="Requestor";return-1!==this.fromStepID&&(e=(null===(t=this.steps)||void 0===t||null===(t=t[this.fromStepID])||void 0===t?void 0:t.stepTitle)||""),e},outboundRoutes:function(){var t=this,e=!1,o=[];return this.routes.map((function(n){if(n.stepID===t.stepID){var i=n.actionText,s=n.actionIcon,l=n.actionType;o.push({actionText:i,actionIcon:s,actionType:l})}"submit"===n.actionType&&(e=!0)})),-1===this.stepID&&!1===e&&o.push({actionText:"Submit",actionType:"submit",actionIcon:""}),o=o.sort((function(t,e){return t.actionText<e.actionText}))},stepInfoStyles:function(){var t={};if("step"===this.workflowStepInfoType&&null!==this.stepID){var e=document.getElementById("step_"+this.stepID);if(null!==e){var o={left:e.offsetLeft,top:e.offsetTop},n=e.offsetHeight;t={top:o.top+n+16+"px",left:o.left+"px"}}}return"action"===this.workflowStepInfoType&&null!==this.currentJSPlumbParams&&(t={top:this.currentJSPlumbParams.pageY+"px",left:this.currentJSPlumbParams.pageX+"px"}),t},modalHeaderText:function(){var t="";switch(this.stepID){case null:t="Action: ".concat(this.fromStepTitle," clicks ").concat(this.actionType);break;case-1:t="Request initiator (stepID #: -1)";break;case 0:t="The End (stepID #: 0)";break;default:t="StepID: #".concat(this.stepID)}return t}},methods:{tabControls:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===e&&null!=this.$refs.lastEl&&(this.$refs.lastEl.focus(),t.preventDefault()),!1===e&&!1===t.shiftKey&&null!=this.$refs.closeBtn&&(this.$refs.closeBtn.focus(),t.preventDefault())}},watch:{currentStep:function(t,e){console.log("step watch",t,e)},currentJSPlumbParams:function(t,e){console.log("action watch",t,e)}},template:'<div :id="\'stepInfo_\' + (stepID ?? actionType)"\n        class="workflowStepInfo" :style="stepInfoStyles" @keydown.escape="closeWorkflowStepInfo($event, true)">\n        <div id="stepInfo_header">\n            <h3>{{ modalHeaderText }}</h3>\n            <button type="button" id="btn_close_stepInfo" aria-label="close modal"\n                @keydown.tab.shift="tabControls($event, true)" ref="closeBtn"\n                @click="closeWorkflowStepInfo($event, true)">\n                    &#10005;\n            </button>\n        </div>\n        <div v-if="workflowStepInfoType === \'step\' && stepID !== null" id="stepInfo_content">\n            <div v-if="stepID > 0">\n                <label for="step_title"> Step Title:</label>\n                <input id="step_title" type="text" v-model="stepTitle">\n            </div>\n            <div v-if="stepID !== 0">\n                <label for="toggleManageActions">\n                    <input id="toggleManageActions" type="checkbox" style="margin:0;" v-model="viewStepActions">\n                    &nbsp;View Step Actions\n                </label>\n                <ul v-show="viewStepActions" class="workflow_actions">\n                    <li v-for="r in outboundRoutes" :key="\'route_info_\' + r.actionType">{{ r.actionText }}</li>\n                </ul>\n            </div>\n\n            <button type="button" class="buttonNorm"\n                @keydown.tab="tabControls($event, false)" ref="lastEl">test last</button>\n         </div>\n         <div v-if="workflowStepInfoType === \'action\' && currentJSPlumbParams !== null" id="stepInfo_content">\n         </div>\n    </div>'};var d=o(425);function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function w(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function v(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?w(Object(o),!0).forEach((function(e){h(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):w(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function h(t,e,o){return(e=function(t){var e=function(t){if("object"!=f(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var o=e.call(t,"string");if("object"!=f(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}const m={name:"workflow-editor-view",components:{WorkflowMenu:u,WorkflowStepInfo:p,LeafFormDialog:n.A,HistoryDialog:i.A,WorkflowActionDialog:s},data:function(){return{loading:!0,workflowMinHeight:300,minEndStepPosY:80,endStepDiffY:160,endStepInitialX:580,requestorStepInitialX:220,requestorStepInitialY:120,currentWorkflowID:null,currentStepID:null,workflowStepInfoType:"",firstWorkflowID:1,workflowsList:[],workflows:{},steps:{},localSteps:{"-1":{stepID:-1,posX:null,posY:null},0:{stepID:0,posX:null,posY:null}},routes:[],jsPlumbInstance:null,currentJSPlumbParams:null,endPoints:{},endpointOptions:{isSource:!0,isTarget:!0,endpoint:["Rectangle",{cssClass:"workflowEndpoint"}],paintStyle:{width:48,height:48},maxConnections:-1},mock_action:{actionText:"mock action test",actionTextPasttense:"mock action tested",actionIcon:"applications-graphics.svg",sort:0,fillDependency:1},mock_isNew:!1}},inject:["APIroot","libsPath","CSRFToken","getSiteSettings","isJSON","siteSettings","setDefaultAjaxResponseMessage","updateChosenAttributes","showFormDialog","dialogFormContent","openWorkflowActionDialog"],beforeRouteEnter:function(t,e,o){o((function(t){t.getSiteSettings(),t.setDefaultAjaxResponseMessage()}))},mounted:function(){this.loadWorkflowList(),this.setupJSPlumb(),console.log("mounted",Date.now()),document.addEventListener("mousedown",this.closeWorkflowStepInfo)},beforeUnmount:function(){document.removeEventListener("mousedown",this.closeWorkflowStepInfo)},provide:function(){var t=this;return{currentWorkflowID:(0,d.EW)((function(){return t.currentWorkflowID})),currentStep:(0,d.EW)((function(){return t.currentStep})),workflows:(0,d.EW)((function(){return t.workflows})),workflowsList:(0,d.EW)((function(){return t.workflowsList})),steps:(0,d.EW)((function(){return t.steps})),routes:(0,d.EW)((function(){return t.routes})),workflowStepInfoType:(0,d.EW)((function(){return t.workflowStepInfoType})),currentJSPlumbParams:(0,d.EW)((function(){return t.currentJSPlumbParams})),newWorkflow:this.newWorkflow,createStep:this.createStep,renameWorkflow:this.renameWorkflow,duplicateWorkflow:this.duplicateWorkflow,listActions:this.listActions,listEvents:this.listEvents,deleteWorkflow:this.deleteWorkflow,closeWorkflowStepInfo:this.closeWorkflowStepInfo}},computed:{routeQueryWorkflowID:function(){var t;return+(null===(t=this.$route.query)||void 0===t?void 0:t.workflowID)},hasRouteQueryDev:function(){return void 0!==this.$route.query.dev},hasWorkflows:function(){var t;return(null===(t=Object.keys(this.workflows))||void 0===t?void 0:t.length)>0},workflowMaxY:function(){var t=this.minEndStepPosY,e=null;for(var o in this.steps)(e=parseInt(this.steps[o].posY))>t&&(t=e);return t},workflowHeight:function(){return{height:this.workflowMinHeight+this.workflowMaxY+"px"}},requestorStepStyle:function(){return{left:(this.localSteps[-1].posX||this.requestorStepInitialX)+"px",top:(this.localSteps[-1].posY||this.requestorStepInitialY)+"px",backgroundColor:"#e0e0e0",fontWeight:"normal"}},lastStepStyle:function(){return this.workflowMaxY>this.minEndStepPosY&&null===this.localSteps[0].posY&&(this.localSteps[0].posY=this.endStepDiffY+this.workflowMaxY),{left:(this.localSteps[0].posX||this.endStepInitialX)+"px",top:this.localSteps[0].posY+"px",backgroundColor:"#ff8181",fontWeight:"normal"}},currentStep:function(){var t,e,o=null;return this.currentStepID>0?o=null!==(t=null===(e=this.steps)||void 0===e?void 0:e[this.currentStepID])&&void 0!==t?t:null:null!==this.currentStepID&&(o={stepID:this.currentStepID}),o}},methods:{setupJSPlumb:function(){var t=this;jsPlumb.ready((function(){t.jsPlumbInstance=jsPlumb.getInstance(),t.jsPlumbInstance.Defaults.Container="workflow",t.jsPlumbInstance.Defaults.ConnectionOverlays=[["PlainArrow",{location:.9,width:16,length:14}]],t.jsPlumbInstance.Defaults.PaintStyle={stroke:"lime",lineWidth:1},t.jsPlumbInstance.Defaults.Connector=["StateMachine",{curviness:10}],t.jsPlumbInstance.Defaults.Anchor="Continuous",t.jsPlumbInstance.Defaults.Endpoint="Blank"}))},updateChosen:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Select an Option",i=arguments.length>3?arguments[3]:void 0;""!==e&&(0,d.dY)((function(){$("#"+e).chosen("destroy"),$("#"+e).chosen({disable_search_threshold:5,allow_single_deselect:!0}).change((function(t){return i(t)})),t.updateChosenAttributes(e,o,n)}))},getStepStyle:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=this.localSteps[e]||this.steps[e];return void 0!==o?{left:Math.max(parseInt(o.posX),0)+"px",top:Math.max(parseInt(o.posY),80)+"px",fontSize:(null==o||null===(t=o.stepTitle)||void 0===t?void 0:t.length)>40?"90%":"100%",backgroundColor:o.stepBgColor,fontWeight:"normal"}:{}},newWorkflow:function(){console.log("newWorkflow")},createStep:function(){console.log("createStep")},renameWorkflow:function(){},duplicateWorkflow:function(){},listActions:function(){},listEvents:function(){},deleteWorkflow:function(){},loadWorkflowList:function(){var t=this;fetch("".concat(this.APIroot,"workflow")).then((function(t){return t.json()})).then((function(e){var o;t.workflowsList=t.hasRouteQueryDev?e:e.filter((function(t){return t.workflowID>0}));var n={};e.forEach((function(t){n[t.workflowID]=t})),t.workflows=n,t.firstWorkflowID=(null===(o=t.workflowsList)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.workflowID)||0;var i=t.routeQueryWorkflowID;(0===i||void 0===t.workflows[i]||!1===t.hasRouteQueryDev&&i<0)&&(i=t.firstWorkflowID),t.currentWorkflowID=i,t.loading=!1})).catch((function(t){return console.log(t)}))},loadWorkflow:function(){var t=this;if(this.routeQueryWorkflowID!==this.currentWorkflowID){var e={workflowID:this.currentWorkflowID};this.hasRouteQueryDev&&(e.dev=this.$route.query.dev),this.$router.push({path:"workflows",query:e})}this.jsPlumbInstance.reset(),this.jsPlumbInstance.setSuspendDrawing(!0),Promise.all([fetch("".concat(this.APIroot,"workflow/").concat(this.currentWorkflowID)),fetch("".concat(this.APIroot,"workflow/").concat(this.currentWorkflowID,"/route"))]).then((function(e){Promise.all([e[0].json(),e[1].json()]).then((function(e){t.steps=e[0],t.routes=e[1],t.jsPlumbConfig(),t.drawRoutes()}))})).catch((function(t){return console.log(t)}))},jsPlumbConfig:function(){var t=this;(0,d.dY)((function(){var e=function(e){return function(){var o=document.getElementById("step_".concat(e));if(null!==o){var n=o.offsetLeft,i=o.offsetTop;t.updateStepPosition(e,n,i)}}};for(var o in t.endPoints={},t.steps)null==t.endPoints[o]&&(t.endPoints[o]=t.jsPlumbInstance.addEndpoint("step_"+o,{anchor:"Continuous"},t.endpointOptions),t.jsPlumbInstance.draggable("step_"+o,{allowNegative:!1,stop:e(+o)}));if(null==t.endPoints[-1]&&(t.endPoints[-1]=t.jsPlumbInstance.addEndpoint("step_-1",{anchor:"Continuous"},t.endpointOptions),t.jsPlumbInstance.draggable("step_-1",{allowNegative:!1,stop:e(-1)})),null==t.endPoints[0]){var n=v(v({},t.endpointOptions),{},{isSource:!1});t.endPoints[0]=t.jsPlumbInstance.addEndpoint("step_0",{anchor:"Continuous"},n),t.jsPlumbInstance.draggable("step_0",{allowNegative:!1,stop:e(0)})}}))},drawRoutes:function(){var t=this;(0,d.dY)((function(){var e,o,n=.5,i={};if(t.routes.forEach((function(e){switch(n=.5,e.actionType.toLowerCase()){case"sendback":n=.3;break;case"approve":case"concur":n=.5;break;case"defer":n=.25;break;case"disapprove":n=.75;break;default:var o=String(e.stepID),s=String(e.nextStepID);if(o!==s){var l=o+"_"+s;(null==i?void 0:i[l])>=0?(i[l]+=1,(n=Math.min(+(.05+.15*i[l]).toFixed(2),.65))>=.5&&(n+=.15)):i[l]=0}}if(0===e.nextStepID&&"sendback"==e.actionType)t.jsPlumbInstance.connect({source:"step_"+e.stepID,target:"step_-1",paintStyle:{stroke:"red"},overlays:[["Label",{id:"stepLabel_".concat(e.stepID,"_0_").concat(e.actionType),cssClass:"workflowAction action-".concat(e.stepID,"-sendback--1"),label:e.actionText,location:n,parameters:{stepID:e.stepID,nextStepID:0,action:e.actionType},events:{click:function(e,o){var n=e.getParameters();t.showActionInfo(n,o)}}}]]});else{var r={source:"step_"+e.stepID,target:"step_"+e.nextStepID,connector:["StateMachine",{curviness:10}],anchor:"Continuous",overlays:[["Label",{id:"stepLabel_"+e.stepID+"_"+e.nextStepID+"_"+e.actionType,cssClass:"workflowAction action-".concat(e.stepID,"-").concat(e.actionType,"-").concat(e.nextStepID),label:e.actionText,location:n,parameters:{stepID:e.stepID,nextStepID:e.nextStepID,action:e.actionType},events:{click:function(e,o){var n=e.getParameters();t.showActionInfo(n,o)}}}]]};"sendback"==e.actionType&&(r.paintStyle={stroke:"red"}),t.jsPlumbInstance.connect(r)}})),void 0!==(null===(e=t.workflows[t.currentWorkflowID])||void 0===e?void 0:e.initialStepID)&&0!==(null===(o=t.workflows[t.currentWorkflowID])||void 0===o?void 0:o.initialStepID)){var s=t.workflows[t.currentWorkflowID].initialStepID;t.jsPlumbInstance.connect({source:t.endPoints[-1],target:t.endPoints[s],connector:["StateMachine",{curviness:10}],anchor:"Continuous",overlays:[["Label",{id:"stepLabel_0_"+s+"_submit",cssClass:"workflowAction action--1-submit-".concat(s),label:"Submit",location:n,parameters:{stepID:-1,nextStepID:s,action:"submit"},events:{click:function(e,o){var n=e.getParameters();t.showActionInfo(n,o)}}}]]})}t.jsPlumbInstance.bind("connection",(function(e){return t.createAction(e)})),t.jsPlumbInstance.setSuspendDrawing(!1,!0),Array.from(document.querySelectorAll(".workflowEndpoint")).forEach((function(e){return e.style.backgroundImage="url(".concat(t.libsPath,"dynicons/svg/network-wired.svg)")}))}))},updateStepPosition:function(t,e,o){var n=this;if(t>0){var i=new FormData;i.append("CSRFToken",this.CSRFToken),i.append("stepID",t),i.append("x",e),i.append("y",o);var s=this.steps[t].posX,l=this.steps[t].posY;this.steps[t].posX=e,this.steps[t].posY=o,fetch("".concat(this.APIroot,"workflow/").concat(this.currentWorkflowID,"/editorPosition"),{method:"POST",body:i}).catch((function(e){console.log("error saving step position",e),n.steps[t].posX=s,n.steps[t].posY=l}))}else{var r;if(Number.isInteger(t)&&void 0===(null===(r=this.localSteps)||void 0===r?void 0:r[t])){var a=this.steps[t],c=a.stepID,u=a.posX,p=a.posY,d=a.stepBgColor;this.localSteps[c]={stepID:c,posX:u,posY:p,stepBgColor:d}}void 0!==this.localSteps[t]&&(this.localSteps[t].posX=e,this.localSteps[t].posY=o)}},showStepInfo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(this.workflowStepInfoType="step",this.currentJSPlumbParams=null,this.currentStepID===t)this.currentStepID=null;else{this.currentStepID=+t;var e=document.getElementById("workflow_steps");null!==e&&e.value!==t&&(e.value=t,$("#workflow_steps").trigger("chosen:updated"))}},showActionInfo:function(t,e){var o,n,i,s;this.workflowStepInfoType="action",this.currentStepID=null,this.currentJSPlumbParams=v(v({},t),{},{pageX:null!==(o=null==e?void 0:e.pageX)&&void 0!==o?o:200,pageY:null!==(n=null==e?void 0:e.pageY)&&void 0!==n?n:300,mediatingStep:null!==(i=null==e||null===(s=e.detail)||void 0===s?void 0:s.mediatingStep)&&void 0!==i?i:null})},closeWorkflowStepInfo:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===e){var o=document.querySelector(".workflowStepInfo");e=t.target.closest(".workflowStepInfo")!==o}!0===e&&(this.currentStepID=null,this.currentJSPlumbParams=null,this.workflowStepInfoType="")},createAction:function(t){console.log(t)},emailNotificationIcon:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o="",n=null===(t=this.steps)||void 0===t?void 0:t[e];if("string"==typeof(null==n?void 0:n.stepData)&&this.isJSON(n.stepData)){var i,s=JSON.parse(n.stepData);if("true"===(null===(i=s.AutomatedEmailReminders)||void 0===i||null===(i=i.AutomateEmailGroup)||void 0===i?void 0:i.toLowerCase())){var l=s.AutomatedEmailReminders.DaysSelected,r=l>1?"Days":"Day";o='<img src="'.concat(this.libsPath,'dynicons/svg/appointment.svg"\n                        style="height:18px;width:18px;margin-bottom:-3px;"\n                        alt="Email reminders will be sent after ').concat(l," ").concat(r,' of inactivity"\n                        title="Email reminders will be sent after ').concat(l," ").concat(r,' of inactivity">')}}return o}},watch:{routeQueryWorkflowID:function(t,e){console.log("route wfID changed, updating select value",t,e);var o=document.getElementById("workflows");null!==o&&o.value!==t&&(o.value=t,o.dispatchEvent(new Event("change")),$("#workflows").trigger("chosen:updated"))},hasRouteQueryDev:function(t,e){console.log("dev param changed, refetching wfs"),this.loadWorkflowList()},currentWorkflowID:function(){this.localSteps[-1].posX=null,this.localSteps[-1].posY=null,this.localSteps[0].posX=null,this.localSteps[0].posY=null,this.closeWorkflowStepInfo({},!0),void 0!==this.workflows[this.currentWorkflowID]?this.loadWorkflow():this.currentWorkflowID=this.firstWorkflowID},workflows:function(t,e){var o=this;console.log("wfs changed, update chosen options",t,e,Date.now()),this.updateChosen("workflows","workflows_label","Select a Workflow",(function(t){console.log("wf selection triggered wfID update"),o.currentWorkflowID=+t.target.value}))},steps:function(t,e){var o=this;console.log("steps changed, update chosen options",t,e),this.updateChosen("workflow_steps","steps_label","Select a Step",(function(t){console.log("step election triggered stepID and info type update"),o.workflowStepInfoType="step",o.currentStepID=+t.target.value}))}},template:'<div v-if="loading" class="page_loading">\n            Loading...\n            <img src="../images/largespinner.gif" alt="" />\n        </div>\n        <div v-else>\n            \x3c!-- TODO: this should be assoc with nav --\x3e\n            <div v-if="siteSettings?.siteType===\'national_subordinate\'" id="subordinate_site_warning" style="padding: 0.5rem; margin: 0.5rem 0;" >\n                <h3 style="margin: 0 0 0.5rem 0; color: #a00;">This is a Nationally Standardized Subordinate Site</h3>\n                <span><b>Do not make modifications!</b> &nbsp;Synchronization problems will occur. &nbsp;Please contact your process POC if modifications need to be made.</span>\n            </div>\n            <section id="workflow_editor" v-if="hasWorkflows">\n                <WorkflowMenu />\n\n                <div id="workflow" :style="workflowHeight">\n                    <template v-if="currentStepID !== null || currentJSPlumbParams !== null">\n                        <WorkflowStepInfo :key="\'step_info_\' + currentStepID" />\n                    </template>\n                    <button type="button" class="workflowStep" id="step_-1" :style="requestorStepStyle"\n                        aria-label="workflow step: Requestor"\n                        aria-controls="stepInfo_-1"\n                        :aria-expanded="currentStepID === -1"\n                        @click="showStepInfo(-1)">\n                        Requestor\n                    </button>\n\n                    <template v-for="s in steps" :key="\'wf_step_\' + s.stepID">\n                        <button type="button" class="workflowStep" :id="\'step_\' + s.stepID" :style="getStepStyle(s.stepID)"\n                            :aria-label="\'workflow step: \' + s.stepTitle"\n                            :aria-controls="\'stepInfo_\' + s.stepID"\n                            :aria-expanded="currentStepID === s.stepID"\n                            @click="showStepInfo(s.stepID)">\n                                {{ s.stepTitle }}&nbsp;<span v-if="typeof s?.stepData === \'string\'" v-html="emailNotificationIcon(s.stepID)"></span>\n                        </button>\n                    </template>\n\n                    <button type="button" class="workflowStep" id="step_0" :style="lastStepStyle"\n                        aria-label="Workflow End"\n                        aria-controls="stepInfo_0"\n                        :aria-expanded="currentStepID === 0"\n                        @click="showStepInfo(0)">\n                            End\n                    </button>\n                </div>\n            </section>\n\n            <button type="button" @click="openWorkflowActionDialog(mock_action, mock_isNew)">MOCK Action</button>\n            <label for="mocktest"><input id="mocktest" type="checkbox" v-model="mock_isNew"> is new action</label>\n        </div>\n\n        \x3c!-- DIALOGS --\x3e\n        <leaf-form-dialog v-if="showFormDialog">\n            <template #dialog-content-slot>\n                <component :is="dialogFormContent"></component>\n            </template>\n        </leaf-form-dialog>'}},392:(t,e,o)=>{o.d(e,{A:()=>n});const n={data:function(){return{scrollY:window.scrollY,initialTop:15,modalElementID:"leaf_dialog_content",modalBackgroundID:"leaf-vue-dialog-background",elBody:null,elModal:null,elBackground:null,elClose:null,lastFocus:null}},inject:["dialogTitle","closeFormDialog","formSaveFunction","dialogButtonText","lastModalTab"],created:function(){this.lastFocus=document.activeElement||null},mounted:function(){this.elBody=document.querySelector("body"),this.elModal=document.getElementById(this.modalElementID),this.elModal.style.left=window.scrollX+window.innerWidth/2-this.elModal.clientWidth/2+"px",this.elBackground=document.getElementById(this.modalBackgroundID),this.elClose=document.getElementById("leaf-vue-dialog-close"),this.makeDraggable(this.elModal);var t=document.activeElement;null===(null!==t?t.closest(".leaf-vue-dialog-content"):null)&&this.elClose.focus()},beforeUnmount:function(){var t,e=(null===(t=this.lastFocus)||void 0===t?void 0:t.id)||null;if(null!==e){var o=document.getElementById(e);null!==o&&o.focus()}else null!==this.lastFocus&&this.lastFocus.focus()},methods:{firstTab:function(t){if(!0===(null==t?void 0:t.shiftKey)){var e=document.querySelector("#ifthen_deletion_dialog button.btn-general"),o=document.getElementById("next"),n=document.getElementById("button_cancelchange"),i=e||o||n;null!==i&&"function"==typeof i.focus&&(i.focus(),t.preventDefault())}},makeDraggable:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=0,n=0,i=0,s=0,l=function(t){(t=t||window.event).preventDefault(),o=i-t.clientX,n=s-t.clientY,i=t.clientX,s=t.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-o+"px",a()},r=function(){document.onmouseup=null,document.onmousemove=null},a=function(){e.offsetTop<window.scrollY&&(e.style.top=window.scrollY+"px"),e.offsetLeft<window.scrollX&&(e.style.left=window.scrollX+"px"),e.offsetLeft+e.clientWidth+18>window.innerWidth+window.scrollX&&(e.style.left=window.innerWidth+window.scrollX-e.clientWidth-18+"px"),t.elBackground.style.minWidth=t.elBody.clientWidth+"px",t.elBackground.style.minHeight=t.elModal.offsetTop+t.elBody.clientHeight+"px"};document.getElementById(this.modalElementID+"_drag_handle")&&(document.getElementById(this.modalElementID+"_drag_handle").onmousedown=function(t){(t=t||window.event).preventDefault(),i=t.clientX,s=t.clientY,document.onmouseup=r,document.onmousemove=l})}},template:'<Teleport to="body">\n        <div id="leaf-vue-dialog-background" aria-disabled="true" aria-hidden="true"></div>\n        <div :id="modalElementID" class="leaf-vue-dialog"\n            role="dialog" aria-modal="true" :aria-labelledby="modalElementID + \'_drag_handle\'" aria-describedby="record"\n            :style="{top: scrollY + initialTop + \'px\'}">\n            <div v-html="dialogTitle" :id="modalElementID + \'_drag_handle\'" class="leaf-vue-dialog-title"></div>\n            <button type="button" @click="closeFormDialog" @keydown.tab="firstTab" id="leaf-vue-dialog-close" aria-label="Close">&#10005;</button>\n            <div id="record" style="max-height:100vh;overflow-y:auto">\n                <div id="xhr" class="leaf-vue-dialog-content">\n                    <slot name="dialog-content-slot"></slot>\n                </div>\n                <div id="leaf-vue-dialog-cancel-save">\n                    <button type="button" style="width: 90px;"\n                        id="button_save" class="btn-confirm" :title="dialogButtonText.confirm"\n                        @click="formSaveFunction">\n                        {{dialogButtonText.confirm}}\n                    </button>\n                    <button type="button" style="width: 90px;"\n                        id="button_cancelchange" class="btn-general" :title="dialogButtonText.cancel"\n                        @click="closeFormDialog" @keydown.tab="lastModalTab">\n                        {{dialogButtonText.cancel}}\n                    </button>\n                </div>\n            </div>\n        </div>\n    </Teleport>'}},424:(t,e,o)=>{o.d(e,{A:()=>n});const n={name:"history-dialog",data:function(){return{requiredDataProperties:["historyType","historyID"],divSaveCancelID:"leaf-vue-dialog-cancel-save",page:1,historyType:this.dialogData.historyType,historyID:this.dialogData.historyID,ajaxRes:null}},inject:["dialogData","checkRequiredData","lastModalTab"],created:function(){this.checkRequiredData(this.requiredDataProperties)},mounted:function(){document.getElementById(this.divSaveCancelID).style.display="none",this.getPage()},computed:{showNext:function(){return null!==this.ajaxRes&&-1===this.ajaxRes.indexOf("No history to show")},showPrev:function(){return this.page>1}},methods:{getNext:function(){this.page++,this.getPage()},getPrev:function(){this.page--,this.getPage()},getPage:function(){var t=this;try{var e="ajaxIndex.php?a=gethistory&type=".concat(this.historyType,"&gethistoryslice=1&page=").concat(this.page,"&id=").concat(this.historyID);fetch(e).then((function(e){e.text().then((function(e){return t.ajaxRes=e}))}))}catch(t){console.log("error getting history",t)}}},template:'<div>\n        <div v-if="ajaxRes === null" class="page_loading">\n            Loading...\n            <img src="../images/largespinner.gif" alt="" />\n        </div>\n        <div v-else id="history-slice" v-html="ajaxRes" style="min-height: 100px; min-width: 300px;"></div>\n        <div id="history-page-buttons" style="display: flex; justify-content: space-between;">\n            <button v-if="showPrev" id="prev" type="button"\n                class="btn-general"\n                style="width: 125px;"\n                @click="getPrev" title="get previous page">\n                Previous page\n            </button>\n            <button v-if="showNext" id="next" type="button"\n                class="btn-general"\n                style="width: 125px; margin-left: auto;"\n                @click="getNext" @keydown.tab="lastModalTab" title="get next page">\n                Next page\n            </button>\n        </div>\n    </div>'}}}]);