"use strict";(self.webpackChunkleaf_vue=self.webpackChunkleaf_vue||[]).push([[951],{392:(e,t,n)=>{n.d(t,{A:()=>i});const i={data:function(){return{scrollY:window.scrollY,initialTop:15,modalElementID:"leaf_dialog_content",modalBackgroundID:"leaf-vue-dialog-background",elBody:null,elModal:null,elBackground:null,elClose:null,lastFocus:null}},inject:["dialogTitle","closeFormDialog","formSaveFunction","dialogButtonText","lastModalTab"],created:function(){this.lastFocus=document.activeElement||null},mounted:function(){this.elBody=document.querySelector("body"),this.elModal=document.getElementById(this.modalElementID),this.elModal.style.left=window.scrollX+window.innerWidth/2-this.elModal.clientWidth/2+"px",this.elBackground=document.getElementById(this.modalBackgroundID),this.elClose=document.getElementById("leaf-vue-dialog-close"),this.makeDraggable(this.elModal);var e=document.activeElement;null===(null!==e?e.closest(".leaf-vue-dialog-content"):null)&&this.elClose.focus()},beforeUnmount:function(){var e,t=(null===(e=this.lastFocus)||void 0===e?void 0:e.id)||null;if(null!==t){var n=document.getElementById(t);null!==n&&n.focus()}else null!==this.lastFocus&&this.lastFocus.focus()},methods:{firstTab:function(e){if(!0===(null==e?void 0:e.shiftKey)){var t=document.querySelector("#ifthen_deletion_dialog button.btn-general"),n=document.getElementById("next"),i=document.getElementById("button_cancelchange"),o=t||n||i;null!==o&&"function"==typeof o.focus&&(o.focus(),e.preventDefault())}},makeDraggable:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=0,i=0,o=0,r=0,l=function(e){(e=e||window.event).preventDefault(),n=o-e.clientX,i=r-e.clientY,o=e.clientX,r=e.clientY,t.style.top=t.offsetTop-i+"px",t.style.left=t.offsetLeft-n+"px",s()},a=function(){document.onmouseup=null,document.onmousemove=null},s=function(){t.offsetTop<window.scrollY&&(t.style.top=window.scrollY+"px"),t.offsetLeft<window.scrollX&&(t.style.left=window.scrollX+"px"),t.offsetLeft+t.clientWidth+18>window.innerWidth+window.scrollX&&(t.style.left=window.innerWidth+window.scrollX-t.clientWidth-18+"px"),e.elBackground.style.minWidth=e.elBody.clientWidth+"px",e.elBackground.style.minHeight=e.elModal.offsetTop+e.elBody.clientHeight+"px"};document.getElementById(this.modalElementID+"_drag_handle")&&(document.getElementById(this.modalElementID+"_drag_handle").onmousedown=function(e){(e=e||window.event).preventDefault(),o=e.clientX,r=e.clientY,document.onmouseup=a,document.onmousemove=l})}},template:'<Teleport to="body">\n        <div id="leaf-vue-dialog-background" aria-disabled="true" aria-hidden="true"></div>\n        <div :id="modalElementID" class="leaf-vue-dialog"\n            role="dialog" aria-modal="true" :aria-labelledby="modalElementID + \'_drag_handle\'" aria-describedby="record"\n            :style="{top: scrollY + initialTop + \'px\'}">\n            <div v-html="dialogTitle" :id="modalElementID + \'_drag_handle\'" class="leaf-vue-dialog-title"></div>\n            <button type="button" @click="closeFormDialog" @keydown.tab="firstTab" id="leaf-vue-dialog-close" aria-label="Close">&#10005;</button>\n            <div id="record" style="max-height:100vh;overflow-y:auto">\n                <div id="xhr" class="leaf-vue-dialog-content">\n                    <slot name="dialog-content-slot"></slot>\n                </div>\n                <div id="leaf-vue-dialog-cancel-save">\n                    <button type="button" style="width: 90px;"\n                        id="button_save" class="btn-confirm" :title="dialogButtonText.confirm"\n                        @click="formSaveFunction">\n                        {{dialogButtonText.confirm}}\n                    </button>\n                    <button type="button" style="width: 90px;"\n                        id="button_cancelchange" class="btn-general" :title="dialogButtonText.cancel"\n                        @click="closeFormDialog" @keydown.tab="lastModalTab">\n                        {{dialogButtonText.cancel}}\n                    </button>\n                </div>\n            </div>\n        </div>\n    </Teleport>'}},608:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var i=n(425);function o(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}const l={name:"restore-field-options-dialog",data:function(){return{initialFocusElID:"radio_restore_all",userOptionSelection:"all",userMessage:""}},inject:["APIroot","CSRFToken","restoreField","updateAppData","indicatorID_toRestore","indicatorName_toRestore","disabledAncestors","firstOrphanID","searchPending","setDialogSaveFunction","closeFormDialog"],created:function(){this.setDialogSaveFunction(this.onSave)},mounted:function(){this.userMessage="<p><b>This question has disabled parent questions:</b></p>";var e=document.getElementById(this.initialFocusElID);null!==e&&e.focus()},computed:{disabledAncestorsList:function(){return o(this.disabledAncestors).reverse()},listStyles:function(){return{listStyleType:"disc",marginLeft:"0.5rem",paddingTop:"0.5rem",lineHeight:"1.4",paddingInlineStart:"1rem"}}},methods:{onSave:function(){var e=this;this.userMessage='<b style="color:#064;">Restoring Fields...</b>';var t=this.indicatorID_toRestore;if("one"===this.userOptionSelection)Promise.all([this.unsetParentID(t),this.restoreField(t)]).then((function(){e.updateAppData(t),e.closeFormDialog()})).catch((function(e){return console.log(e)}));else var n=[{indicatorID:t}].concat(o(this.disabledAncestors)),i=n.length,r=0,l=setInterval((function(){if(n.length>0){var t=n.pop().indicatorID;e.restoreField(t).then((function(){e.updateAppData(t,1250)})).catch((function(e){console.log(e)})).finally((function(){0===r&&null!==e.firstOrphanID&&e.unsetParentID(t),++r===i&&setTimeout((function(){e.closeFormDialog()}),750)}))}else clearInterval(l)}),100)},unsetParentID:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new FormData;return t.append("CSRFToken",this.CSRFToken),t.append("parentID",null),fetch("".concat(this.APIroot,"formEditor/").concat(e,"/parentID"),{method:"POST",body:t})}},template:'\n            <div id="restore_fields_parent_options" style="margin-bottom: 1rem; min-height: 50px;">\n                <div v-if="searchPending === true" class="page_loading">\n                    Loading...\n                    <img src="../images/largespinner.gif" alt="" />\n                </div>\n                <template v-else>\n                    <h3 style="margin:0 0 1rem 0; color:#000;">{{ indicatorName_toRestore }}</h3>\n                    <div v-if="userMessage !== \'\'" v-html="userMessage"></div>\n                    <ul :style="listStyles">\n                        <li v-for="element in disabledAncestorsList" style="display:list-item;">\n                            {{ element.name.length > 50 ? element.name.slice(0, 47) + "..." : element.name }}\n                        </li>\n                    </ul>\n                    <fieldset>\n                        <legend id="restore_fields_legend">Restore Options</legend>\n                        <label class="checkable leaf_check" for="radio_restore_all">\n                            <input type="radio" checked\n                                v-model="userOptionSelection"\n                                id="radio_restore_all"\n                                class="icheck leaf_check"\n                                value="all"\n                                aria-describedby="restore_fields_parent_options">\n                            <span class="leaf_check"></span> Restore associated fields\n                        </label>\n                        <label class="checkable leaf_check" for="radio_restore_one">\n                            <input type="radio"\n                                v-model="userOptionSelection"\n                                id="radio_restore_one"\n                                class="icheck leaf_check"\n                                value="one"\n                                aria-describedby="restore_fields_parent_options">\n                            <span class="leaf_check"></span> Only restore this field (This will break its associations)\n                        </label>\n                    </fieldset>\n                </template>\n            </div>'};function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return(t=function(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const u={name:"restore-fields-view",data:function(){return{loading:!0,formGrid:null,disabledFields:[],enabledFields:{},indicatorID_toRestore:null,indicatorName_toRestore:"",disabledAncestors:[],firstOrphanID:null,searchPending:!0}},components:{LeafFormDialog:n(392).A,RestoreFieldOptionsDialog:l},inject:["APIroot","CSRFToken","setDefaultAjaxResponseMessage","openRestoreFieldOptionsDialog","decodeAndStripHTML","showFormDialog","dialogFormContent"],provide:function(){var e=this;return{indicatorID_toRestore:(0,i.EW)((function(){return e.indicatorID_toRestore})),indicatorName_toRestore:(0,i.EW)((function(){return e.indicatorName_toRestore})),disabledAncestors:(0,i.EW)((function(){return e.disabledAncestors})),firstOrphanID:(0,i.EW)((function(){return e.firstOrphanID})),searchPending:(0,i.EW)((function(){return e.searchPending})),restoreField:this.restoreField,updateAppData:this.updateAppData}},created:function(){var e=this,t=fetch("".concat(this.APIroot,"form/indicator/list/disabled")).then((function(e){return e.json()})),n=fetch("".concat(this.APIroot,"form/indicator/list/unabridged?x-filterData=indicatorID,parentIndicatorID,isDisabled")).then((function(e){return e.json()}));Promise.all([t,n]).then((function(t){if(Array.isArray(null==t?void 0:t[0])){var n=t[0],i=[];n.map((function(t){+t.indicatorID>0&&(t.name=e.decodeAndStripHTML(t.name||"[ blank ]"),i.push(t))})),e.disabledFields=i}Array.isArray(null==t?void 0:t[1])&&t[1].filter((function(e){return+e.indicatorID>0&&0===+e.isDisabled})).forEach((function(t){return e.enabledFields[t.indicatorID]={indicatorID:t.indicatorID,parentIndicatorID:t.parentIndicatorID}})),e.loading=!1,e.initializeAppGrid()})).catch((function(e){return console.log(e)}))},beforeRouteEnter:function(e,t,n){n((function(e){e.setDefaultAjaxResponseMessage()}))},computed:{fieldParentIDLookup:function(){var e={},t=null;for(var n in this.disabledFields.forEach((function(n){null!==(t=n.parentIndicatorID)&&(e[n.indicatorID]=t)})),this.enabledFields)null!==(t=this.enabledFields[n].parentIndicatorID)&&(e[n]=t);return e},disabledFieldsLookup:function(){var e={};return this.disabledFields.forEach((function(t){return e[t.indicatorID]=d(d({},t),{},{recordID:t.indicatorID})})),e}},methods:{restoreFieldGate:function(e,t,n){var i=this;this.indicatorID_toRestore=e,this.indicatorName_toRestore=t,this.searchAncestorStates(n),!1===this.searchPending&&0===this.disabledAncestors.length&&null===this.firstOrphanID?this.restoreField(this.indicatorID_toRestore).then((function(){return i.updateAppData(e,1250)})).catch((function(e){return console.log(e)})):this.openRestoreFieldOptionsDialog()},restoreField:function(e){var t=new FormData;return t.append("CSRFToken",this.CSRFToken),t.append("disabled",0),fetch("".concat(this.APIroot,"formEditor/").concat(e,"/disabled"),{method:"POST",body:t})},getIndicator:function(e){return fetch("".concat(this.APIroot,"formEditor/indicator/").concat(e,"?x-filterData=indicatorID,parentID"))},updateTableIfNoResults:function(){var e=this;setTimeout((function(){var t=document.getElementById(e.formGrid.getPrefixID()+"tbody");0===e.disabledFields.length&&null!==t&&(t.innerHTML='<tr><td colspan="6" style="text-align: center">No Fields To Restore</td></tr>')}))},updateAppData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t>0){this.disabledFields=this.disabledFields.filter((function(e){return e.indicatorID!==t})),this.enabledFields[t]={indicatorID:t,parentIndicatorID:this.fieldParentIDLookup[t]},this.formGrid.setDataBlob(this.disabledFieldsLookup);var i=this.formGrid.getPrefixID()+"tbody",o=this.formGrid.getPrefixID()+"tbody_tr"+t,r=document.getElementById(i),l=document.getElementById(o);null!==r&&null!==l&&(l.innerHTML='<td colspan="6" style="text-align:center;">\n                        <b style="color:#064;">Field restored</b>\n                    </td>',setTimeout((function(){r.contains(l)&&r.removeChild(l),e.updateTableIfNoResults()}),n))}},searchAncestorStates:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.disabledAncestors=[],this.firstOrphanID=null;var n=null;if(null!==t){for(n=t;t>0;){var i,o;(null===(i=this.disabledFieldsLookup[t])||void 0===i?void 0:i.indicatorID)>0?(this.disabledAncestors.push(this.disabledFieldsLookup[t]),t=+this.fieldParentIDLookup[t]):(null===(o=this.enabledFields[t])||void 0===o?void 0:o.indicatorID)>0?t=+this.fieldParentIDLookup[t]:(this.firstOrphanID=t,t=0)}null!==this.firstOrphanID?this.getIndicator(this.firstOrphanID).then((function(t){return t.json().then((function(t){var i=null==t?void 0:t[e.firstOrphanID];if((null==i?void 0:i.indicatorID)>0){var o=i.parentID,r=i.indicatorID;e.enabledFields[r]={indicatorID:r,parentIndicatorID:o},e.searchAncestorStates(n)}else e.searchPending=!1})).catch((function(t){e.searchPending=!1,console.log(t)}))})):this.searchPending=!1}else this.searchPending=!1},initializeAppGrid:function(){var e=this;this.formGrid=new LeafFormGrid("restore_fields_grid",{}),this.formGrid.setRootURL("../"),this.formGrid.hideIndex(),this.formGrid.enableToolbar(),this.formGrid.setHeaders([{name:"IndicatorID&nbsp;",indicatorID:"indicatorID",editable:!1,callback:function(e,t){var n=document.getElementById(e.cellContainerID);null!==n&&(n.textContent=t[e.recordID].indicatorID)}},{name:"Form&nbsp;",indicatorID:"categoryName",editable:!1,callback:function(e,t){var n=document.getElementById(e.cellContainerID);null!==n&&(n.textContent=t[e.recordID].categoryName)}},{name:"Field Name&nbsp;",indicatorID:"name",editable:!1,callback:function(e,t){var n=document.getElementById(e.cellContainerID);null!==n&&(n.textContent=t[e.recordID].name)}},{name:"Input Format",indicatorID:"fomrat",editable:!1,callback:function(e,t){var n=document.getElementById(e.cellContainerID);null!==n&&(n.textContent=t[e.recordID].format)}},{name:"Status ",indicatorID:"disabled",editable:!1,sortable:!1,callback:function(e,t){var n=document.getElementById(e.cellContainerID);null!==n&&(n.textContent=t[e.recordID].disabled)}},{name:"Restore ",indicatorID:"restore",editable:!1,sortable:!1,callback:function(t,n){var i=document.getElementById(t.cellContainerID);if(null!==i){var o=n[t.recordID].indicatorID,r=n[t.recordID].parentIndicatorID,l=n[t.recordID].name;l.length>45&&(l=l.slice(0,42)+"..."),i.innerHTML='\n                                <button type="button" id="restore_indicator_'.concat(o,'"\n                                    class="btn-general" style="margin: auto;">\n                                    Restore this field\n                                </button>');var a=document.getElementById("restore_indicator_".concat(o));null!==a&&a.addEventListener("click",(function(){return e.restoreFieldGate(o,l,r)}))}}}]),Array.from(document.querySelectorAll("table > thead > tr > th")).forEach((function(e){e.style.padding="4px 8px",e.style.fontSize="1rem",e.style.fontWeight="bold"})),this.formGrid.setDataBlob(this.disabledFieldsLookup),this.formGrid.renderBody(),this.updateTableIfNoResults(),this.formGrid.setPostSortRequestFunc(this.updateTableIfNoResults)}},template:'<section id="restore_fields_view">\n            <h2 id="page_breadcrumbs">\n                <a href="../admin" class="leaf-crumb-link" title="to Admin Home">Admin</a>\n                <i class="fas fa-caret-right leaf-crumb-caret"></i>\n                <router-link :to="{ name: \'browser\' }" class="leaf-crumb-link" title="to Form Browser">Form Browser</router-link>\n                <i class="fas fa-caret-right leaf-crumb-caret"></i>Restore Fields\n            </h2>\n            <h3>List of disabled fields available for recovery</h3>\n            <div>Deleted fields and associated data will not display in the Report Builder.</div>\n            <div v-if="loading === true" class="page_loading">\n                Loading...\n                <img src="../images/largespinner.gif" alt="" />\n            </div>\n            <div id="restore_fields_grid"></div> \x3c!-- this won\'t work inside of else --\x3e\n\n            \x3c!-- DIALOGS --\x3e\n            <leaf-form-dialog v-if="showFormDialog">\n                <template #dialog-content-slot>\n                    <component :is="dialogFormContent"></component>\n                </template>\n            </leaf-form-dialog>\n        </section>'}}}]);