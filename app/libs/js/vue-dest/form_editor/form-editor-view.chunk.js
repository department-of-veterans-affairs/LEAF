"use strict";(self.webpackChunkleaf_vue=self.webpackChunkleaf_vue||[]).push([[245],{392:(e,t,o)=>{o.d(t,{A:()=>n});const n={data:function(){return{scrollY:window.scrollY,initialTop:15,modalElementID:"leaf_dialog_content",modalBackgroundID:"leaf-vue-dialog-background",elBody:null,elModal:null,elBackground:null,elClose:null,lastFocus:null}},inject:["dialogTitle","closeFormDialog","formSaveFunction","dialogButtonText","lastModalTab"],created:function(){this.lastFocus=document.activeElement||null},mounted:function(){this.elBody=document.querySelector("body"),this.elModal=document.getElementById(this.modalElementID),this.elModal.style.left=window.scrollX+window.innerWidth/2-this.elModal.clientWidth/2+"px",this.elBackground=document.getElementById(this.modalBackgroundID),this.elClose=document.getElementById("leaf-vue-dialog-close"),this.makeDraggable(this.elModal);var e=document.activeElement;null===(null!==e?e.closest(".leaf-vue-dialog-content"):null)&&this.elClose.focus()},beforeUnmount:function(){var e,t=(null===(e=this.lastFocus)||void 0===e?void 0:e.id)||null;if(null!==t){var o=document.getElementById(t);null!==o&&o.focus()}else null!==this.lastFocus&&this.lastFocus.focus()},methods:{firstTab:function(e){if(!0===(null==e?void 0:e.shiftKey)){var t=document.querySelector("#ifthen_deletion_dialog button.btn-general"),o=document.getElementById("next"),n=document.getElementById("button_cancelchange"),i=t||o||n;null!==i&&"function"==typeof i.focus&&(i.focus(),e.preventDefault())}},makeDraggable:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=0,n=0,i=0,r=0,a=function(e){(e=e||window.event).preventDefault(),o=i-e.clientX,n=r-e.clientY,i=e.clientX,r=e.clientY,t.style.top=t.offsetTop-n+"px",t.style.left=t.offsetLeft-o+"px",s()},l=function(){document.onmouseup=null,document.onmousemove=null},s=function(){t.offsetTop<window.scrollY&&(t.style.top=window.scrollY+"px"),t.offsetLeft<window.scrollX&&(t.style.left=window.scrollX+"px"),t.offsetLeft+t.clientWidth+18>window.innerWidth+window.scrollX&&(t.style.left=window.innerWidth+window.scrollX-t.clientWidth-18+"px"),e.elBackground.style.minWidth=e.elBody.clientWidth+"px",e.elBackground.style.minHeight=e.elModal.offsetTop+e.elBody.clientHeight+"px"};document.getElementById(this.modalElementID+"_drag_handle")&&(document.getElementById(this.modalElementID+"_drag_handle").onmousedown=function(e){(e=e||window.event).preventDefault(),i=e.clientX,r=e.clientY,document.onmouseup=l,document.onmousemove=a})}},template:'<Teleport to="body">\n        <div id="leaf-vue-dialog-background" aria-disabled="true" aria-hidden="true"></div>\n        <div :id="modalElementID" class="leaf-vue-dialog"\n            role="dialog" aria-modal="true" :aria-labelledby="modalElementID + \'_drag_handle\'" aria-describedby="record"\n            :style="{top: scrollY + initialTop + \'px\'}">\n            <div v-html="dialogTitle" :id="modalElementID + \'_drag_handle\'" class="leaf-vue-dialog-title"></div>\n            <button type="button" @click="closeFormDialog" @keydown.tab="firstTab" id="leaf-vue-dialog-close" aria-label="Close">&#10005;</button>\n            <div id="record" style="max-height:100vh;overflow-y:auto">\n                <div id="xhr" class="leaf-vue-dialog-content">\n                    <slot name="dialog-content-slot"></slot>\n                </div>\n                <div id="leaf-vue-dialog-cancel-save">\n                    <button type="button" style="width: 90px;"\n                        id="button_save" class="btn-confirm" :title="dialogButtonText.confirm"\n                        @click="formSaveFunction">\n                        {{dialogButtonText.confirm}}\n                    </button>\n                    <button type="button" style="width: 90px;"\n                        id="button_cancelchange" class="btn-general" :title="dialogButtonText.cancel"\n                        @click="closeFormDialog" @keydown.tab="lastModalTab">\n                        {{dialogButtonText.cancel}}\n                    </button>\n                </div>\n            </div>\n        </div>\n    </Teleport>'}},448:(e,t,o)=>{o.d(t,{A:()=>n});const n={name:"new-form-dialog",data:function(){return{requiredDataProperties:["parentID"],categoryName:"",categoryDescription:"",newFormParentID:this.dialogData.parentID}},inject:["APIroot","CSRFToken","decodeAndStripHTML","setDialogSaveFunction","dialogData","checkRequiredData","addNewCategory","closeFormDialog"],created:function(){this.checkRequiredData(this.requiredDataProperties),this.setDialogSaveFunction(this.onSave)},mounted:function(){document.getElementById("name").focus()},emits:["get-form"],computed:{nameCharsRemaining:function(){return Math.max(50-this.categoryName.length,0)},descrCharsRemaining:function(){return Math.max(255-this.categoryDescription.length,0)}},methods:{onSave:function(){var e=this,t=XSSHelpers.stripAllTags(this.categoryName),o=XSSHelpers.stripAllTags(this.categoryDescription);$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/new"),data:{name:t,description:o,parentID:this.newFormParentID,CSRFToken:this.CSRFToken},success:function(n){var i=n,r={};r.categoryID=i,r.categoryName=t,r.categoryDescription=o,r.parentID=e.newFormParentID,r.workflowID=0,r.needToKnow=0,r.visible=-1,r.sort=0,r.type="",r.stapledFormIDs=[],r.destructionAge=null,e.addNewCategory(i,r),""===e.newFormParentID?e.$router.push({name:"category",query:{formID:i}}):e.$emit("get-form",i),e.closeFormDialog()},error:function(e){console.log("error posting new form",e)}})}},template:'<div>\n            <div style="display: flex; justify-content: space-between;">\n                <label for="name">Form Name&nbsp;<span style="font-size:80%">(up to 50 characters)</span></label>\n                <div>{{nameCharsRemaining}}</div>\n            </div>\n            <input id="name" type="text" maxlength="50" v-model="categoryName" style="width: 100%;" />\n            <div style="display: flex; justify-content:space-between;margin-top: 1em;">\n                <label for="description">Form Description&nbsp;<span style="font-size:80%">(up to 255 characters)</span></label>\n                <div>{{descrCharsRemaining}}</div>\n            </div>\n            <textarea id="description" maxlength="255" rows="5" v-model="categoryDescription" \n                style="width: 100%; resize:none;">\n            </textarea>\n        </div>'}},211:(e,t,o)=>{o.r(t),o.d(t,{default:()=>E});var n=o(425),i=o(392);const r={name:"history-dialog",data:function(){return{requiredDataProperties:["historyType","historyID"],divSaveCancelID:"leaf-vue-dialog-cancel-save",page:1,historyType:this.dialogData.historyType,historyID:this.dialogData.historyID,ajaxRes:null}},inject:["dialogData","checkRequiredData","lastModalTab"],created:function(){this.checkRequiredData(this.requiredDataProperties)},mounted:function(){document.getElementById(this.divSaveCancelID).style.display="none",this.getPage()},computed:{showNext:function(){return null!==this.ajaxRes&&-1===this.ajaxRes.indexOf("No history to show")},showPrev:function(){return this.page>1}},methods:{getNext:function(){this.page++,this.getPage()},getPrev:function(){this.page--,this.getPage()},getPage:function(){var e=this;try{var t="ajaxIndex.php?a=gethistory&type=".concat(this.historyType,"&gethistoryslice=1&page=").concat(this.page,"&id=").concat(this.historyID);fetch(t).then((function(t){t.text().then((function(t){return e.ajaxRes=t}))}))}catch(e){console.log("error getting history",e)}}},template:'<div>\n        <div v-if="ajaxRes === null" class="page_loading">\n            Loading...\n            <img src="../images/largespinner.gif" alt="" />\n        </div>\n        <div v-else id="history-slice" v-html="ajaxRes" style="min-height: 100px; min-width: 300px;"></div>\n        <div id="history-page-buttons" style="display: flex; justify-content: space-between;">\n            <button v-if="showPrev" id="prev" type="button"\n                class="btn-general"\n                style="width: 125px;"\n                @click="getPrev" title="get previous page">\n                Previous page\n            </button>\n            <button v-if="showNext" id="next" type="button"\n                class="btn-general"\n                style="width: 125px; margin-left: auto;"\n                @click="getNext" @keydown.tab="lastModalTab" title="get next page">\n                Next page\n            </button>\n        </div>\n    </div>'},a={name:"indicator-editing-dialog",data:function(){var e,t,o,n,i,r,a,l,s,c,d,u,p,m,h,f;return{requiredDataProperties:["indicator","indicatorID","parentID"],initialFocusElID:"name",trumbowygTitleClassMap:{Formatting:"trumbowyg-dropdown-formatting",Link:"trumbowyg-dropdown-link","Text color":"trumbowyg-dropdown-foreColor"},showAdditionalOptions:!1,showDetailedFormatInfo:!1,formats:{text:"Single line text",textarea:"Multi-line text",grid:"Grid (Table with rows and columns)",number:"Numeric",currency:"Currency",date:"Date",radio:"Radio (single select, multiple options)",checkbox:"Checkbox (A single checkbox)",checkboxes:"Checkboxes (Multiple Checkboxes)",multiselect:"Multi-Select Dropdown",dropdown:"Dropdown Menu (single select, multiple options)",fileupload:"File Attachment",image:"Image Attachment",orgchart_group:"Orgchart Group",orgchart_position:"Orgchart Position",orgchart_employee:"Orgchart Employee",raw_data:"Raw Data (for programmers)"},formatInfo:{text:"A single input for short text entries.",textarea:"A large area for multiple lines of text and limited text formatting options.",grid:"A table format with rows and columns.  Additional rows can be added, removed, or moved during data entry.",number:"A single input used to store numeric data.  Useful for information that will be used for calculations.",currency:"A single input used to store currency values in dollars to two decimal places.",date:"Embeds a datepicker.",radio:"Radio buttons allow a single selection from multiple options.  All of the question's options will display.",checkbox:"A single checkbox is typically used for confirmation. The checkbox label text can be further customized.",checkboxes:"Checkboxes will allow the selection of multiple options.  All of the question's options will display.",multiselect:"Multi-Select format will allow the selection of several options from a selection box with a dropdown.  Only selected items will display.",dropdown:"A dropdown menu will allow one selection from multiple options.  Only the selected option will display.",fileupload:"File Attachment",image:"Similar to file upload, but only image format files will be shown during selection",orgchart_group:"Orgchart Group format is used to select a specific LEAF User Access Group",orgchart_position:"Orgchart Position format is used to select a specific LEAF user by their position in the orgchart",orgchart_employee:"Orgchart Employee format is used to select a specific LEAF user from the orgchart",raw_data:"Raw Data is associated with Advanced Options, which can be used by programmers to run custom code during form data entry or review"},listForParentIDs:[],isLoadingParentIDs:!0,multianswerFormats:["checkboxes","radio","multiselect","dropdown"],ariaTextEditorStatus:"",name:this.removeScriptTags(this.decodeHTMLEntities((null===(e=this.dialogData)||void 0===e||null===(e=e.indicator)||void 0===e?void 0:e.name)||"")),options:(null===(t=this.dialogData)||void 0===t||null===(t=t.indicator)||void 0===t?void 0:t.options)||[],format:(null===(o=this.dialogData)||void 0===o||null===(o=o.indicator)||void 0===o?void 0:o.format)||"",description:(null===(n=this.dialogData)||void 0===n||null===(n=n.indicator)||void 0===n?void 0:n.description)||"",defaultValue:this.decodeAndStripHTML((null===(i=this.dialogData)||void 0===i||null===(i=i.indicator)||void 0===i?void 0:i.default)||""),required:1===parseInt(null===(r=this.dialogData)||void 0===r||null===(r=r.indicator)||void 0===r?void 0:r.required)||!1,is_sensitive:1===parseInt(null===(a=this.dialogData)||void 0===a||null===(a=a.indicator)||void 0===a?void 0:a.is_sensitive)||!1,parentID:(null===(l=this.dialogData)||void 0===l?void 0:l.parentID)||null,sort:void 0!==(null===(s=this.dialogData)||void 0===s||null===(s=s.indicator)||void 0===s?void 0:s.sort)?parseInt(null===(c=this.dialogData)||void 0===c?void 0:c.indicator.sort):null,singleOptionValue:"checkbox"===(null===(d=this.dialogData)||void 0===d||null===(d=d.indicator)||void 0===d?void 0:d.format)?null===(u=this.dialogData)||void 0===u?void 0:u.indicator.options:"",multiOptionValue:["checkboxes","radio","multiselect","dropdown"].includes(null===(p=this.dialogData)||void 0===p||null===(p=p.indicator)||void 0===p?void 0:p.format)?((null===(m=this.dialogData)||void 0===m?void 0:m.indicator.options)||[]).join("\n"):"",gridJSON:"grid"===(null===(h=this.dialogData)||void 0===h||null===(h=h.indicator)||void 0===h?void 0:h.format)?JSON.parse(null===(f=this.dialogData)||void 0===f||null===(f=f.indicator)||void 0===f?void 0:f.options[0]):[],archived:!1,deleted:!1}},inject:["APIroot","CSRFToken","dialogData","checkRequiredData","setDialogSaveFunction","advancedMode","hasDevConsoleAccess","initializeOrgSelector","closeFormDialog","showLastUpdate","focusedFormRecord","focusedFormTree","getFormByCategoryID","truncateText","decodeAndStripHTML","orgchartFormats"],created:function(){this.setDialogSaveFunction(this.onSave),this.checkRequiredData(this.requiredDataProperties)},provide:function(){var e=this;return{gridJSON:(0,n.EW)((function(){return e.gridJSON})),updateGridJSON:this.updateGridJSON}},components:{GridCell:{name:"grid-cell",data:function(){var e,t,o,n,i,r;return{name:(null===(e=this.cell)||void 0===e?void 0:e.name)||"No title",id:(null===(t=this.cell)||void 0===t?void 0:t.id)||this.makeColumnID(),gridType:(null===(o=this.cell)||void 0===o?void 0:o.type)||"text",textareaDropOptions:null!==(n=this.cell)&&void 0!==n&&n.options?this.cell.options.join("\n"):[],file:(null===(i=this.cell)||void 0===i?void 0:i.file)||"",hasHeader:null!==(r=this.cell)&&void 0!==r&&r.hasHeader?1:0}},props:{cell:Object,column:Number},inject:["libsPath","gridJSON","updateGridJSON","fileManagerTextFiles"],mounted:function(){0===this.gridJSON.length&&this.updateGridJSON()},computed:{gridJSONlength:function(){return this.gridJSON.length}},methods:{makeColumnID:function(){return"col_"+(65536*(1+Math.random())|0).toString(16).substring(1)},deleteColumn:function(){var e,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).currentTarget.closest("div.cell"),o=document.getElementById("gridcell_col_parent"),n=Array.from(o.querySelectorAll("div.cell")),i=n.indexOf(t)+1,r=n.length;2===r?(t.remove(),r--,e=n[0]):(e=null===t.querySelector('[title="Move column right"]')?t.previousElementSibling.querySelector('[title="Delete column"]'):t.nextElementSibling.querySelector('[title="Delete column"]'),t.remove(),r--),document.getElementById("tableStatus").setAttribute("aria-label","column ".concat(i," removed, ").concat(r," total.")),e.focus(),this.updateGridJSON()},moveRight:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).currentTarget.closest("div.cell"),t=e.nextElementSibling,o=e.nextElementSibling.querySelector('[title="Move column right"]');t.after(e),setTimeout((function(){var t;null===(t=e.querySelector('[title="Move column '.concat(null===o?"left":"right",'"]')))||void 0===t||t.focus()}),0),document.getElementById("tableStatus").setAttribute("aria-label","Moved right to column ".concat(this.column+1," of ").concat(this.gridJSONlength)),this.updateGridJSON()},moveLeft:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).currentTarget.closest("div.cell"),t=e.previousElementSibling,o=e.previousElementSibling.querySelector('[title="Move column left"]');t.before(e),setTimeout((function(){var t;null===(t=e.querySelector('[title="Move column '.concat(null===o?"right":"left",'"]')))||void 0===t||t.focus()}),0),document.getElementById("tableStatus").setAttribute("aria-label","Moved left to column ".concat(this.column-1," of ").concat(this.gridJSONlength)),this.updateGridJSON()}},watch:{gridJSONlength:function(e,t){e>t&&document.getElementById("tableStatus").setAttribute("aria-label","Added a new column, ".concat(this.gridJSONlength," total."))}},template:'<div :id="id" class="cell">\n        <img v-if="column !== 1" role="button" tabindex="0"\n            @click="moveLeft" @keypress.space.enter.prevent="moveLeft"\n            :src="libsPath + \'dynicons/svg/go-previous.svg\'" style="width: 16px; cursor: pointer"\n            title="Move column left" alt="Move column left"  />\n        <img v-if="column !== gridJSON.length" role="button" tabindex="0" \n            @click="moveRight"  @keypress.space.enter.prevent="moveRight" \n            :src="libsPath + \'dynicons/svg/go-next.svg\'" style="width: 16px; cursor: pointer"\n            title="Move column right" alt="Move column right" /><br />\n        <span class="columnNumber">\n            <span>Column #{{column}}:</span>\n            <img v-if="gridJSON.length !== 1" role="button" tabindex="0"\n            @click="deleteColumn" @keypress.space.enter.prevent="deleteColumn"\n            :src="libsPath + \'dynicons/svg/process-stop.svg\'" style="width: 16px; cursor: pointer"\n            title="Delete column" alt="Delete column" />\n        </span>\n        <label :for="\'gridcell_title_\' + id">Title:</label>\n        <input type="text" v-model="name" :id="\'gridcell_title_\' + id" />\n        <label :for="\'gridcell_type_\' + id">Type:</label>\n        <select v-model="gridType" :id="\'gridcell_type_\' + id">\n            <option value="text">Single line input</option>\n            <option value="date">Date</option>\n            <option value="dropdown">Drop Down</option>\n            <option value="dropdown_file">Dropdown From File</option>\n            <option value="textarea">Multi-line text</option>\n        </select>\n        <div v-show="gridType === \'dropdown\'">\n            <label for="\'gridcell_options_\' + id">One option per line</label>\n            <textarea :id="\'gridcell_options_\' + id" \n                v-model="textareaDropOptions"\n                aria-label="Dropdown options, one option per line"\n                style="width: 100%; height: 60px; resize:vertical">\n            </textarea>\n        </div>\n        <div v-show="gridType === \'dropdown_file\'">\n            <label :for="\'dropdown_file_select_\' + id">File (csv or txt format)</label>\n            <select :id="\'dropdown_file_select_\' + id" v-model="file">\n                <option value="">Select a File</option>\n                <option v-for="f in fileManagerTextFiles" :key="\'file_\' + f" :value="f">{{f}}</option>\n            </select>\n            <label :for="\'dropdown_file_header_select_\' + id">Does file contain headers</label>\n            <select :id="\'dropdown_file_header_select_\' + id" v-model="hasHeader">\n                <option :value="0">No</option>\n                <option :value="1">Yes</option>\n            </select>\n        </div>\n    </div>'},IndicatorPrivileges:{name:"indicator-privileges",data:function(){return{allGroups:[],groupsWithPrivileges:[],group:0,statusMessageError:"",ariaGroupStatus:""}},props:{indicatorID:{type:Number,required:!0}},inject:["APIroot","CSRFToken","showLastUpdate","focusedFormRecord","getFormByCategoryID"],mounted:function(){var e=this,t=[$.ajax({type:"GET",url:"".concat(this.APIroot,"system/groups"),success:function(t){e.allGroups=t},error:function(e){return console.log(e)}}),$.ajax({type:"GET",url:"".concat(this.APIroot,"formEditor/indicator/").concat(this.indicatorID,"/privileges"),success:function(t){e.groupsWithPrivileges=t},error:function(t){console.log(t),e.statusMessageError="There was an error retrieving the Indicator Privileges. Please try again."}})];Promise.all(t).then((function(e){})).catch((function(e){return console.log("an error has occurred",e)}))},computed:{availableGroups:function(){var e=[];return this.groupsWithPrivileges.map((function(t){return e.push(parseInt(t.id))})),this.allGroups.filter((function(t){return!e.includes(parseInt(t.groupID))}))},formID:function(){var e;return(null===(e=this.focusedFormRecord)||void 0===e?void 0:e.categoryID)||""}},methods:{removeIndicatorPrivilege:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";0!==t&&$.ajax({method:"POST",url:"".concat(this.APIroot,"formEditor/indicator/").concat(this.indicatorID,"/privileges/remove"),data:{groupID:t,CSRFToken:this.CSRFToken},success:function(n){e.groupsWithPrivileges=e.groupsWithPrivileges.filter((function(e){return e.id!==t})),e.ariaGroupStatus="removed group id ".concat(t,", ").concat(o),e.getFormByCategoryID(e.formID),e.showLastUpdate("form_properties_last_update")},error:function(e){return console.log(e)}})},addIndicatorPrivilege:function(){var e=this;0!==this.group&&$.ajax({method:"POST",url:"".concat(this.APIroot,"formEditor/indicator/").concat(this.indicatorID,"/privileges"),data:{groupIDs:[this.group.groupID],CSRFToken:this.CSRFToken},success:function(){e.groupsWithPrivileges.push({id:e.group.groupID,name:e.group.name}),e.ariaGroupStatus="added group id ".concat(e.group.groupID,", ").concat(e.group.name),e.group=0,e.getFormByCategoryID(e.formID),e.showLastUpdate("form_properties_last_update")},error:function(e){return console.log("an error occurred while setting group access restrictions",e)}})}},template:'<fieldset id="indicatorPrivileges"  style="font-size: 90%; border-radius: 3px;">\n                <legend style="font-family: PublicSans-Bold">Special access restrictions</legend>\n                <div>\n                    This prevents anyone from reading stored data unless they\'re part of the following groups.<br/> \n                    If a group is assigned below, everyone else will see "[protected data]".\n                </div>\n                <template v-if="statusMessageError === \'\'">\n                    <div id="status_group_privs" role="status" :aria-label="ariaGroupStatus" style="position:absolute;opacity:0;" aria-live="assertive"></div>\n                    <div v-if="groupsWithPrivileges.length === 0" style="margin:0.5rem 0">No special access restrictions are enabled. Normal access rules apply.</div>\n                    <div v-else style="margin:0.5rem 0">\n                        <div style="color: #a00;">Special access restrictions are enabled.</div>\n                        <ul>\n                            <li v-for="g in groupsWithPrivileges" :key="g.name + g.id">\n                                {{g.name}}\n                                <button type="button" @click="removeIndicatorPrivilege(parseInt(g.id), g.name)"\n                                    style="margin-left: 3px; background-color: transparent; color:#a00; padding: 0.1em 0.2em; border: 0; border-radius:3px;" \n                                    :title="\'remove \' + g.name" :aria-label="\'remove \' + g.name">\n                                    <b>[ Remove ]</b>\n                                </button>\n                            </li>\n                        </ul>\n                    </div>\n                </template>\n                <div v-else>{{ statusMessageError }}</div>\n                <label for="selectIndicatorPrivileges" style="">What group should have access to this field?</label>\n                <div style="display: flex; align-items: center;">\n                    <select id="selectIndicatorPrivileges" v-model="group" style="width:260px;">\n                        <option :value="0">Select a Group</option>\n                        <option v-for="g in availableGroups" :value="g" :key="\'avail_\' + g.groupID">{{g.name}} (id{{g.groupID}})</option>\n                    </select>\n                    <button type="button" class="btn-general" @click="addIndicatorPrivilege"\n                    :aria-label="\'Add group \' + (group?.name || \', no group selected\')" style="margin-left: 3px; align-self:stretch;">\n                        Add group\n                    </button>\n                </div>\n            </fieldset>'}},mounted:function(){var e=this;if(!0===this.isEditingModal&&this.getFormParentIDs().then((function(t){e.listForParentIDs=t,e.isLoadingParentIDs=!1})).catch((function(e){return console.log("an error has occurred",e)})),null===this.sort&&(this.sort=this.newQuestionSortValue),this.containsRichText(this.name)?(document.getElementById("advNameEditor").click(),document.querySelector(".trumbowyg-editor").focus()):document.getElementById(this.initialFocusElID).focus(),this.orgchartFormats.includes(this.format)){var t=this.format.slice(this.format.indexOf("_")+1);this.initializeOrgSelector(t,this.indicatorID,"modal_",this.defaultValue,this.setOrgSelDefaultValue);var o=document.querySelector("#modal_orgSel_".concat(this.indicatorID," input"));null!==o&&o.addEventListener("change",(function(t){""===t.target.value.trim()&&(e.defaultValue="")}))}},computed:{isEditingModal:function(){return+this.indicatorID>0},indicatorID:function(){var e;return(null===(e=this.dialogData)||void 0===e?void 0:e.indicatorID)||null},formID:function(){var e;return(null===(e=this.focusedFormRecord)||void 0===e?void 0:e.categoryID)||""},nameLabelText:function(){return null===this.parentID?"Section Heading":"Field Name"},showFormatSelect:function(){return null!==this.parentID||!0===this.advancedMode||""!==this.format||hasDevConsoleAccess},showDefaultTextarea:function(){return!["","raw_data","fileupload","image","grid","checkboxes","multiselect"].includes(this.format)},shortLabelTriggered:function(){return this.name.trim().split(" ").length>2||this.containsRichText(this.name)||hasDevConsoleAccess},formatBtnText:function(){return this.showDetailedFormatInfo?"Hide Details":"What's this?"},isMultiOptionQuestion:function(){return this.multianswerFormats.includes(this.format)},fullFormatForPost:function(){var e=this.format;switch(this.format.toLowerCase()){case"grid":this.updateGridJSON(),e=e+"\n"+JSON.stringify(this.gridJSON);break;case"radio":case"checkboxes":case"multiselect":case"dropdown":e=e+"\n"+this.formatIndicatorMultiAnswer();break;case"checkbox":e=e+"\n"+this.singleOptionValue}return e},shortlabelCharsRemaining:function(){return 50-this.description.length},newQuestionSortValue:function(){var e="#drop_area_parent_".concat(this.parentID," > li");return null===this.parentID?this.focusedFormTree.length-128:Array.from(document.querySelectorAll(e)).length-128}},methods:{containsRichText:function(e){return XSSHelpers.containsTags(e,["<b>","<i>","<u>","<ol>","<li>","<br>","<p>","<td>","<h1>","<h2>","<h3>","<h4>","<a>","<blockquote>"])},decodeHTMLEntities:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},removeScriptTags:function(e){var t=document.createElement("div");t.innerHTML=e;for(var o=t.getElementsByTagName("script"),n=0;n<o.length;n++)o[n].remove();return t.innerHTML},setOrgSelDefaultValue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0!==e.selection&&(this.defaultValue=e.selection.toString())},toggleSelection:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"showDetailedFormatInfo";"boolean"==typeof this[t]&&(this[t]=!this[t])},getFormParentIDs:function(){var e=this;return new Promise((function(t,o){$.ajax({type:"GET",url:"".concat(e.APIroot,"/form/_").concat(e.formID,"/flat"),success:function(e){for(var o in e)e[o][1].name=XSSHelpers.stripAllTags(e[o][1].name);t(e)},error:function(e){return o(e)}})}))},preventSelectionIfFormatNone:function(){""!==this.format||!0!==this.required&&!0!==this.is_sensitive||(this.required=!1,this.is_sensitive=!1,alert('You can\'t mark a field as sensitive or required if the Input Format is "None".'))},onSave:function(){var e=this,t=document.querySelector(".trumbowyg-editor");null!=t&&(this.name=t.innerHTML);var o=[];if(this.isEditingModal){var n,i,r,a,l,s,c,d,u,p=this.name!==(null===(n=this.dialogData)||void 0===n?void 0:n.indicator.name),m=this.description!==(null===(i=this.dialogData)||void 0===i?void 0:i.indicator.description),h=null!==(r=this.dialogData)&&void 0!==r&&null!==(r=r.indicator)&&void 0!==r&&r.options?"\n"+(null===(a=this.dialogData)||void 0===a||null===(a=a.indicator)||void 0===a||null===(a=a.options)||void 0===a?void 0:a.join("\n")):"",f=this.fullFormatForPost!==(null===(l=this.dialogData)||void 0===l?void 0:l.indicator.format)+h,v=this.decodeAndStripHTML(this.defaultValue)!==this.decodeAndStripHTML(null===(s=this.dialogData)||void 0===s?void 0:s.indicator.default),g=+this.required!==parseInt(null===(c=this.dialogData)||void 0===c?void 0:c.indicator.required),y=+this.is_sensitive!==parseInt(null===(d=this.dialogData)||void 0===d?void 0:d.indicator.is_sensitive),b=this.parentID!==(null===(u=this.dialogData)||void 0===u?void 0:u.indicator.parentID),I=!0===this.archived,D=!0===this.deleted;p&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/name"),data:{name:this.name,CSRFToken:this.CSRFToken},error:function(e){return console.log("ind name post err",e)}})),m&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/description"),data:{description:this.description,CSRFToken:this.CSRFToken},error:function(e){return console.log("ind desciption post err",e)}})),f&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/format"),data:{format:this.fullFormatForPost,CSRFToken:this.CSRFToken},success:function(e){"size limit exceeded"===e&&alert("The input format was not saved because it was too long.\nIf you require extended length, please submit a YourIT ticket.")},error:function(e){return console.log("ind format post err",e)}})),v&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/default"),data:{default:this.defaultValue,CSRFToken:this.CSRFToken},error:function(e){return console.log("ind default value post err",e)}})),g&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/required"),data:{required:this.required?1:0,CSRFToken:this.CSRFToken},error:function(e){return console.log("ind required post err",e)}})),y&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/sensitive"),data:{is_sensitive:this.is_sensitive?1:0,CSRFToken:this.CSRFToken},error:function(e){return console.log("ind is_sensitive post err",e)}})),y&&!0===this.is_sensitive&&1!=+this.focusedFormRecord.needToKnow&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/formNeedToKnow"),data:{needToKnow:1,categoryID:this.formID,CSRFToken:this.CSRFToken},success:function(){var e=document.querySelector("select#needToKnow");null!==e&&(e.value=1,e.dispatchEvent(new Event("change")))},error:function(e){return console.log("set form need to know post err",e)}})),I&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/disabled"),data:{disabled:1,CSRFToken:this.CSRFToken},success:function(){},error:function(e){return console.log("ind disabled (archive) post err",e)}})),D&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/disabled"),data:{disabled:2,CSRFToken:this.CSRFToken},success:function(){},error:function(e){return console.log("ind disabled (deletion) post err",e)}})),b&&this.parentID!==this.indicatorID&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/parentID"),data:{parentID:this.parentID,CSRFToken:this.CSRFToken},error:function(e){return console.log("ind parentID post err",e)}}))}else this.is_sensitive&&1!=+this.focusedFormRecord.needToKnow&&o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/formNeedToKnow"),data:{needToKnow:1,categoryID:this.formID,CSRFToken:this.CSRFToken},success:function(){var e=document.querySelector("select#needToKnow");null!==e&&(e.value=1,e.dispatchEvent(new Event("change")))},error:function(e){return console.log("set form need to know post err",e)}})),o.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/newIndicator"),data:{name:this.name,format:this.fullFormatForPost,description:this.description,default:this.defaultValue,parentID:this.parentID,categoryID:this.formID,required:this.required?1:0,is_sensitive:this.is_sensitive?1:0,sort:this.newQuestionSortValue,CSRFToken:this.CSRFToken},success:function(e){},error:function(e){return console.log("error posting new question",e)}}));Promise.all(o).then((function(t){t.length>0&&(e.getFormByCategoryID(e.formID),e.showLastUpdate("form_properties_last_update")),e.closeFormDialog()})).catch((function(e){return console.log("an error has occurred",e)}))},radioBehavior:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null==e?void 0:e.target.id;"archived"===t.toLowerCase()&&this.deleted&&(document.getElementById("deleted").checked=!1,this.deleted=!1),"deleted"===t.toLowerCase()&&this.archived&&(document.getElementById("archived").checked=!1,this.archived=!1)},appAddCell:function(){this.gridJSON.push({})},formatGridDropdown:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(null!==e&&0!==e.length){var o=e.replaceAll(/,/g,"").split("\n");o=(o=o.map((function(e){return e.trim()}))).map((function(e){return"no"===e?"No":e})),t=Array.from(new Set(o))}return t},updateGridJSON:function(){var e=this,t=[],o=document.getElementById("gridcell_col_parent");Array.from(o.querySelectorAll("div.cell")).forEach((function(o){var n,i,r,a,l=o.id,s=((null===(n=document.getElementById("gridcell_type_"+l))||void 0===n?void 0:n.value)||"").toLowerCase(),c=new Object;if(c.id=l,c.name=(null===(i=document.getElementById("gridcell_title_"+l))||void 0===i?void 0:i.value)||"No Title",c.type=s,"dropdown"===s){var d=document.getElementById("gridcell_options_"+l);c.options=e.formatGridDropdown(d.value||"")}"dropdown_file"===s&&(c.file=(null===(r=document.getElementById("dropdown_file_select_"+l))||void 0===r?void 0:r.value)||"",c.hasHeader=Boolean(+(null===(a=document.getElementById("dropdown_file_header_select_"+l))||void 0===a?void 0:a.value))),t.push(c)})),this.gridJSON=t},formatIndicatorMultiAnswer:function(){var e=this.multiOptionValue.split("\n");return e=(e=e.map((function(e){return e.trim()}))).map((function(e){return"no"===e?"No":e})),Array.from(new Set(e)).join("\n")},advNameEditorClick:function(){var e=this;$("#advNameEditor").css("display","none"),$("#rawNameEditor").css("display","block"),$("#name").trumbowyg({resetCss:!0,btns:["formatting","bold","italic","underline","|","unorderedList","orderedList","|","link","|","foreColor","|","justifyLeft","justifyCenter","justifyRight"]}),$(".trumbowyg-box").css({"min-height":"130px","max-width":"700px",margin:"0.5rem 0"}),$(".trumbowyg-editor, .trumbowyg-texteditor").css({"min-height":"100px","max-width":"695px","min-width":"506px",height:"100px",padding:"1rem",resize:"both"});var t=Array.from(document.querySelectorAll(".trumbowyg-box button")),o=function(t){var o=t.currentTarget,n=o.classList.contains("trumbowyg-open-dropdown"),i=o.classList.contains("trumbowyg-active");if(13!==(null==t?void 0:t.which)&&32!==(null==t?void 0:t.which)||(o.dispatchEvent(new Event("mousedown")),t.preventDefault(),n&&o.setAttribute("aria-expanded",!i)),9===(null==t?void 0:t.which)){var r=document.querySelector('button[aria-controls="'.concat(o.parentNode.id,'"]')),a=n?"id_".concat(e.trumbowygTitleClassMap[o.title]):"".concat(o.parentNode.id);if(""!==a){var l=document.querySelector("#".concat(a," button")),s=document.querySelector("#".concat(a," button:last-child"));if(!1===t.shiftKey&&n&&i&&null!==l&&(l.focus(),t.preventDefault()),!1===t.shiftKey&&o===s){var c,d=(null==r||null===(c=r.parentNode)||void 0===c?void 0:c.nextSibling)||null;if(null!==d){var u=d.querySelector("button");null!==u&&(u.focus(),t.preventDefault(),r.dispatchEvent(new Event("mousedown")),r.setAttribute("aria-expanded",!1))}}!0===t.shiftKey&&o===l&&null!==r&&(r.focus(),t.preventDefault())}}"click"===t.type&&n&&o.setAttribute("aria-expanded",i)};t.forEach((function(t){if(t.setAttribute("tabindex","0"),["keydown","click"].forEach((function(e){return t.addEventListener(e,o)})),t.classList.contains("trumbowyg-open-dropdown")){var n;t.setAttribute("aria-expanded",!1);var i=(null===(n=e.trumbowygTitleClassMap)||void 0===n?void 0:n[t.title])||null;if(null!==i){t.setAttribute("aria-controls","id_"+i);var r=document.querySelector("."+i);null!==r&&r.setAttribute("id","id_"+i)}}})),this.ariaTextEditorStatus="Using Advanced formatting.",document.getElementById("rawNameEditor").focus()},rawNameEditorClick:function(){$("#advNameEditor").css("display","block"),$("#rawNameEditor").css("display","none"),$("#name").trumbowyg("destroy"),this.ariaTextEditorStatus="Showing formatted code.",document.getElementById("advNameEditor").focus()}},watch:{format:function(e,t){var o=this;if(this.defaultValue="",this.orgchartFormats.includes(e)){var n=e.slice(e.indexOf("_")+1);this.initializeOrgSelector(n,this.indicatorID,"modal_","",this.setOrgSelDefaultValue);var i=document.querySelector("#modal_orgSel_".concat(this.indicatorID," input"));null!==i&&i.addEventListener("change",(function(e){""===e.target.value.trim()&&(o.defaultValue="")}))}}},template:'<div id="indicator-editing-dialog-content">\n        <div>\n            <div role="status" aria-live="assertive" :aria-label="ariaTextEditorStatus" style="display:absolute;opacity:0;"></div>\n            <label for="name">{{ nameLabelText }}</label>\n            <textarea id="name" v-model="name" rows="4">{{name}}</textarea>\n            <button type="button" class="btn-general" id="rawNameEditor"\n                title="use basic text editor"\n                @click="rawNameEditorClick" style="display: none; width:135px">\n                Show formatted code\n            </button>\n            <button type="button" class="btn-general" id="advNameEditor"\n                title="use advanced text editor" style="width:135px"\n                @click="advNameEditorClick">\n                Advanced Formatting\n            </button>\n        </div>\n        <div v-show="description !== \'\' || shortLabelTriggered">\n            <label for="description" style="justify-content:space-between;">Short label for spreadsheet headings\n                <span :aria-label="\'max length 50 characters, \' + shortlabelCharsRemaining + \' remaining\'">({{shortlabelCharsRemaining}})</span>\n            </label>\n            <input type="text" id="description" v-model="description" maxlength="50" />\n        </div>\n        <div>\n            <div v-if="showFormatSelect">\n                <label for="indicatorType">Input Format</label>\n                <div style="display:flex;">\n                    <select id="indicatorType" title="Select a Format" v-model="format" @change="preventSelectionIfFormatNone">\n                        <option value="">None</option>\n                        <option v-for="kv in Object.entries(formats)" \n                        :value="kv[0]" :selected="kv[0] === format" :key="kv[0]">{{ kv[1] }}</option>\n                    </select>\n                    <button type="button" id="editing-format-assist" class="btn-general" aria-controls="formatDetails" :aria-expanded="showDetailedFormatInfo"\n                        @click="toggleSelection($event, \'showDetailedFormatInfo\')" aria-label="show information about the selected format"\n                        title="assistance with format choices" style="align-self:stretch; margin-left: 3px;">\n                        {{ formatBtnText }}\n                    </button>\n                </div>\n                <div v-show="showDetailedFormatInfo" id="formatDetails" style="max-width:500px; font-size: 0.9rem; margin-bottom: 1rem;">\n                    <p><b>Format Information</b></p>\n                    {{ format !== \'\' ? formatInfo[format] : \'No format.  Indicators without a format are often used to provide additional information for the user.  They are often used for form section headers.\' }}\n                </div>\n            </div>\n            <div v-show="format === \'checkbox\'" id="container_indicatorSingleAnswer" style="margin-top:0.5rem;">\n                <label for="indicatorSingleAnswer">Text for checkbox</label>\n                <input type="text" id="indicatorSingleAnswer" v-model="singleOptionValue"/>\n            </div>\n            <div v-show="isMultiOptionQuestion" id="container_indicatorMultiAnswer" style="margin-top:0.5rem;">\n                <label for="indicatorMultiAnswer">Options (One option per line)</label>\n                <textarea id="indicatorMultiAnswer" v-model="multiOptionValue" style="height: 130px;">\n                </textarea>\n            </div>\n            <div v-if="format === \'grid\'" id="container_indicatorGrid">\n                <span id="tableStatus" style="position: absolute; color: transparent" \n                    aria-atomic="true" aria-live="polite"  role="status"></span>\n                <br/>\n                <div style="display:flex; align-items: center;">\n                    <button type="button" class="btn-general" id="addColumnBtn" title="Add column" \n                        @click="appAddCell">\n                        + Add column\n                    </button>&nbsp;Columns ({{gridJSON.length}}):\n                </div>\n                <div style="overflow-x: auto;" id="gridcell_col_parent">\n                    <grid-cell v-if="gridJSON.length === 0" :column="1" :cell="new Object()" key="initial_cell"></grid-cell>\n                    <grid-cell v-for="(c,i) in gridJSON" :column="i+1" :cell="c" :key="c.id"></grid-cell>\n                </div>\n            </div>\n            <div v-show="showDefaultTextarea" style="margin-top:0.75rem;">\n                <label for="defaultValue">Default Answer</label>\n                <div v-show="orgchartFormats.includes(format)"\n                    :id="\'modal_orgSel_\' + indicatorID"\n                    style="min-height:30px" aria-labelledby="defaultValue">\n                </div>\n                <textarea v-show="!orgchartFormats.includes(format)" id="defaultValue" v-model="defaultValue"></textarea>\n            </div>\n        </div>\n        <div v-show="!(!isEditingModal && format === \'\')" id="indicator-editing-attributes">\n            <b>Attributes</b>\n            <div class="attribute-row">\n                <template v-if="format !== \'\'">\n                    <label class="checkable leaf_check" for="required" style="margin-right: 1.5rem;">\n                        <input type="checkbox" id="required" v-model="required" name="required" class="icheck leaf_check"  \n                            @change="preventSelectionIfFormatNone" />\n                        <span class="leaf_check"></span>Required\n                    </label>\n                    <label class="checkable leaf_check" for="sensitive" style="margin-right: 4rem;">\n                        <input type="checkbox" id="sensitive" v-model="is_sensitive" name="sensitive" class="icheck leaf_check"  \n                            @change="preventSelectionIfFormatNone" />\n                        <span class="leaf_check"></span>Sensitive Data (PHI/PII)\n                    </label>\n                </template>\n                <template v-if="isEditingModal">\n                    <label class="checkable leaf_check" for="archived" style="margin-right: 1.5rem;">\n                        <input type="checkbox" id="archived" name="disable_or_delete" class="icheck leaf_check"  \n                            v-model="archived" @change="radioBehavior" />\n                        <span class="leaf_check"></span>Archive\n                    </label>\n                    <label class="checkable leaf_check" for="deleted">\n                        <input type="checkbox" id="deleted" name="disable_or_delete" class="icheck leaf_check"  \n                            v-model="deleted" @change="radioBehavior" />\n                        <span class="leaf_check"></span>Delete\n                    </label>\n                </template>\n            </div>\n            <button v-if="isEditingModal" type="button" aria-controls="indicator_advanced_attributes" :aria-expanded="showAdditionalOptions"\n                class="btn-general" \n                aria-label="edit additional options"\n                @click="toggleSelection($event, \'showAdditionalOptions\')">\n                {{showAdditionalOptions ? \'Hide\' : \'Show\'}} Advanced Attributes\n            </button>\n            <div id="indicator_advanced_attributes" v-if="showAdditionalOptions">\n                <div class="attribute-row" style="margin-top: 1rem; justify-content: space-between;">\n                    <template v-if="isLoadingParentIDs === false">\n                        <label for="container_parentID" style="margin-right: 1rem;">Parent Question ID\n                            <select v-model.number="parentID" id="container_parentID" style="width:250px; margin-left:3px;">\n                                <option :value="null" :selected="parentID === null">None</option> \n                                <template v-for="kv in Object.entries(listForParentIDs)">\n                                    <option v-if="indicatorID !== parseInt(kv[0])" \n                                        :value="kv[0]" \n                                        :key="\'parent_\'+kv[0]">\n                                        {{kv[0]}}: {{truncateText(kv[1][\'1\'].name), 50}}\n                                    </option>\n                                </template>\n                            </select>\n                        </label>\n                    </template>\n                </div>\n                <indicator-privileges :indicatorID="indicatorID"></indicator-privileges>\n            </div>\n            <span v-show="archived" id="archived-warning">\n                This field will be archived. &nbsp;It can be<br/>re-enabled by using Restore Fields.\n            </span>\n            <span v-show="deleted" id="deletion-warning">\n                Deleted items can only be re-enabled<br />within 30 days by using Restore Fields.\n            </span>\n        </div>\n    </div>'},l={name:"advanced-options-dialog",data:function(){var e,t;return{requiredDataProperties:["indicatorID","html","htmlPrint"],initialFocusElID:"#advanced legend",left:"{{",right:"}}",codeEditorHtml:{},codeEditorHtmlPrint:{},html:(null===(e=this.dialogData)||void 0===e?void 0:e.html)||"",htmlPrint:(null===(t=this.dialogData)||void 0===t?void 0:t.htmlPrint)||""}},inject:["APIroot","libsPath","CSRFToken","setDialogSaveFunction","dialogData","checkRequiredData","closeFormDialog","focusedFormRecord","getFormByCategoryID","hasDevConsoleAccess"],created:function(){this.setDialogSaveFunction(this.onSave),this.checkRequiredData(this.requiredDataProperties)},mounted:function(){var e;null===(e=document.querySelector(this.initialFocusElID))||void 0===e||e.focus(),this.hasDevConsoleAccess&&this.setupAdvancedOptions()},computed:{indicatorID:function(){var e;return null===(e=this.dialogData)||void 0===e?void 0:e.indicatorID},formID:function(){return this.focusedFormRecord.categoryID}},methods:{setupAdvancedOptions:function(){var e=this;this.codeEditorHtml=CodeMirror.fromTextArea(document.getElementById("html"),{mode:"htmlmixed",lineNumbers:!0,extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){if(e.getOption("fullScreen"))e.setOption("fullScreen",!1);else{var t={Tab:!1,"Shift-Tab":!1};e.addKeyMap(t),setTimeout((function(){e.removeKeyMap(t)}),2500)}},"Ctrl-S":function(t){e.saveCodeHTML()}}}),this.addCodeMirrorAria("html","codemirror_html_label"),this.codeEditorHtmlPrint=CodeMirror.fromTextArea(document.getElementById("htmlPrint"),{mode:"htmlmixed",lineNumbers:!0,extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){if(e.getOption("fullScreen"))e.setOption("fullScreen",!1);else{var t={Tab:!1,"Shift-Tab":!1};e.addKeyMap(t),setTimeout((function(){e.removeKeyMap(t)}),2500)}},"Ctrl-S":function(t){e.saveCodeHTMLPrint()}}}),this.addCodeMirrorAria("htmlPrint","codemirror_htmlPrint_label"),$(".CodeMirror").css("border","1px solid black")},addCodeMirrorAria:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=document.querySelector("#".concat(e," + .CodeMirror textarea"));null!==o&&(o.setAttribute("id",t),o.setAttribute("role","textbox"),o.setAttribute("aria-multiline",!0),o.setAttribute("aria-label","Coding area.  Press escape twice followed by tab to navigate out."))},saveCodeHTML:function(){var e=this,t=this.codeEditorHtml.getValue();$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/html"),data:{html:t,CSRFToken:this.CSRFToken},success:function(){e.html=t;var o=(new Date).toLocaleTimeString();document.getElementById("codeSaveStatus_html").innerHTML=", Last saved: "+o,e.getFormByCategoryID(e.formID)},error:function(e){return console.log(e)}})},saveCodeHTMLPrint:function(){var e=this,t=this.codeEditorHtmlPrint.getValue();$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/htmlPrint"),data:{htmlPrint:t,CSRFToken:this.CSRFToken},success:function(){e.htmlPrint=t;var o=(new Date).toLocaleTimeString();document.getElementById("codeSaveStatus_htmlPrint").innerHTML=", Last saved: "+o,e.getFormByCategoryID(e.formID)},error:function(e){return console.log(e)}})},onSave:function(){var e=this,t=[],o=this.html!==this.codeEditorHtml.getValue(),n=this.htmlPrint!==this.codeEditorHtmlPrint.getValue();o&&t.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/html"),data:{html:this.codeEditorHtml.getValue(),CSRFToken:this.CSRFToken},success:function(){},error:function(e){return console.log("ind html post err",e)}})),n&&t.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.indicatorID,"/htmlPrint"),data:{htmlPrint:this.codeEditorHtmlPrint.getValue(),CSRFToken:this.CSRFToken},success:function(){},error:function(e){return console.log("ind htmlPrint post err",e)}})),Promise.all(t).then((function(t){e.closeFormDialog(),t.length>0&&e.getFormByCategoryID(e.formID)})).catch((function(e){return console.log("an error has occurred",e)}))}},template:'<div v-if="hasDevConsoleAccess" id="advanced_options_dialog_content">\n            <fieldset id="advanced"><legend tabindex="0">Template Variables and Controls</legend>\n                <table class="table">\n                    <tr>\n                        <td><b style="white-space: nowrap;">{{ left }} iID {{ right }}</b></td>\n                        <td>The indicatorID # of the current data field.</td>\n                        <td><b>Ctrl-S</b></td>\n                        <td>Save the focused section</td>\n                    </tr>\n                    <tr>\n                        <td><b style="white-space: nowrap;">{{ left }} recordID {{ right }}</b></td>\n                        <td>The record ID # of the current request.</td>\n                        <td><b>F11</b></td>\n                        <td>Toggle Full Screen mode for the focused section</td>\n                    </tr>\n                    <tr>\n                        <td><b style="white-space: nowrap;">{{ left }} data {{ right }}</b></td>\n                        <td>The contents of the current data field as stored in the database.</td>\n                        <td><b>Esc</b></td>\n                        <td>Escape Full Screen mode</td>\n                    </tr>\n                </table>\n                <div style="font-size:14px;">\n                    Within the code editor, tab enters a tab character. If using the keyboard to navigate, press escape followed by tab to exit the editor.\n                </div><br />\n                <div class="save_code">\n                    <label for="codemirror_html_label">html (for pages where the user can edit data):</label>\n                    <button type="button" id="btn_codeSave_html" class="btn-general" @click="saveCodeHTML" aria-label="save html code">\n                        <img id="saveIndicator" :src="libsPath + \'dynicons/svg/media-floppy.svg\'" alt="" />\n                        &nbsp;Save Code<span id="codeSaveStatus_html"></span>\n                    </button>\n                </div>\n                <textarea id="html">{{html}}</textarea><br />\n                <div class="save_code">\n                    <label for="codemirror_htmlPrint_label">htmlPrint (for pages where the user can only read data):</label>\n                    <button  type="button" id="btn_codeSave_htmlPrint" class="btn-general" @click="saveCodeHTMLPrint" aria-label="save html-print code">\n                        <img id="saveIndicator" :src="libsPath + \'dynicons/svg/media-floppy.svg\'" alt="" />\n                        &nbsp;Save Code<span id="codeSaveStatus_htmlPrint"></span>\n                    </button>\n                </div>\n                <textarea id="htmlPrint">{{htmlPrint}}</textarea>\n            </fieldset>\n        </div>\n        <div v-else id="advanced_options_dialog_content">\n            <b>Notice:</b><br/>\n            <p>Please go to <a href="../report.php?a=LEAF_start_leaf_dev_console_request" target="_blank">LEAF Programmer</a>\n            to ensure continued access to this area.</p>\n        </div>'};var s=o(448);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function u(e,t,o){return(t=function(e){var t=function(e){if("object"!=c(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=c(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const p={name:"staple-form-dialog",data:function(){var e;return{requiredDataProperties:["mainFormID"],mainFormID:(null===(e=this.dialogData)||void 0===e?void 0:e.mainFormID)||"",catIDtoStaple:"",ariaStatus:""}},inject:["APIroot","CSRFToken","setDialogSaveFunction","truncateText","decodeAndStripHTML","categories","dialogData","checkRequiredData","closeFormDialog","updateStapledFormsInfo"],created:function(){this.setDialogSaveFunction(this.onSave),this.checkRequiredData(this.requiredDataProperties)},mounted:function(){if(this.isSubform&&this.closeFormDialog(),this.mergeableForms.length>0){var e=document.getElementById("select-form-to-staple");null!==e&&e.focus()}else{var t=document.getElementById("button_save");null!==t&&(t.style.display="none")}},computed:{isSubform:function(){var e;return""!==(null===(e=this.categories[this.mainFormID])||void 0===e?void 0:e.parentID)},currentStapleIDs:function(){var e;return(null===(e=this.categories[this.mainFormID])||void 0===e?void 0:e.stapledFormIDs)||[]},mergeableForms:function(){var e=this,t=[],o=function(){var o=parseInt(e.categories[n].workflowID),i=e.categories[n].categoryID,r=e.categories[n].parentID,a=e.currentStapleIDs.every((function(e){return e!==i}));0===o&&""===r&&i!==e.mainFormID&&a&&t.push(function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){u(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},e.categories[n]))};for(var n in this.categories)o();return t}},methods:{unmergeForm:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";$.ajax({type:"DELETE",url:"".concat(this.APIroot,"formEditor/_").concat(this.mainFormID,"/stapled/_").concat(t,"?")+$.param({CSRFToken:this.CSRFToken}),success:function(){var o;e.ariaStatus="Removed stapled form ".concat((null===(o=e.categories[t])||void 0===o?void 0:o.categoryName)||""),e.updateStapledFormsInfo(e.mainFormID,t,!0)},error:function(e){return console.log(e)}})},onSave:function(){var e=this;""!==this.catIDtoStaple&&$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/_").concat(this.mainFormID,"/stapled"),data:{CSRFToken:this.CSRFToken,stapledCategoryID:this.catIDtoStaple},success:function(t){var o;1!=+t?alert(t):(e.ariaStatus="Added stapled form ".concat((null===(o=e.categories[e.catIDtoStaple])||void 0===o?void 0:o.categoryName)||""),e.updateStapledFormsInfo(e.mainFormID,e.catIDtoStaple),e.catIDtoStaple="")},error:function(e){return console.log(e)},cache:!1})}},watch:{mergeableForms:function(e,t){var o=e.length,n=t.length;if(0===o||0===n&&o>0){var i=document.getElementById("button_save");null!==i&&(i.style.display=0===o?"none":"flex")}}},template:'<div>\n        <div id="status_form_staple" role="status" aria-live="assertive" :aria-label="ariaStatus" style="opacity:0;position:absolute;"></div>\n        <p>Stapled forms will show up on the same page as the primary form.</p>\n        <p>The order of the forms will be determined by the forms\' assigned sort values.</p>\n        <div id="mergedForms" style="margin-top: 1rem;">\n            <ul style="list-style-type:none; padding: 0; min-height: 50px;">\n                <li v-for="id in currentStapleIDs" :key="\'staple_list_\' + id">\n                    {{truncateText(decodeAndStripHTML(categories[id]?.categoryName || \'Untitled\')) }}\n                    <button type="button"\n                        style="margin-left: 0.25em; background-color: transparent; color:#a00; padding: 0.1em 0.2em; border: 0; border-radius:3px;" \n                        @click="unmergeForm(id)"\n                        :title="\'remove \' + categories[id]?.categoryName || \'Untitled\'"\n                        :aria-label="\'remove \' + categories[id]?.categoryName || \'Untitled\'">\n                        <b>[ Remove ]</b>\n                    </button>\n                </li>\n            </ul>\n        </div><hr/>\n        <div style="min-height: 50px; margin: 1em 0;">\n            <template v-if="mergeableForms.length > 0">\n                <label for="select-form-to-staple" style="padding-right: 0.3em;">Select a form to merge</label>\n                <select v-model="catIDtoStaple" title="select a form to merge" id="select-form-to-staple" style="width:100%;">\n                    <option value="">Select a Form</option>\n                    <option v-for="f in mergeableForms" \n                        :value="f.categoryID" \n                        :key="\'merge_\'+f.categoryID">{{truncateText(decodeAndStripHTML(f.categoryName)) || \'Untitled\'}}</option>\n                </select>\n            </template>\n            <div v-else>There are no available forms to merge</div>\n        </div>\n    </div>'},m={name:"edit-collaborators-dialog",data:function(){return{formID:this.focusedFormRecord.categoryID,group:"",allGroups:[],collaborators:[],ariaStatus:""}},inject:["APIroot","CSRFToken","setDialogSaveFunction","categories","focusedFormRecord","closeFormDialog"],created:function(){this.setDialogSaveFunction(this.onSave)},mounted:function(){var e=this,t=[$.ajax({type:"GET",url:"".concat(this.APIroot,"system/groups"),success:function(t){e.allGroups=t},error:function(e){return console.log(e)},cache:!1}),$.ajax({type:"GET",url:"".concat(this.APIroot,"formEditor/_").concat(this.formID,"/privileges"),success:function(t){e.collaborators=t},error:function(e){return console.log(e)},cache:!1})];Promise.all(t).then((function(){var e=document.getElementById("selectFormCollaborators");null!==e&&e.focus()})).catch((function(e){return console.log("an error has occurred",e)}))},computed:{availableGroups:function(){var e=[];return this.collaborators.map((function(t){return e.push(parseInt(t.groupID))})),this.allGroups.filter((function(t){return!e.includes(parseInt(t.groupID))}))}},methods:{removePermission:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/_").concat(this.formID,"/privileges"),data:{CSRFToken:this.CSRFToken,groupID:t,read:0,write:0},success:function(n){e.collaborators=e.collaborators.filter((function(e){return parseInt(e.groupID)!==t})),e.ariaStatus="Removed ".concat(o," from collaborators")},error:function(e){return console.log(e)}})},formNameStripped:function(){var e=this.categories[this.formID].categoryName;return XSSHelpers.stripAllTags(e)||"Untitled"},onSave:function(){var e=this;""!==this.group&&$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/_").concat(this.formID,"/privileges"),data:{CSRFToken:this.CSRFToken,groupID:parseInt(this.group.groupID),read:1,write:1},success:function(t){void 0===e.collaborators.find((function(t){return parseInt(t.groupID)===parseInt(e.group.groupID)}))&&(e.ariaStatus="Added ".concat(e.group.name," to collaborators"),e.collaborators.push({groupID:e.group.groupID,name:e.group.name}),e.group="")},error:function(e){return console.log(e)},cache:!1})}},template:'<div>\n        <h3>What is this?</h3>\n        <p>With paper forms, people who have posession of the record have the ability to update it. This rule is used in LEAF, and people gain posession when a record reaches their step in the workflow. All modifications are timestamped with their respective authors.</p>\n        <br />\n        <p>To provide flexibility, specific groups can be granted permission to update information at any time in the workflow. This can be useful if you have internal-use fields, and want certain groups of people to update information at any time.</p>\n        <br />\n        <h3>The following groups can update {{formNameStripped()}} records at any time:</h3>\n        <div id="formPrivs" style="margin-top: 1rem;">\n            <div role="status" style="position:absolute;opacity:0" aria-live="assertive" :aria-label="ariaStatus"></div>\n            <template v-if="collaborators.length > 0">\n                <ul style="display: list-item; list-style-type:disc; margin-left: 1rem; min-height: 30px;">\n                    <li v-for="c in collaborators" :key="c.name + c.groupID">\n                        {{c.name}}\n                        <button type="button"\n                            style="margin-left: 0.25em; background-color: transparent; color:#a00; padding: 0.1em 0.2em; border: 0; border-radius:3px;" \n                            @click="removePermission(parseInt(c.groupID), c.name)" :aria-label="\'remove \' + c.name">\n                            <b>[ Remove ]</b>\n                        </button>\n                    </li>\n                </ul>\n            </template>\n            <template v-else>\n                <ul style="list-style-type:none; padding: 0; min-height: 30px;">\n                    <li>\n                        None\n                    </li>\n                </ul>\n            </template>\n        </div><hr/>\n        <div style="min-height: 50px; margin: 1em 0;">\n            <template v-if="availableGroups.length > 0">\n                <label for="selectFormCollaborators" style="display:block; margin-bottom:2px;">Add groups:</label>\n                <select v-model="group" id="selectFormCollaborators" style="width:100%;">\n                    <option value="">Select a Group</option>\n                    <option v-for="g in availableGroups" :value="g" :key="\'collab_group_\' + g.groupID">{{g.name}}</option>\n                </select>\n            </template>\n            <div v-else-if="collaborators.length == 0">There are no available groups to add</div>\n        </div>\n    </div>'},h={name:"confirm-delete-dialog",inject:["APIroot","CSRFToken","setDialogSaveFunction","decodeAndStripHTML","focusedFormRecord","getFormByCategoryID","removeCategory","closeFormDialog"],created:function(){this.setDialogSaveFunction(this.onSave)},computed:{formName:function(){return XSSHelpers.stripAllTags(this.decodeAndStripHTML(this.focusedFormRecord.categoryName))},formDescription:function(){return XSSHelpers.stripAllTags(this.decodeAndStripHTML(this.focusedFormRecord.categoryDescription))},currentStapleIDs:function(){var e;return(null===(e=this.focusedFormRecord)||void 0===e?void 0:e.stapledFormIDs)||[]}},methods:{onSave:function(){var e=this;if(0===this.currentStapleIDs.length){var t=this.focusedFormRecord.categoryID,o=this.focusedFormRecord.parentID;$.ajax({type:"DELETE",url:"".concat(this.APIroot,"formStack/_").concat(t,"?")+$.param({CSRFToken:this.CSRFToken}),success:function(n){1==+n?(e.removeCategory(t),""===o?e.$router.push({name:"browser"}):e.getFormByCategoryID(o,!0),e.closeFormDialog()):alert(n)},error:function(e){return console.log("an error has occurred",e)}})}else alert("Please remove all stapled forms before deleting.")}},template:'<div>\n        <div>Are you sure you want to delete this form?</div>\n        <div style="margin: 1em 0;"><b>{{formName}}</b></div>\n        <div style="min-width:300px; max-width: 500px; min-height: 50px; margin-bottom: 1rem;">{{formDescription}}</div>\n        <div v-if="currentStapleIDs.length > 0">⚠️ This form still has stapled forms attached</div>\n    </div>'};function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function v(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function g(e,t,o){return(t=function(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=f(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=Array(t);o<t;o++)n[o]=e[o];return n}const b={name:"conditions-editor-dialog",data:function(){return{requiredDataProperties:["indicatorID"],indicators:[],appIsLoadingIndicators:!0,parentIndID:0,selectedOperator:"",selectedParentValue:"",selectedOutcome:"",selectedChildValue:"",showRemoveModal:!1,showConditionEditor:!1,ariaStatus:"",selectedConditionJSON:"",enabledParentFormats:{dropdown:1,multiselect:1,radio:1,checkboxes:1,number:1,currency:1},multiOptionFormats:["multiselect","checkboxes"],orgchartSelectData:{},crosswalkFile:"",crosswalkHasHeader:!1,level2IndID:null,canPrefillChild:{text:1,textarea:1,dropdown:1,multiselect:1,radio:1,checkboxes:1,orgchart_employee:1,orgchart_group:1,orgchart_position:1},numericOperators:["gt","gte","lt","lte"]}},inject:["APIroot","CSRFToken","setDialogSaveFunction","dialogData","checkRequiredData","orgchartFormats","focusedFormRecord","focusedFormTree","getFormByCategoryID","closeFormDialog","truncateText","decodeAndStripHTML","fileManagerTextFiles","initializeOrgSelector","lastModalTab"],created:function(){this.checkRequiredData(this.requiredDataProperties),this.setDialogSaveFunction(this.onSave),this.getFormIndicators()},mounted:function(){var e=document.querySelector("#leaf-vue-dialog-cancel-save #button_save");null!==e&&(e.style.display="none")},methods:{getFormIndicators:function(){var e=[],t=function(o,n,i){var r=Array.isArray(null==i?void 0:i.options)?i.options.map((function(e){return e.trim()})):[];if(r=r.filter((function(e){return""!==e})),e.push({formPage:o,parentID:+n,indicatorID:+i.indicatorID,name:i.name||"",format:i.format.toLowerCase().trim(),options:r,conditions:i.conditions}),null!==i.child)for(var a in i.child)t(o,i.indicatorID,i.child[a])};this.focusedFormTree.forEach((function(e,o){t(o,null,e)})),this.indicators=e,this.appIsLoadingIndicators=!1},updateSelectedParentIndicator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.parentIndID=e,this.selectedParentValueOptions.includes(this.selectedParentValue)||(this.selectedParentValue="")},updateSelectedOutcome:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.selectedOutcome=e.toLowerCase(),this.selectedChildValue="",this.crosswalkFile="",this.crosswalkHasHeader=!1,this.level2IndID=null,"pre-fill"===this.selectedOutcome&&this.addOrgSelector()},updateSelectedOptionValue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"parent",o="";if(!0===(null==e?void 0:e.multiple)?(Array.from(e.selectedOptions).forEach((function(e){o+=e.label.trim()+"\n"})),o=o.trim()):o=e.value.trim(),"parent"===t.toLowerCase()){if(this.selectedParentValue=XSSHelpers.stripAllTags(o),"number"===this.parentFormat||"currency"===this.parentFormat)if(/^(\d*)(\.\d+)?$/.test(o)){var n=parseFloat(o);this.selectedParentValue="currency"===this.parentFormat?(Math.round(100*n)/100).toFixed(2):String(n)}else this.selectedParentValue=""}else"child"===t.toLowerCase()&&(this.selectedChildValue=XSSHelpers.stripAllTags(o))},newCondition:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.selectedConditionJSON="",this.showConditionEditor=e,this.selectedOperator="",this.parentIndID=0,this.selectedParentValue="",this.selectedOutcome="",this.selectedChildValue="",e&&(this.ariaStatus="Entering new condition")},postConditions:function(){var e,t=this,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.conditionComplete||!1===o){this.ariaStatus="";var n=(e=this.savedConditions,function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?y(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).filter((function(e){return JSON.stringify(e)!==t.selectedConditionJSON}));n.forEach((function(e){e.childIndID=parseInt(e.childIndID),e.parentIndID=parseInt(e.parentIndID),e.selectedChildValue=XSSHelpers.stripAllTags(e.selectedChildValue),e.selectedParentValue=XSSHelpers.stripAllTags(e.selectedParentValue)}));var i=JSON.stringify(this.conditions),r=n.every((function(e){return JSON.stringify(e)!==i}));!0===o&&r&&n.push(this.conditions),n=n.length>0?JSON.stringify(n):"",$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/").concat(this.childIndID,"/conditions"),data:{conditions:n,CSRFToken:this.CSRFToken},success:function(e){if("Invalid Token."!==e){t.getFormByCategoryID(t.formID),t.indicators.find((function(e){return e.indicatorID===t.childIndID})).conditions=n,t.showRemoveModal=!1,t.newCondition(!1);var o=document.getElementById("leaf-vue-dialog-close");null!==o&&o.focus(),setTimeout((function(){t.ariaStatus="Updated question conditions"}))}else console.log("error adding condition",e)},error:function(e){return console.log(e)}})}},removeCondition:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.confirmDelete,o=void 0!==t&&t,n=e.condition,i=void 0===n?{}:n;!0===o?this.postConditions(!1):(this.selectConditionFromList(i),this.showRemoveModal=!0)},selectConditionFromList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selectedConditionJSON=JSON.stringify(e),this.parentIndID=parseInt((null==e?void 0:e.parentIndID)||0),this.selectedOperator=(null==e?void 0:e.selectedOp)||"",this.selectedOutcome=((null==e?void 0:e.selectedOutcome)||"").toLowerCase(),this.selectedParentValue=(null==e?void 0:e.selectedParentValue)||"",this.selectedChildValue=(null==e?void 0:e.selectedChildValue)||"",this.crosswalkFile=(null==e?void 0:e.crosswalkFile)||"",this.crosswalkHasHeader=(null==e?void 0:e.crosswalkHasHeader)||!1,this.level2IndID=(null==e?void 0:e.level2IndID)||null,this.showConditionEditor=!0,this.ariaStatus="Editing conditions",this.addOrgSelector()},getIndicatorName:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=(null===(e=this.indicators.find((function(e){return parseInt(e.indicatorID)===t})))||void 0===e?void 0:e.name)||"";return o=this.decodeAndStripHTML(o),this.truncateText(o)},getOperatorText:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.parentFormat.toLowerCase(),o=e.selectedOp,n=e.selectedOp;switch(n){case"==":o=this.multiOptionFormats.includes(t)?"includes":"is";break;case"!=":o=this.multiOptionFormats.includes(t)?"does not include":"is not";break;case"gt":case"gte":case"lt":case"lte":var i=n.includes("g")?"greater than":"less than",r=n.includes("e")?" or equal to":"";o="is ".concat(i).concat(r)}return o},isOrphan:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=parseInt((null==e?void 0:e.parentIndID)||0);return"crosswalk"!==e.selectedOutcome.toLowerCase()&&!this.selectableParents.some((function(e){return parseInt(e.indicatorID)===t}))},listHeaderText:function(){var e="";switch((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toLowerCase()){case"show":e="This field will be hidden except:";break;case"hide":e="This field will be shown except:";break;case"prefill":e="This field will be pre-filled:";break;case"crosswalk":e="This field has loaded dropdown(s)"}return e},childFormatChangedSinceSave:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=((null==e?void 0:e.childFormat)||"").toLowerCase().trim(),o=((null==e?void 0:e.parentFormat)||"").toLowerCase().trim(),n=parseInt((null==e?void 0:e.parentIndID)||0),i=this.selectableParents.find((function(e){return e.indicatorID===n})),r=(null==i?void 0:i.format)||"";return t!==this.childFormat||o!==r},updateChoicesJS:function(){var e=this;setTimeout((function(){var t,o=document.querySelector("#child_choices_wrapper > div.choices"),n=document.getElementById("parent_compValue_entry_multi"),i=document.getElementById("child_prefill_entry_multi"),r=e.conditions.selectedOutcome;if(e.multiOptionFormats.includes(e.parentFormat)&&null!==n&&!0!==(null==n||null===(t=n.choicesjs)||void 0===t?void 0:t.initialised)){var a=e.conditions.selectedParentValue.split("\n")||[];a=a.map((function(t){return e.decodeAndStripHTML(t).trim()}));var l=e.selectedParentValueOptions;l=l.map((function(e){return{value:e.trim(),label:e.trim(),selected:a.includes(e.trim())}}));var s=new Choices(n,{placeholderValue:"Type here to search",allowHTML:!1,removeItemButton:!0,editItems:!0,choices:l.filter((function(e){return""!==e.value}))});n.choicesjs=s;var c=document.querySelector(".child_prefill_entry_multi input.choices__input");null!==c&&(c.setAttribute("aria-label","child prefill value choices"),c.setAttribute("role","searchbox"))}if("pre-fill"===r&&e.multiOptionFormats.includes(e.childFormat)&&null!==i&&null===o){var d=e.conditions.selectedChildValue.split("\n")||[];d=d.map((function(t){return e.decodeAndStripHTML(t).trim()}));var u=e.selectedChildValueOptions;u=u.map((function(e){return{value:e.trim(),label:e.trim(),selected:d.includes(e.trim())}}));var p=new Choices(i,{placeholderValue:"Type here to search",allowHTML:!1,removeItemButton:!0,editItems:!0,choices:u.filter((function(e){return""!==e.value}))});i.choicesjs=p;var m=document.querySelector(".parent_compValue_entry_multi input.choices__input");null!==m&&(m.setAttribute("aria-label","parent value choices"),m.setAttribute("role","searchbox"))}}))},addOrgSelector:function(){var e=this;if("pre-fill"===this.selectedOutcome&&this.orgchartFormats.includes(this.childFormat)){var t=this.childFormat.slice(this.childFormat.indexOf("_")+1);setTimeout((function(){e.initializeOrgSelector(t,e.childIndID,"ifthen_child_",e.selectedChildValue,e.setOrgSelChildValue)}))}},setOrgSelChildValue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0!==e.selection&&(this.orgchartSelectData=e.selectionData[e.selection],this.selectedChildValue=e.selection.toString())},onSave:function(){this.postConditions(!0)}},computed:{formID:function(){return this.focusedFormRecord.categoryID},showSetup:function(){return this.showConditionEditor&&this.selectedOutcome&&("crosswalk"===this.selectedOutcome||this.selectableParents.length>0)},conditionOverviewText:function(){return"crosswalk"!==this.selectedOutcome.toLowerCase()?"If ".concat(this.getIndicatorName(this.parentIndID)," ").concat(this.getOperatorText(this.conditions)," ").concat(this.decodeAndStripHTML(this.selectedParentValue),"\n                    then ").concat(this.selectedOutcome," this question."):"Question options loaded from ".concat(this.conditions.crosswalkFile)},noOptions:function(){return!["","crosswalk"].includes(this.selectedOutcome)&&this.selectableParents.length<1},childIndID:function(){return this.dialogData.indicatorID},childIndicator:function(){var e=this;return this.indicators.find((function(t){return t.indicatorID===e.childIndID}))},selectedParentIndicator:function(){var e=this,t=this.selectableParents.find((function(t){return t.indicatorID===parseInt(e.parentIndID)}));return void 0===t?{}:function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?v(Object(o),!0).forEach((function(t){g(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},t)},parentFormat:function(){var e;return(null===(e=this.selectedParentIndicator)||void 0===e?void 0:e.format)||""},childFormat:function(){var e;return(null===(e=this.childIndicator)||void 0===e?void 0:e.format)||""},selectableParents:function(){var e=this;return this.indicators.filter((function(t){return t.formPage===e.childIndicator.formPage&&t.indicatorID!==e.childIndID&&1===e.enabledParentFormats[t.format]}))},selectedParentOperators:function(){var e=[];switch(this.parentFormat){case"multiselect":case"checkboxes":case"dropdown":case"radio":e=this.multiOptionFormats.includes(this.parentFormat)?[{val:"==",text:"includes"},{val:"!=",text:"does not include"}]:[{val:"==",text:"is"},{val:"!=",text:"is not"}],this.selectedParentValueOptions.some((function(e){return Number.isFinite(+e)}))&&(e=e.concat([{val:"gt",text:"is greater than"},{val:"gte",text:"is greater or equal to"},{val:"lt",text:"is less than"},{val:"lte",text:"is less or equal to"}]));break;case"number":case"currency":e=[{val:"gt",text:"is greater than"},{val:"gte",text:"is greater or equal to"},{val:"lt",text:"is less than"},{val:"lte",text:"is less or equal to"}]}return e},crosswalkLevelTwo:function(){var e=this,t=this.childIndicator.formPage;return this.indicators.filter((function(o){return o.formPage===t&&o.indicatorID!==e.childIndID&&["dropdown","multiselect"].includes(o.format)}))},selectedParentValueOptions:function(){var e;return(null===(e=this.selectedParentIndicator)||void 0===e?void 0:e.options)||[]},selectedChildValueOptions:function(){var e;return(null===(e=this.childIndicator)||void 0===e?void 0:e.options)||[]},canAddCrosswalk:function(){return"dropdown"===this.childFormat||"multiselect"===this.childFormat},childPrefillDisplay:function(){var e,t,o,n,i="";switch(this.childFormat){case"orgchart_employee":i=" '".concat((null===(e=this.orgchartSelectData)||void 0===e?void 0:e.firstName)||""," ").concat((null===(t=this.orgchartSelectData)||void 0===t?void 0:t.lastName)||"","'");break;case"orgchart_group":i=" '".concat((null===(o=this.orgchartSelectData)||void 0===o?void 0:o.groupTitle)||"","'");break;case"orgchart_position":i=" '".concat((null===(n=this.orgchartSelectData)||void 0===n?void 0:n.positionTitle)||"","'");break;case"multiselect":case"checkboxes":var r=this.selectedChildValue.split("\n").length>1?"s":"";i="".concat(r," '").concat(this.decodeAndStripHTML(this.selectedChildValue),"'");break;default:i=" '".concat(this.decodeAndStripHTML(this.selectedChildValue),"'")}return i},childChoicesKey:function(){return this.selectedConditionJSON+this.selectedOutcome},parentChoicesKey:function(){return this.selectedConditionJSON+String(this.parentIndID)+this.selectedOperator},conditions:function(){var e,t;return{childIndID:parseInt((null===(e=this.childIndicator)||void 0===e?void 0:e.indicatorID)||0),parentIndID:parseInt((null===(t=this.selectedParentIndicator)||void 0===t?void 0:t.indicatorID)||0),selectedOp:this.selectedOperator,selectedParentValue:XSSHelpers.stripAllTags(this.selectedParentValue),selectedChildValue:XSSHelpers.stripAllTags(this.selectedChildValue),selectedOutcome:this.selectedOutcome.toLowerCase(),crosswalkFile:this.crosswalkFile,crosswalkHasHeader:this.crosswalkHasHeader,level2IndID:this.level2IndID,childFormat:this.childFormat,parentFormat:this.parentFormat}},conditionComplete:function(){var e=this.conditions,t=e.parentIndID,o=e.selectedOp,n=e.selectedParentValue,i=e.selectedChildValue,r=e.selectedOutcome,a=e.crosswalkFile,l=!1;if(!this.showRemoveModal)switch(r){case"pre-fill":l=0!==t&&""!==o&&""!==n&&""!==i;break;case"hide":case"show":l=0!==t&&""!==o&&""!==n;break;case"crosswalk":l=""!==a}var s=document.getElementById("button_save");return null!==s&&(s.style.display=!0===l?"block":"none"),l},savedConditions:function(){return"string"==typeof this.childIndicator.conditions&&"["===this.childIndicator.conditions[0]?JSON.parse(this.childIndicator.conditions):[]},conditionTypes:function(){return{show:this.savedConditions.filter((function(e){return"show"===e.selectedOutcome.toLowerCase()})),hide:this.savedConditions.filter((function(e){return"hide"===e.selectedOutcome.toLowerCase()})),prefill:this.savedConditions.filter((function(e){return"pre-fill"===e.selectedOutcome.toLowerCase()})),crosswalk:this.savedConditions.filter((function(e){return"crosswalk"===e.selectedOutcome.toLowerCase()}))}}},watch:{showRemoveModal:function(e){var t=document.getElementById("leaf-vue-dialog-cancel-save");null!==t&&(t.style.display=!0===e?"none":"flex",!0===e?t.setAttribute("aria-hidden",!0):t.removeAttribute("aria-hidden"),this.ariaStatus=!0===e?"Confirm Deletion":"")},childChoicesKey:function(e,t){"pre-fill"==this.selectedOutcome.toLowerCase()&&this.multiOptionFormats.includes(this.childFormat)&&this.updateChoicesJS()},parentChoicesKey:function(e,t){this.multiOptionFormats.includes(this.parentFormat)&&this.updateChoicesJS()},selectedOperator:function(e,t){""!==t&&this.numericOperators.includes(e)&&!this.numericOperators.includes(t)&&(this.selectedParentValue="")}},template:'<div id="condition_editor_dialog_content">\n            \x3c!-- LOADING SPINNER --\x3e\n            <div v-if="appIsLoadingIndicators" class="page_loading">\n                Loading... <img src="../images/largespinner.gif" alt="" />\n            </div>\n            <div v-else id="condition_editor_inputs">\n                \x3c!-- NOTE: DELETION DIALOG --\x3e\n                <div id="status_condition_entry" role="status" style="position: absolute; opacity:0" aria-live="assertive" :aria-label="ariaStatus"></div>\n                <div v-if="showRemoveModal" id="ifthen_deletion_dialog">\n                    <div>Choose <b>Delete</b> to remove this condition, or <b>cancel</b> to return to the editor</div>\n                    <div style="padding: 1rem 0;"><b>{{ conditionOverviewText }}</b></div>\n                    <div class="options">\n                        <button type="button" class="btn_remove_condition"\n                            @click="removeCondition({confirmDelete: true, condition: {}})">\n                            Delete\n                        </button>\n                        <button type="button" class="btn-general" @click="showRemoveModal=false" @keydown.tab="lastModalTab">\n                            Cancel\n                        </button>\n                    </div>\n                </div>\n                <template v-else>\n                    \x3c!-- NOTE: LISTS BY CONDITION TYPE --\x3e\n                    <div v-if="savedConditions.length > 0" id="savedConditionsLists">\n                        <template v-for="typeVal, typeKey in conditionTypes" :key="typeVal">\n                            <template v-if="typeVal.length > 0">\n                                <p><b>{{ listHeaderText(typeKey) }}</b></p>\n                                <ul>\n                                    <li v-for="c in typeVal" :key="c" class="savedConditionsCard">\n                                        <button type="button" @click="selectConditionFromList(c)" class="btnSavedConditions" \n                                            :class="{selectedConditionEdit: JSON.stringify(c) === selectedConditionJSON, isOrphan: isOrphan(c)}">\n                                            <template v-if="!isOrphan(c)">\n                                                <div v-if="c.selectedOutcome.toLowerCase() !== \'crosswalk\'">\n                                                    If \'{{getIndicatorName(parseInt(c.parentIndID))}}\' \n                                                    {{getOperatorText(c)}} <strong>{{ decodeAndStripHTML(c.selectedParentValue) }}</strong> \n                                                    then {{c.selectedOutcome}} this question.\n                                                </div>\n                                                <div v-else>Options for this question will be loaded from <b>{{ c.crosswalkFile }}</b></div>\n                                                <div v-if="childFormatChangedSinceSave(c)" class="changesDetected">\n                                                    Format changes detected.  Please review and save to update this condition.\n                                                </div>\n                                            </template>\n                                            <div v-else>This condition is inactive because indicator {{ c.parentIndID }} has been archived, deleted or is on another page.</div>\n                                        </button>\n                                        <button type="button" class="btn_remove_condition" aria-label="remove this condition"\n                                            @click="removeCondition({confirmDelete: false, condition: c})">X\n                                        </button>\n                                    </li>\n                                </ul>\n                            </template>\n                        </template>\n                    </div>\n                    <button type="button" @click="newCondition" class="btn-confirm new" aria-label="New Condition">+ New Condition</button>\n                    \x3c!-- NOTE: OUTCOME SELECTION and PREFILL AREAS --\x3e\n                    <div v-if="showConditionEditor" id="outcome-editor">\n                        <label class="ifthen_label" for="outcome_select">Select an outcome</label>\n                        <select title="select outcome" id="outcome_select" @change="updateSelectedOutcome($event.target.value)">\n                            <option v-if="conditions.selectedOutcome === \'\'" value="" selected>Select an outcome</option>\n                            <option value="show" :selected="conditions.selectedOutcome === \'show\'">Hide this question except ...</option>\n                            <option value="hide" :selected="conditions.selectedOutcome === \'hide\'">Show this question except ...</option>\n                            <option v-if="canPrefillChild[childFormat] === 1" \n                                value="pre-fill" :selected="conditions.selectedOutcome === \'pre-fill\'">Pre-fill this Question\n                            </option>\n                            <option v-if="canAddCrosswalk"\n                                value="crosswalk" :selected="conditions.selectedOutcome === \'crosswalk\'">Load Dropdown or Crosswalk\n                            </option>\n                        </select>\n                        <template v-if="!noOptions && conditions.selectedOutcome === \'pre-fill\'">\n                            <label class="ifthen_label" id="prefill_value_entry">Enter a pre-fill value</label>\n                            <select v-if="childFormat===\'dropdown\' || childFormat===\'radio\'"\n                                id="child_prefill_entry" aria-labelledby="prefill_value_entry"\n                                @change="updateSelectedOptionValue($event.target, \'child\')">\n                                <option v-if="conditions.selectedChildValue === \'\'" value="" selected>Select a value</option>\n                                <option v-for="val in selectedChildValueOptions" \n                                    :value="val"\n                                    :key="\'child_prefill_\' + val"\n                                    :selected="decodeAndStripHTML(conditions.selectedChildValue) === val">\n                                    {{ val }} \n                                </option>\n                            </select>\n                            <div v-else-if="multiOptionFormats.includes(childFormat)"\n                                id="child_choices_wrapper" :key="\'prefill_\' + childChoicesKey">\n                                <select v-if="childFormat === \'multiselect\' || childFormat === \'checkboxes\'"\n                                    placeholder="select some options"\n                                    multiple="true"\n                                    id="child_prefill_entry_multi" aria-labelledby="prefill_value_entry"\n                                    style="display: none;"\n                                    @change="updateSelectedOptionValue($event.target, \'child\')">\n                                </select>\n                            </div>\n                            <input v-else-if="childFormat===\'text\' || childFormat===\'textarea\'" \n                                id="child_prefill_entry" aria-labelledby="prefill_value_entry"\n                                @change="updateSelectedOptionValue($event.target, \'child\')"\n                                :value="decodeAndStripHTML(conditions.selectedChildValue)" />\n                            <div v-if="orgchartFormats.includes(childFormat)" :id="\'ifthen_child_orgSel_\' + conditions.childIndID"\n                                style="min-height:30px" aria-labelledby="prefill_value_entry">\n                            </div>\n                        </template>\n                    </div>\n                    <div v-if="showSetup" id="if-then-setup">\n                        <template v-if="conditions.selectedOutcome !== \'crosswalk\'">\n                            <div tabindex="0" style="margin: 0;font-size:1.25rem"><b>IF</b></div>\n                            \x3c!-- NOTE: PARENT CONTROLLER SELECTION --\x3e\n                            <select title="select controller question" aria-label="select controller question" id="controller_select" @change="updateSelectedParentIndicator(parseInt($event.target.value))">\n                                <option v-if="!conditions.parentIndID" :value="0" selected>Select an Indicator</option>\n                                <option v-for="i in selectableParents" :key="\'parent_\' + i.indicatorID"\n                                :title="i.name"\n                                :value="i.indicatorID"\n                                :selected="parseInt(conditions.parentIndID)===parseInt(i.indicatorID)" >\n                                {{getIndicatorName(parseInt(i.indicatorID)) }} (indicator {{i.indicatorID}})\n                                </option>\n                            </select>\n                            \x3c!-- NOTE: OPERATOR SELECTION --\x3e\n                            <select v-model="selectedOperator" id="operator_select" title="select condition" aria-label="select condition">\n                                <option v-if="selectedOperator === \'\'" value="" selected>Select a condition</option>\n                                <option v-for="o in selectedParentOperators" :key="o.val" :value="o.val" >\n                                {{ o.text }}\n                                </option>\n                            </select>\n                            \x3c!-- NOTE: COMPARED VALUE SELECTIONS --\x3e\n                            <input v-if="numericOperators.includes(selectedOperator)" id="numeric_comparison" title="enter a numeric value" aria-label="enter a numeric value"\n                                type="number" :value="conditions.selectedParentValue" class="comparison" @change="updateSelectedOptionValue($event.target, \'parent\')"\n                                placeholder="enter a number" />\n                            <select v-else-if="parentFormat === \'dropdown\' || parentFormat===\'radio\'"\n                                id="parent_compValue_entry_single" title="select a value" aria-label="select a value"\n                                @change="updateSelectedOptionValue($event.target, \'parent\')">\n                                <option v-if="conditions.selectedParentValue === \'\'" value="" selected>Select a value</option>\n                                <option v-for="val in selectedParentValueOptions"\n                                    :key="\'parent_val_\' + val" :value="val"\n                                    :selected="decodeAndStripHTML(conditions.selectedParentValue) === val"> {{ val }}\n                                </option>\n                            </select>\n                            <div v-else-if="parentFormat===\'multiselect\' || parentFormat===\'checkboxes\'"\n                                id="parent_choices_wrapper" class="comparison" :key="\'comp_\' + parentChoicesKey">\n                                <select id="parent_compValue_entry_multi" title="select values" aria-label="select values"\n                                    placeholder="select some options" multiple="true"\n                                    style="display: none;"\n                                    @change="updateSelectedOptionValue($event.target, \'parent\')">\n                                </select>\n                            </div>\n                        </template>\n                        \x3c!-- NOTE: LOADED DROPDOWNS AND CROSSWALKS --\x3e\n                        <div v-else class="crosswalks">\n                            <label for="select-crosswalk-file">File&nbsp;\n                                <select v-model="crosswalkFile" id="select-crosswalk-file" style="width: 200px;">\n                                    <option value="">Select a file</option>\n                                    <option v-for="f in fileManagerTextFiles" :key="f" :value="f">{{f}}</option>\n                                </select>\n                            </label>\n                            <label for="select-crosswalk-header">Does file contain headers?&nbsp;\n                                <select v-model="crosswalkHasHeader" style="width:60px;" id="select-crosswalk-header">\n                                    <option :value="false">No</option>\n                                    <option :value="true">Yes</option>\n                                </select>\n                            </label>\n                            <label for="select-level-two">Controlled Dropdown&nbsp;\n                                <select v-model.number="level2IndID" id="select-level-two" style="width: 200px;">\n                                    <option :value="null">none (single dropdown)</option>\n                                    <option v-for="indicator in crosswalkLevelTwo"\n                                        :key="\'level2_\' + indicator.indicatorID"\n                                        :value="parseInt(indicator.indicatorID)">\n                                        {{indicator.indicatorID}}: {{getIndicatorName(parseInt(indicator.indicatorID))}}\n                                    </option>\n                                </select>\n                            </label>\n                        </div>\n                    </div>\n                    <div v-if="conditionComplete">\n                        <div v-if="conditions.selectedOutcome !== \'crosswalk\'" tabindex="0">\n                            <span style="margin:0;display:inline-block;font-size=1.25rem"><b>THEN</b></span> \'{{getIndicatorName(childIndID)}}\'\n                            <span v-if="conditions.selectedOutcome === \'pre-fill\'">will \n                            <span style="color: #008010; font-weight: bold;"> have the value{{childPrefillDisplay}}</span>\n                            </span>\n                            <span v-else>will \n                                <span style="color: #008010; font-weight: bold;">\n                                be {{conditions.selectedOutcome === "show" ? \'shown\' : \'hidden\'}}\n                                </span>\n                            </span>\n                        </div>\n                        <div v-else tabindex="0">\n                            <p>Selection options will be loaded from <b>{{ conditions.crosswalkFile }}</b></p>\n                        </div>\n                    </div>\n                    <div v-if="noOptions">No options are currently available for this selection</div>\n                </template>\n            </div>\n        </div>'};function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function D(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function w(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?D(Object(o),!0).forEach((function(t){S(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):D(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function S(e,t,o){return(t=function(e){var t=function(e){if("object"!=I(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=I(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==I(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const _={name:"form-editor-menu",inject:["APIroot","categories","focusedFormRecord","siteSettings","noForm","mainFormID","openFormHistoryDialog","openConfirmDeleteFormDialog","openEditCollaboratorsDialog"],computed:{internalFormRecords:function(){var e=[];for(var t in this.categories)this.categories[t].parentID===this.mainFormID&&""!==this.mainFormID&&e.push(w({},this.categories[t]));return e}},methods:{exportForm:function(){var e=this,t=this.mainFormID,o={form:{},subforms:{}},n=[];n.push($.ajax({type:"GET",url:"".concat(this.APIroot,"form/_").concat(t,"/export"),success:function(e){o.form=e,o.categoryID=t},error:function(e){return console.log(e)}})),this.internalFormRecords.forEach((function(t){var i=t.categoryID;n.push($.ajax({type:"GET",url:"".concat(e.APIroot,"form/_").concat(i,"/export"),success:function(e){o.subforms[i]={},o.subforms[i].name=t.categoryName,o.subforms[i].description=t.categoryDescription,o.subforms[i].packet=e},error:function(e){return console.log("an error has occurred",e)}}))})),n.push($.ajax({type:"GET",url:"".concat(this.APIroot,"form/_").concat(t,"/workflow"),success:function(e){o.workflowID=e[0].workflowID},error:function(e){return console.log("an error has occurred",e)}})),Promise.all(n).then((function(){var n={version:1};n.name=e.categories[t].categoryName+" (Copy)",n.description=e.categories[t].categoryDescription,n.packet=o;var i=new Blob([JSON.stringify(n).replace(/[^ -~]/g,"")],{type:"text/plain"});saveAs(i,"LEAF_FormPacket_"+t+".txt")})).catch((function(e){return console.log("an error has occurred",e)}))}},template:'<div><nav id="top-menu-nav">\n        \x3c!-- FORM EDITOR VIEW MENU --\x3e\n        <ul>\n            <template v-if="!noForm">\n                <li>\n                    <button type="button" @click="openFormHistoryDialog(this.focusedFormRecord.categoryID)" title="view form history" aria-label="view form history">\n                        <span role="img" aria-hidden="true" alt="">🕗&nbsp;</span>View History\n                    </button>\n                </li>\n                <li>\n                    <button type="button" @click="openEditCollaboratorsDialog" title="Edit Special Write Access" aria-label="Edit Special Write Access">\n                        <span role="img" aria-hidden="true" alt="">🔒&nbsp;</span>Customize Write Access\n                    </button>\n                </li>\n                <li>\n                    <button type="button" @click="exportForm" title="export form" aria-label="export form">\n                        <span role="img" aria-hidden="true" alt="">💾&nbsp;</span>Export Form\n                    </button>\n                </li>\n                <li>\n                    <button type="button" @click="openConfirmDeleteFormDialog" title="delete this form" aria-label="delete this form">\n                        <span role="img" aria-hidden="true" alt="">❌&nbsp;</span>Delete this form\n                    </button>\n                </li>\n            </template>\n            <li>\n                <router-link :to="{ name: \'restore\' }" class="router-link" >\n                    <span role="img" aria-hidden="true" alt="">♻️&nbsp;</span>Restore Fields\n                </router-link>\n            </li>\n        </ul>\n    </nav>\n    <div v-if="siteSettings?.siteType===\'national_subordinate\'" id="subordinate_site_warning" style="padding: 0.5rem; margin: 0.5rem 0;" >\n        <h3 style="margin: 0 0 0.5rem 0; color: #a00;">This is a Nationally Standardized Subordinate Site</h3>\n        <span><b>Do not make modifications!</b> &nbsp;Synchronization problems will occur. &nbsp;Please contact your process POC if modifications need to be made.</span>\n    </div></div>'},F={name:"form-question-display",props:{categoryID:String,depth:Number,formPage:Number,index:Number,currentListLength:Number,formNode:Object},components:{FormatPreview:{name:"format-preview",data:function(){return{indID:this.indicator.indicatorID}},props:{indicator:Object},inject:["libsPath","initializeOrgSelector","orgchartFormats","decodeAndStripHTML","updateChosenAttributes"],computed:{baseFormat:function(){var e;return(null===(e=this.indicator.format)||void 0===e||null===(e=e.toLowerCase())||void 0===e?void 0:e.trim())||""},truncatedOptions:function(){var e;return(null===(e=this.indicator.options)||void 0===e?void 0:e.slice(0,6))||[]},defaultValue:function(){var e;return(null===(e=this.indicator)||void 0===e?void 0:e.default)||""},strippedDefault:function(){return this.decodeAndStripHTML(this.defaultValue||"")},inputElID:function(){return"input_preview_".concat(this.indID)},selType:function(){return this.baseFormat.slice(this.baseFormat.indexOf("_")+1)},labelSelector:function(){return"format_label_"+this.indID},printResponseID:function(){return"xhrIndicator_".concat(this.indID,"_").concat(this.indicator.series)},gridOptions:function(){var e,t=JSON.parse((null===(e=this.indicator)||void 0===e?void 0:e.options)||"[]");return t.map((function(e){e.name=XSSHelpers.stripAllTags(e.name),null!=e&&e.options&&e.options.map((function(e){return XSSHelpers.stripAllTags(e)}))})),t}},mounted:function(){var e,t,o,n,i,r=this;switch(this.baseFormat){case"raw_data":break;case"date":$("#".concat(this.inputElID)).datepicker({autoHide:!0,showAnim:"slideDown",onSelect:function(){$("#"+r.indID+"_focusfix").focus()}}),null===(e=document.getElementById(this.inputElID))||void 0===e||e.setAttribute("aria-labelledby",this.labelSelector);break;case"dropdown":$("#".concat(this.inputElID)).chosen({disable_search_threshold:5,allow_single_deselect:!0,width:"50%"}),this.updateChosenAttributes(this.inputElID,this.labelSelector,"Select Question Option");break;case"multiselect":var a=document.getElementById(this.inputElID);if(null!==a&&!0===a.multiple&&"active"!==(null==a?void 0:a.getAttribute("data-choice"))){var l=this.indicator.options||[];l=l.map((function(e){return{value:e,label:e,selected:""!==r.strippedDefault&&r.strippedDefault===e}}));var s=new Choices(a,{placeholderValue:"Type here to search",allowHTML:!1,removeItemButton:!0,editItems:!0,choices:l.filter((function(e){return""!==e.value}))});a.choicesjs=s}var c=document.querySelector("#".concat(this.inputElID," ~ input.choices__input"));null!==c&&(c.setAttribute("aria-labelledby",this.labelSelector),c.setAttribute("role","searchbox"));break;case"orgchart_group":case"orgchart_position":case"orgchart_employee":this.initializeOrgSelector(this.selType,this.indID,"",(null===(t=this.indicator)||void 0===t?void 0:t.default)||"");break;case"checkbox":null===(o=document.getElementById(this.inputElID+"_check0"))||void 0===o||o.setAttribute("aria-labelledby",this.labelSelector);break;case"checkboxes":case"radio":null===(n=document.querySelector("#".concat(this.printResponseID," .format-preview")))||void 0===n||n.setAttribute("aria-labelledby",this.labelSelector);break;default:null===(i=document.getElementById(this.inputElID))||void 0===i||i.setAttribute("aria-labelledby",this.labelSelector)}},methods:{useAdvancedEditor:function(){$("#"+this.inputElID).trumbowyg({btns:["bold","italic","underline","|","unorderedList","orderedList","|","justifyLeft","justifyCenter","justifyRight","fullscreen"]}),$("#textarea_format_button_".concat(this.indID)).css("display","none")}},template:'<div class="format_preview">\n        <input v-if="baseFormat === \'text\'" :id="inputElID" type="text" :value="strippedDefault" class="text_input_preview"/>\n        <input v-if="baseFormat === \'number\'" :id="inputElID" type="number" :value="strippedDefault" class="text_input_preview"/>\n\n        <template v-if="baseFormat === \'currency\'">\n            $&nbsp;<input :id="inputElID" type="number" :value="strippedDefault"\n            min="0.00" step="0.01" class="text_input_preview"/>\n        </template>\n\n        <template v-if="baseFormat === \'raw_data\'">\n            Custom Widget\n        </template>\n\n        <template v-if="baseFormat === \'textarea\'">\n            <textarea :id="inputElID" rows="6" class="textarea_input_preview" :value="strippedDefault"></textarea>\n            <div :id="\'textarea_format_button_\' + indicator.indicatorID"\n                @click="useAdvancedEditor" \n                style="text-align: right; font-size: 12px"><span class="link">formatting options</span>\n            </div>\n        </template>\n\n        <template v-if="baseFormat === \'radio\'">\n            <template v-for="o, i in truncatedOptions" :key="\'radio_prev_\' + indicator.indicatorID + \'_\' + i">\n                <label class="checkable leaf_check" :for="inputElID + \'_radio\' + i">\n                    <input type="radio" :id="inputElID + \'_radio\' + i" \n                    :name="indicator.indicatorID" class="icheck leaf_check"\n                    :checked="strippedDefault !== \'\' && strippedDefault === o" />\n                    <span class="leaf_check"></span>{{ o }}\n                </label>\n            </template>\n            <div v-if="indicator?.options?.length > 5" style="padding-left: 0.4em"><b> ...</b></div>\n        </template>\n\n        <template v-if="baseFormat === \'checkboxes\' || baseFormat === \'checkbox\'">\n            <template v-for="o, i in truncatedOptions" :key="\'check_prev_\' + indicator.indicatorID + \'_\' + i">\n                <label class="checkable leaf_check" :for="inputElID + \'_check\' + i">\n                    <input type="checkbox" :id="inputElID + \'_check\' + i" :name="indicator.indicatorID" class="icheck leaf_check"  :checked="strippedDefault !== \'\' && strippedDefault === o" />\n                    <span class="leaf_check"></span>{{ o }}\n                </label>\n            </template>\n            <div v-if="indicator?.options?.length > 5" style="padding-left: 0.4em"><b> ...</b></div>\n        </template>\n        \n        <fieldset v-if="baseFormat === \'fileupload\' || baseFormat === \'image\'" \n            style="padding: 0.5em;"><legend>File Attachment(s)</legend>\n            <p style="margin-bottom: 0.5em;">Select File to attach:</p>\n            <input :id="inputElID" name="formPacket" type="file" />\n        </fieldset>\n\n        <template v-if="baseFormat === \'date\'">\n            <input type="text" :id="inputElID"\n            :style="\'background: white url(\' + libsPath + \'dynicons/svg/office-calendar.svg) no-repeat 4px center; background-size: 16px;\'"\n            style="padding-left: 24px; font-size: 1.3em; font-family: monospace;" :value="indicator.default" />\n        </template>\n\n        <select v-if="baseFormat === \'dropdown\'" :id="inputElID" style="width: 50%" :value="strippedDefault">\n            <option v-for="o, i in truncatedOptions" :key="\'drop_prev_\' + indicator.indicatorID + \'_\' + i">\n            {{o}}\n            </option>\n            <option v-if="indicator?.options?.length > 5" style="padding-left: 0.4em" disabled>(preview showing first 5)</option>\n        </select>\n        \n        <select v-if="baseFormat === \'multiselect\'" multiple \n            :id="inputElID">\n            :name="\'multi_prev_\' + indicator.indicatorID + \'_multiselect[]\'"\n            style="display:none">\n        </select>\n        \n        <template v-if="orgchartFormats.includes(baseFormat)">\n            <div :id="\'orgSel_\' + indicator.indicatorID" style="min-height:30px"></div>\n        </template>\n\n        <template v-if="baseFormat === \'grid\'">\n            <div class="tableinput">\n                <table class="table" :id="\'grid_\' + indicator.indicatorID + \'_\' + indicator.series + \'_input\'"\n                    style="word-wrap: break-word; table-layout: fixed; height: 100%; display: table">\n\n                    <thead :id="\'gridTableHead_\' + indicator.indicatorID">\n                        <tr>\n                            <td v-for="o in gridOptions" :key="\'grid_head_\' + o.id">{{ o.name }}</td>\n                        </tr>\n                    </thead>\n                    <tbody :id="\'gridTableBody_\' + indicator.indicatorID">\n                        <tr>\n                            <td v-for="o in gridOptions" style="min-width: 150px;" :key="\'grid_body_\' + o.id">\n                                <input v-if="o.type === \'text\'" style="width: 100%;" :aria-label="o.name" />\n                                <textarea v-if="o.type === \'textarea\'" rows="3" style="resize:none; width: 100%;" :aria-label="o.name"></textarea>\n                                <input type="date" v-if="o.type === \'date\'" style="width: 100%;" :aria-label="o.name" />\n                                <select v-if="o.type === \'dropdown\'" style="width: 100%;" :aria-label="o.name">\n                                    <option v-for="option in o.options" :key="\'grid_drop_\' + option">{{option}}</option>\n                                </select>\n                                <select v-if="o.type === \'dropdown_file\'" style="width: 100%;" :aria-label="o.name">\n                                    <option value="">Dropdown from File</option>\n                                </select>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </template>\n    </div>'}},inject:["libsPath","newQuestion","shortIndicatorNameStripped","focusedFormID","focusedIndicatorID","editQuestion","hasDevConsoleAccess","editAdvancedOptions","openIfThenDialog","listTracker","previewMode","makePreviewKey"],computed:{indicatorID:function(){var e;return+(null===(e=this.formNode)||void 0===e?void 0:e.indicatorID)},isHeader:function(){return 0===this.depth},hasCode:function(){var e,t;return""!==((null===(e=this.formNode)||void 0===e?void 0:e.html)||"").trim()||""!==((null===(t=this.formNode)||void 0===t?void 0:t.htmlPrint)||"").trim()},conditionalQuestion:function(){return!this.isHeader&&null!==this.formNode.conditions&&""!==this.formNode.conditions&"null"!==this.formNode.conditions},conditionsAllowed:function(){return!this.isHeader&&"raw_data"!==(this.formNode.format||"").toLowerCase()},indicatorName:function(){var e,t=0===this.depth?'<div class="form_page">'.concat(this.formPage+1,"</div>"):"",o=this.required?'<span class="required-sensitive">*&nbsp;Required</span>':"",n=""===((null===(e=this.formNode)||void 0===e?void 0:e.description)||"")||this.previewMode?"":'<span style="font-weight:normal"> ('.concat(this.formNode.description,")</span>"),i=0===this.depth&&this.formNode.categoryID!==this.focusedFormID?'<span role="img" aria-hidden="true" alt="">📌&nbsp;</span>':"",r=""!==this.formNode.name.trim()?'<span class="name">'+this.formNode.name.trim()+"</span>":'<span class="name">[ blank ]</span>';return"".concat(t).concat(i).concat(r).concat(n).concat(o)},hasSpecialAccessRestrictions:function(){return 1===parseInt(this.formNode.isMaskable)},required:function(){return 1===parseInt(this.formNode.required)},sensitive:function(){return 1===parseInt(this.formNode.is_sensitive)}},template:'<div class="form_editing_area">\n            <div class="name_and_toolbar" :class="{\'form-header\': isHeader, preview: previewMode}">\n                \x3c!-- TOOLBAR --\x3e\n                <div v-show="!previewMode"\n                    :id="\'form_editing_toolbar_\' + indicatorID">\n\n                    <div style="display: grid; grid-template-columns: 1fr auto auto; grid-template-rows: repeat(2, 1fr)">\n                        <button type="button"\n                            :id="\'edit_indicator_\' + indicatorID"\n                            class="btn-general"\n                            :style="{ \'grid-area\': depth === 0 ? \'1\' : \'1 / 1 / 3 / 2\', \'height\': depth === 0 ? \'auto\' : \'100%\' }"\n                            @click.exact="editQuestion(parseInt(indicatorID))"\n                            :title="\'edit indicator \' + indicatorID">\n                            <span role="img" aria-hidden="true" alt="">✏️&nbsp;</span> {{ depth === 0 ? \'Edit Header\' : \'Edit\' }}\n                        </button>\n                        <button v-if="hasDevConsoleAccess" type="button"\n                            :id="\'programmer_indicator_\' + indicatorID" class="btn-general"\n                            @click="editAdvancedOptions(parseInt(indicatorID))">\n                            Programmer\n                        </button>\n                        <button v-if="conditionsAllowed" type="button" :id="\'edit_conditions_\' + indicatorID"\n                            class="btn-general"\n                            @click="openIfThenDialog(parseInt(indicatorID), formNode.name.trim())">\n                            Modify Logic\n                        </button>\n                        <button v-if="!isHeader" type="button" class="btn-general"\n                            title="add sub-question"\n                            aria-label="add sub-question"\n                            @click="newQuestion(indicatorID)">\n                            + Sub-question\n                        </button>\n                        <div style="margin-left: auto; grid-area: 1 / 3 / 2 / 4">\n                            <span v-if="sensitive">\n                                <img :src="libsPath + \'dynicons/svg/eye_invisible.svg\'" style="width: 16px; vertical-align: middle; margin: 0 4px 2px 0" alt="" class="sensitive-icon" title="This field is sensitive" />\n                            </span>\n                            <span v-if="hasSpecialAccessRestrictions" role="img" alt="special access restrictions are present" title="special access restrictions are present" style="text-shadow: 0 0 1px black, 0 0 1px black; cursor: help">🔒</span>\n                            <span v-if="conditionalQuestion" role="img" alt="conditional logic is present" title="conditional logic is present" style="text-shadow: 0 0 1px black, 0 0 1px black; cursor: help">⛓️</span>\n                            <span v-if="hasCode" role="img" alt="advanced options are present" title="advanced options are present" style="text-shadow: 0 0 1px black, 0 0 1px black; cursor: help">⚙️</span>\n                        </div>\n                    </div>\n                </div>\n                \x3c!-- NAME --\x3e\n                <div v-html="indicatorName"\n                    class="indicator-name-preview" :id="\'format_label_\' + indicatorID">\n                </div>\n            </div>\n\n            \x3c!-- FORMAT PREVIEW --\x3e\n            <format-preview :indicator="formNode" :key="\'FP_\' + indicatorID"></format-preview>\n        </div>'},k={name:"form-index-listing",props:{categoryID:String,formPage:Number,depth:Number,indicatorID:Number,formNode:Object,index:Number,currentListLength:Number,parentID:Number},components:{FormQuestionDisplay:F},inject:["shortIndicatorNameStripped","clearListItem","addToListTracker","previewMode","setIndicatorFocus","clickToMoveListItem","focusedIndicatorID","startDrag","endDrag","handleOnDragCustomizations","onDragEnter","onDragLeave","onDrop","makePreviewKey","newQuestion"],mounted:function(){this.previewMode||this.addToListTracker(this.formNode,this.parentID,this.index)},beforeUnmount:function(){this.clearListItem(this.formNode.indicatorID)},computed:{suffix:function(){return"".concat(this.formNode.indicatorID,"_").concat(this.formNode.series)},printResponseID:function(){return"xhrIndicator_".concat(this.suffix)},required:function(){return 1===parseInt(this.formNode.required)},hasClickToMoveOptions:function(){return this.currentListLength>1}},template:'<li\n            :title="\'indicatorID: \'+ indicatorID" :class="depth === 0 ? \'section_heading\' : \'subindicator_heading\'"\n            @click.stop="setIndicatorFocus(indicatorID)">\n        <div class="printResponse" :class="{\'form-header\': depth === 0, preview: previewMode}" :id="printResponseID">\n\n            \x3c!-- VISIBLE DRAG INDICATOR (event is on li itself) / CLICK UP DOWN options --\x3e\n            <div v-show="!previewMode" class="move_question_container">\n                <div :id="\'index_listing_\' + indicatorID + \'_button\'"\n                    :title="\'drag to move indicatorID \' + indicatorID + \'.\'"\n                    class="drag_question_handle">\n                    <div role="img" aria-hidden="true" alt="" class="icon_drag" :title="\'drag to move indicatorID \' + indicatorID + \'.\'">∷</div>\n                </div>\n                <div :id="\'click_to_move_options_\' + indicatorID" class="click_to_move_options"\n                    :class="{click_buttons_visible: indicatorID === focusedIndicatorID && hasClickToMoveOptions}">\n                    <button type="button"\n                        :disabled="index === 0"\n                        :id="\'click_to_move_up_\' + indicatorID" class="icon_move up"\n                        :title="\'move indicatorID \' + indicatorID + \' up\'"\n                        :aria-label="\'move indicatorID \' + indicatorID + \' up\'"\n                        @keyup.tab="setIndicatorFocus(indicatorID)"\n                        @click.stop="clickToMoveListItem($event, indicatorID, true)">\n                    </button>\n                    <button type="button"\n                        :disabled="index === currentListLength - 1"\n                        :id="\'click_to_move_down_\' + indicatorID" class="icon_move down"\n                        :title="\'move indicatorID \' + indicatorID + \' down\'"\n                        :aria-label="\'move indicatorID \' + indicatorID + \' down\'"\n                        @keyup.tab="setIndicatorFocus(indicatorID)"\n                        @click.stop="clickToMoveListItem($event, indicatorID, false)">\n                    </button>\n                </div>\n            </div>\n\n            <form-question-display\n                :key="\'editing_display_\' + formNode.indicatorID + makePreviewKey(formNode)"\n                :categoryID="categoryID"\n                :depth="depth"\n                :formPage="formPage"\n                :index="index"\n                :currentListLength="currentListLength"\n                :formNode="formNode">\n            </form-question-display>\n            \n            \x3c!-- NOTE: ul for drop zones always needs to be here in edit mode even if there are no current children --\x3e\n            <ul v-if="formNode.child !== null || !previewMode"\n                class="form-index-listing-ul" :id="\'drop_area_parent_\'+ indicatorID"\n                :class="{empty_drop_area_ul: formNode.child === null}"\n                data-effect-allowed="move"\n                @drop.stop="onDrop($event)"\n                @dragover.prevent\n                @dragenter.prevent="onDragEnter"\n                @dragleave="onDragLeave">\n\n                <form-index-listing v-for="(listItem, idx) in formNode.child"\n                    :id="\'index_listing_\' + listItem.indicatorID"\n                    :categoryID="categoryID"\n                    :formPage=formPage\n                    :depth="depth + 1"\n                    :parentID="indicatorID"\n                    :indicatorID="listItem.indicatorID"\n                    :formNode="listItem"\n                    :index="idx"\n                    :currentListLength="formNode.child.length"\n                    :key="\'index_list_item_\' + listItem.indicatorID"\n                    :draggable="!previewMode"\n                    @dragstart.stop="startDrag"\n                    @dragend.stop="endDrag"\n                    @drag.stop="handleOnDragCustomizations">\n                </form-index-listing>\n            </ul>\n            <div v-if="depth === 0 && !previewMode" style="padding:0.5rem;">\n                <button type="button" class="btn-general new_section_question"\n                    aria-label="Add Question to Section"\n                    @click="newQuestion(formNode.indicatorID)">\n                    + Add Question to Section\n                </button>\n            </div>\n        </div>\n    </li>'},T={name:"edit-properties-panel",data:function(){var e,t,o,n,i,r,a,l,s,c;return{categoryName:this.decodeAndStripHTML((null===(e=this.focusedFormRecord)||void 0===e?void 0:e.categoryName)||"Untitled"),categoryDescription:this.decodeAndStripHTML((null===(t=this.focusedFormRecord)||void 0===t?void 0:t.categoryDescription)||""),workflowID:parseInt(null===(o=this.focusedFormRecord)||void 0===o?void 0:o.workflowID)||0,needToKnow:parseInt(null===(n=this.focusedFormRecord)||void 0===n?void 0:n.needToKnow)||0,visible:parseInt(null===(i=this.focusedFormRecord)||void 0===i?void 0:i.visible)||0,type:(null===(r=this.focusedFormRecord)||void 0===r?void 0:r.type)||"",formID:(null===(a=this.focusedFormRecord)||void 0===a?void 0:a.categoryID)||"",formParentID:(null===(l=this.focusedFormRecord)||void 0===l?void 0:l.parentID)||"",destructionAgeYears:(null===(s=this.focusedFormRecord)||void 0===s?void 0:s.destructionAge)>0?(null===(c=this.focusedFormRecord)||void 0===c?void 0:c.destructionAge)/365:null,workflowsLoading:!0,workflowRecords:[]}},created:function(){this.getWorkflowRecords()},mounted:function(){this.focusedFormIsSensitive&&0==+this.needToKnow&&this.updateNeedToKnow(!0)},inject:["APIroot","CSRFToken","appIsLoadingForm","allStapledFormCatIDs","focusedFormRecord","focusedFormIsSensitive","updateCategoriesProperty","openEditCollaboratorsDialog","openFormHistoryDialog","showLastUpdate","truncateText","decodeAndStripHTML"],computed:{loading:function(){return this.appIsLoadingForm||this.workflowsLoading},workflowDescription:function(){var e=this,t="";if(0!==this.workflowID){var o=this.workflowRecords.find((function(t){return parseInt(t.workflowID)===e.workflowID}));t=(null==o?void 0:o.description)||""}return t},isSubForm:function(){return""!==this.focusedFormRecord.parentID},isStaple:function(){var e;return(null===(e=this.allStapledFormCatIDs)||void 0===e?void 0:e[this.formID])>0},isNeedToKnow:function(){return 1===parseInt(this.focusedFormRecord.needToKnow)},formNameCharsRemaining:function(){return 50-this.categoryName.length},formDescrCharsRemaining:function(){return 255-this.categoryDescription.length}},methods:{getWorkflowRecords:function(){var e=this;$.ajax({type:"GET",url:"".concat(this.APIroot,"workflow"),success:function(t){e.workflowRecords=t||[],e.workflowsLoading=!1},error:function(e){return console.log(e)}})},updateName:function(){var e=this;$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/formName"),data:{name:XSSHelpers.stripAllTags(this.categoryName),categoryID:this.formID,CSRFToken:this.CSRFToken},success:function(){e.updateCategoriesProperty(e.formID,"categoryName",e.categoryName),e.showLastUpdate("form_properties_last_update")},error:function(e){return console.log("name post err",e)}})},updateDescription:function(){var e=this;$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/formDescription"),data:{description:XSSHelpers.stripAllTags(this.categoryDescription),categoryID:this.formID,CSRFToken:this.CSRFToken},success:function(){e.updateCategoriesProperty(e.formID,"categoryDescription",e.categoryDescription),e.showLastUpdate("form_properties_last_update")},error:function(e){return console.log("form description post err",e)}})},updateWorkflow:function(){var e=this;$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/formWorkflow"),data:{workflowID:this.workflowID,categoryID:this.formID,CSRFToken:this.CSRFToken},success:function(t){0==+t?alert("The workflow could not be set because this form is stapled to another form"):(e.updateCategoriesProperty(e.formID,"workflowID",e.workflowID),e.updateCategoriesProperty(e.formID,"workflowDescription",e.workflowDescription),e.showLastUpdate("form_properties_last_update"))},error:function(e){return console.log("workflow post err",e)}})},updateAvailability:function(){var e=this;$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/formVisible"),data:{visible:this.visible,categoryID:this.formID,CSRFToken:this.CSRFToken},success:function(){e.updateCategoriesProperty(e.formID,"visible",e.visible),e.showLastUpdate("form_properties_last_update")},error:function(e){return console.log("visibility post err",e)}})},updateNeedToKnow:function(){var e=this,t=!0===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])?1:this.needToKnow;$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/formNeedToKnow"),data:{needToKnow:t,categoryID:this.formID,CSRFToken:this.CSRFToken},success:function(){e.updateCategoriesProperty(e.formID,"needToKnow",t),e.needToKnow=t,e.showLastUpdate("form_properties_last_update")},error:function(e){return console.log("ntk post err",e)}})},updateType:function(){var e=this;$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/formType"),data:{type:this.type,categoryID:this.formID,CSRFToken:this.CSRFToken},success:function(){e.updateCategoriesProperty(e.formID,"type",e.type),e.showLastUpdate("form_properties_last_update")},error:function(e){return console.log("type post err",e)}})},updateDestructionAge:function(){var e=this;(null===this.destructionAgeYears||this.destructionAgeYears>=1&&this.destructionAgeYears<=30)&&$.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/destructionAge"),data:{destructionAge:this.destructionAgeYears,categoryID:this.formID,CSRFToken:this.CSRFToken},success:function(t){var o;if(2==+(null==t||null===(o=t.status)||void 0===o?void 0:o.code)&&+t.data==365*+e.destructionAgeYears){var n=(null==t?void 0:t.data)>0?+t.data:null;e.updateCategoriesProperty(e.formID,"destructionAge",n),e.showLastUpdate("form_properties_last_update")}},error:function(e){return console.log("destruction age post err",e)}})}},template:'<div id="edit-properties-panel">\n        <span class="form-id">{{formID}}\n            <span v-if="formParentID">(internal for {{formParentID}})</span>\n        </span>\n        <div id="edit-properties-description">\n            <label for="categoryName">Form name\n                <span :aria-label="\'max length 50 characters, \' + formNameCharsRemaining + \' remaining\'">({{formNameCharsRemaining}})</span>\n            </label>\n            <input id="categoryName" type="text" maxlength="50" v-model="categoryName" @change="updateName"/>\n            \n            <label for="categoryDescription">Form description\n                <span :aria-label="\'max length 255 characters, \' + formDescrCharsRemaining + \' remaining\'">({{formDescrCharsRemaining}})</span>\n            </label>\n            <textarea id="categoryDescription" maxlength="255" v-model="categoryDescription" rows="3" @change="updateDescription"></textarea>\n        </div>\n        <div v-if="!loading" id="edit-properties-other-properties">\n            <div style="display:flex; justify-content: space-between;">\n                <button type="button" id="form_properties_last_update" @click.prevent="openFormHistoryDialog(focusedFormRecord.categoryID)"\n                    style="display: none;">\n                </button>\n            </div>\n            <template v-if="!isSubForm">\n                <div class="panel-properties">\n                    <div id="workflow_info" v-if="!isStaple && workflowRecords.length > 0">\n                        <label for="workflowID">Workflow: \n                            <select id="workflowID" name="select-workflow" @change="updateWorkflow"\n                                title="select workflow"\n                                v-model.number="workflowID"\n                                style="width:280px;"\n                                :style="{color: workflowID === 0 ? \'#a00\' : \'black\'}"\n                                :disabled="isStaple">\n                                <option value="0" :selected="workflowID === 0">\n                                    No Workflow.  Users cannot submit requests\n                                </option>\n                                <template v-for="r in workflowRecords" :key="\'workflow_\' + r.workflowID">\n                                    <option v-if="parseInt(r.workflowID) > 0"\n                                        :value="r.workflowID"\n                                        :selected="workflowID === parseInt(r.workflowID)">\n                                        ID#{{r.workflowID}}: {{truncateText(decodeAndStripHTML(r.description),32)}}\n                                    </option>\n                                </template>\n                            </select>\n                        </label>\n                        <a v-if="+focusedFormRecord.workflowID > 0" id="view_workflow" class="btn-general" :href="\'./?a=workflow&workflowID=\'+ focusedFormRecord.workflowID" target="_blank">\n                            View Workflow\n                        </a>\n                    </div>\n                    <div v-if="!workflowsLoading && workflowRecords.length === 0" style="color: #a00; width: 100%; margin-bottom: 0.5rem;">A workflow must be set up first</div>\n\n                    <label for="availability" title="When hidden, users will not be able to select this form">Status: \n                        <select id="availability" title="Select Availability" v-model.number="visible" @change="updateAvailability">\n                            <option value="1" :selected="visible === 1">Available</option>\n                            <option value="0" :selected="visible === 0">Hidden</option>\n                            <option value="-1" :selected="visible === -1">Unpublished</option>\n                        </select>\n                    </label>\n                    <div v-if="focusedFormIsSensitive && isNeedToKnow" style="display:flex; color: #a00;">\n                        <div style="display:flex; align-items: center;"><b>Need to know: </b></div> &nbsp;\n                        <div style="display:flex; align-items: center;">Forced On because sensitive fields are present</div>\n                    </div>\n                    <label v-else for="needToKnow"\n                        title="When turned on, the people associated with the workflow are the only ones who have access to view the form. \nForced on if the form contains sensitive information.">Need to know: \n                        <select id="needToKnow" v-model.number="needToKnow" :style="{color: isNeedToKnow ? \'#a00\' : \'black\'}" @change="updateNeedToKnow">\n                            <option value="0" :selected="!isNeedToKnow">Off</option>\n                            <option value="1" style="color: #a00;" :selected="isNeedToKnow">On</option>\n                        </select>\n                    </label>\n                    <label for="formType">Form Type: \n                        <select id="formType" title="Change type of form" v-model="type" @change="updateType">\n                            <option value="" :selected="type === \'\'">Standard</option>\n                            <option value="parallel_processing" :selected="type === \'parallel_processing\'">Parallel Processing</option>\n                        </select>\n                    </label>\n                    <div v-if="false" style="display:flex; align-items: center; column-gap: 1rem;">\n                        <label for="destructionAgeYears" title="Resolved requests that have reached this expiration date will be destroyed" >Record Destruction Age\n                            <select id="destructionAgeYears" v-model="destructionAgeYears"\n                                title="resolved request destruction age in years" \n                                @change="updateDestructionAge">\n                                <option :value="null" :selected="destructionAgeYears===null">never</option>\n                                <option v-for="i in 30" :value="i">{{i}} year{{ i === 1 ? "" : "s"}}</option>\n                            </select>\n                        </label>\n                    </div>\n                </div>\n            </template>\n            <div v-else style="margin-top: auto;">This is an Internal Form</div>\n        </div>\n    </div>'};function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function O(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function C(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?O(Object(o),!0).forEach((function(t){P(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):O(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function P(e,t,o){return(t=function(e){var t=function(e){if("object"!=x(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=x(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==x(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const E={name:"form-editor-view",data:function(){return{dragLI_Prefix:"index_listing_",dragUL_Prefix:"drop_area_parent_",draggedElID:"",listTracker:{},previewMode:!1,sortOffset:128,updateKey:0,appIsLoadingForm:!1,focusedFormID:"",focusedFormTree:[],previewTree:[],focusedIndicatorID:null,hasCollaborators:!1,fileManagerTextFiles:[],ariaStatusFormDisplay:"",focusAfterFormUpdateSelector:null}},components:{LeafFormDialog:i.A,IndicatorEditingDialog:a,AdvancedOptionsDialog:l,NewFormDialog:s.A,HistoryDialog:r,StapleFormDialog:p,EditCollaboratorsDialog:m,ConfirmDeleteDialog:h,ConditionsEditorDialog:b,FormEditorMenu:_,FormQuestionDisplay:F,FormIndexListing:k,EditPropertiesPanel:T},inject:["APIroot","CSRFToken","getSiteSettings","setDefaultAjaxResponseMessage","appIsLoadingCategories","categories","showLastUpdate","openAdvancedOptionsDialog","openIndicatorEditingDialog","openNewFormDialog","openStapleFormsDialog","allStapledFormCatIDs","decodeAndStripHTML","truncateText","showFormDialog","dialogFormContent"],beforeRouteEnter:function(e,t,o){o((function(e){e.getSiteSettings(),e.setDefaultAjaxResponseMessage(),e.getFileManagerTextFiles(),!e.appIsLoadingCategories&&e.queryID&&e.getFormFromQueryParam()}))},mounted:function(){window.addEventListener("scroll",this.onScroll)},beforeUnmount:function(){window.removeEventListener("scroll",this.onScroll)},provide:function(){var e=this;return{listTracker:(0,n.EW)((function(){return e.listTracker})),previewMode:(0,n.EW)((function(){return e.previewMode})),focusedIndicatorID:(0,n.EW)((function(){return e.focusedIndicatorID})),fileManagerTextFiles:(0,n.EW)((function(){return e.fileManagerTextFiles})),appIsLoadingForm:(0,n.EW)((function(){return e.appIsLoadingForm})),queryID:(0,n.EW)((function(){return e.queryID})),focusedFormID:(0,n.EW)((function(){return e.focusedFormID})),focusedFormTree:(0,n.EW)((function(){return e.focusedFormTree})),previewTree:(0,n.EW)((function(){return e.previewTree})),focusedFormRecord:(0,n.EW)((function(){return e.focusedFormRecord})),focusedFormIsSensitive:(0,n.EW)((function(){return e.focusedFormIsSensitive})),noForm:(0,n.EW)((function(){return e.noForm})),mainFormID:(0,n.EW)((function(){return e.mainFormID})),getFormByCategoryID:this.getFormByCategoryID,editAdvancedOptions:this.editAdvancedOptions,newQuestion:this.newQuestion,editQuestion:this.editQuestion,clearListItem:this.clearListItem,addToListTracker:this.addToListTracker,setIndicatorFocus:this.setIndicatorFocus,startDrag:this.startDrag,endDrag:this.endDrag,handleOnDragCustomizations:this.handleOnDragCustomizations,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop,clickToMoveListItem:this.clickToMoveListItem,shortIndicatorNameStripped:this.shortIndicatorNameStripped,makePreviewKey:this.makePreviewKey}},computed:{queryID:function(){return this.$route.query.formID},internalID:function(){return this.$route.query.internalID||null},noForm:function(){return!this.appIsLoadingForm&&""===this.focusedFormID},mainFormID:function(){var e,t;return""===(null===(e=this.focusedFormRecord)||void 0===e?void 0:e.parentID)?this.focusedFormRecord.categoryID:(null===(t=this.focusedFormRecord)||void 0===t?void 0:t.parentID)||""},currentCategoryQuery:function(){return this.categories[this.queryID]||{}},focusedFormRecord:function(){return this.categories[this.focusedFormID]||{}},focusedFormIsSensitive:function(){var e=this,t=!1;return this.focusedFormTree.forEach((function(o){t||(t=e.checkSensitive(o))})),t},currentFormCollection:function(){var e,t=this,o=[];if((null===(e=Object.keys(this.currentCategoryQuery))||void 0===e?void 0:e.length)>0){var n,i,r,a=[];for(var l in this.categories)this.categories[l].parentID===this.currentCategoryQuery.categoryID&&a.push(C({},this.categories[l]));((null===(n=this.currentCategoryQuery)||void 0===n?void 0:n.stapledFormIDs)||[]).forEach((function(e){var n=[];for(var i in t.categories)t.categories[i].parentID===e&&n.push(C({},t.categories[i]));o.push(C(C({},t.categories[e]),{},{formContextType:"staple",internalForms:n}))}));var s=""!==this.currentCategoryQuery.parentID?"internal":(null===(i=this.allStapledFormCatIDs)||void 0===i?void 0:i[(null===(r=this.currentCategoryQuery)||void 0===r?void 0:r.categoryID)||""])>0?"staple":"main form";o.push(C(C({},this.currentCategoryQuery),{},{formContextType:s,internalForms:a}))}return o.sort((function(e,t){return e.sort-t.sort}))},formPreviewIDs:function(){var e=[];return this.currentFormCollection.forEach((function(t){e.push(t.categoryID)})),e.join()},usePreviewTree:function(){var e;return(null===(e=this.focusedFormRecord)||void 0===e||null===(e=e.stapledFormIDs)||void 0===e?void 0:e.length)>0&&this.previewMode&&this.focusedFormID===this.queryID},fullFormTree:function(){var e=this,t=this.usePreviewTree?this.previewTree:this.focusedFormTree;return t.forEach((function(t){null===t.child||Array.isArray(t.child)||(t.child=e.transformFormTreeChild(t.child))})),t},sortOrParentChanged:function(){return this.sortValuesToUpdate.length>0||this.parentIDsToUpdate.length>0},sortValuesToUpdate:function(){var e=[];for(var t in this.listTracker)this.listTracker[t].sort!==this.listTracker[t].listIndex-this.sortOffset&&e.push(C({indicatorID:parseInt(t)},this.listTracker[t]));return e},parentIDsToUpdate:function(){var e=[];for(var t in this.listTracker)""!==this.listTracker[t].newParentID&&this.listTracker[t].parentID!==this.listTracker[t].newParentID&&e.push(C({indicatorID:parseInt(t)},this.listTracker[t]));return e}},methods:{decodeHTMLEntities:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},backwardCompatNames:function(e){for(var t in e)e[t].name=this.decodeHTMLEntities(e[t].name),null!=e[t].child&&(e[t].child=this.backwardCompatNames(e[t].child));return e},transformFormTreeChild:function(e){var t=[];for(var o in e)null!==e[o].child&&(e[o].child=this.transformFormTreeChild(e[o].child)),t.push(e[o]);return t.sort((function(e,t){return e.sort-t.sort})),t},onScroll:function(){var e=document.getElementById("form_entry_and_preview"),t=document.getElementById("form_index_display");if(null!==e&&null!==t){var o=t.getBoundingClientRect().top,n=e.getBoundingClientRect().top,i=(t.style.top||"0").replace("px","");if(this.appIsLoadingForm||window.innerWidth<=600||0==+i&&o>0)t.style.top=0;else{var r=Math.round(-n-8);t.style.top=r<0?0:r+"px"}}},getFormFromQueryParam:function(){var e=this.queryID;if(void 0===this.categories[e])this.focusedFormID="",this.focusedFormTree=[];else{var t=this.categories[e].parentID;""===t?this.getFormByCategoryID(e,!0):this.$router.push({name:"category",query:{formID:t,internalID:e}})}},getFormByCategoryID:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.ariaStatusFormDisplay="",""===t?(this.focusedFormID="",this.focusedFormTree=[]):(this.appIsLoadingForm=o,this.setDefaultAjaxResponseMessage(),$.ajax({type:"GET",url:"".concat(this.APIroot,"form/_").concat(t,"?context=formEditor"),success:function(o){var n;o=e.backwardCompatNames(o);var i={formID:e.queryID},r=null;!0===e.appIsLoadingForm&&null!==e.internalID?r=e.internalID:""!==(null===(n=e.categories[t])||void 0===n?void 0:n.parentID)&&(r=t),null!==r&&(i=C(C({},i),{},{internalID:r})),e.$router.push({name:"category",query:i});var a=e.focusedFormID===t;a&&(e.updateKey+=1),e.focusedFormID=t||"",e.focusedFormTree=o||[],e.appIsLoadingForm=!1,setTimeout((function(){if(null!==e.internalID&&e.focusedFormID!==e.internalID){var t=document.getElementById("internal_form_"+e.internalID);null!==t&&t.dispatchEvent(new Event("click"))}if(a){var o=e.focusAfterFormUpdateSelector;if(null!==o){var n=document.querySelector(o),i="";switch(!0){case o.startsWith("#click_to_move"):var r,l=o.split("_"),s=null==l?void 0:l[3],c=null==l?void 0:l[4];if(s&&c&&(i="moved indicator ".concat(c," ").concat(s),!0===(null===(r=n)||void 0===r?void 0:r.disabled))){var d="up"===s?"down":"up";n=document.getElementById("click_to_move_".concat(d,"_").concat(c))}break;case o.startsWith("#edit_indicator"):i="edited indicator";break;case o.startsWith("#programmer"):i="edited programmer";break;case o.startsWith("ul#"):i="created new question"}e.ariaStatusFormDisplay=i,null===n||e.showFormDialog||(n.focus(),e.focusAfterFormUpdateSelector=null)}}else e.focusAfterFormUpdateSelector=null}))},error:function(e){return console.log(e)}}))},getPreviewTree:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""!==t&&""!==this.formPreviewIDs){this.appIsLoadingForm=!0,this.setDefaultAjaxResponseMessage();try{fetch("".concat(this.APIroot,"form/specified?categoryIDs=").concat(this.formPreviewIDs)).then((function(o){o.json().then((function(o){e.previewTree=o||[],e.previewTree=e.backwardCompatNames(e.previewTree),e.focusedFormID=t,e.appIsLoadingForm=!1,setTimeout((function(){var t=document.getElementById("indicator_toolbar_toggle");null!==t&&(t.focus(),setTimeout((function(){e.ariaStatusFormDisplay="Previewing form"})))}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))}catch(e){console.log(e)}}},getIndicatorByID:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(o,n){fetch("".concat(e.APIroot,"formEditor/indicator/").concat(t)).then((function(e){return e.json()})).then((function(e){return o(e[t])})).catch((function(e){return n(e)}))}))},getFileManagerTextFiles:function(){var e=this;try{fetch("".concat(this.APIroot,"system/files")).then((function(t){t.json().then((function(t){var o=t||[];e.fileManagerTextFiles=o.filter((function(e){return e.indexOf(".txt")>-1||e.indexOf(".csv")>-1}))})).catch((function(e){return console.log(e)}))}))}catch(e){console.log(e)}},editAdvancedOptions:function(){var e,t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.focusAfterFormUpdateSelector="#"+(null===(e=document)||void 0===e||null===(e=e.activeElement)||void 0===e?void 0:e.id)||0,this.getIndicatorByID(o).then((function(e){t.openAdvancedOptionsDialog(e)})).catch((function(e){return console.log("error getting indicator information",e)}))},newQuestion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null===e?"ul#base_drop_area_".concat(this.focusedFormID):"ul#".concat(this.dragUL_Prefix).concat(e);this.focusAfterFormUpdateSelector="".concat(t,' > li:last-child button[id^="edit_indicator"]'),this.openIndicatorEditingDialog(null,e,{}),this.focusedIndicatorID=null},editQuestion:function(){var e,t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.focusAfterFormUpdateSelector="#"+(null===(e=document)||void 0===e||null===(e=e.activeElement)||void 0===e?void 0:e.id)||0,this.getIndicatorByID(o).then((function(e){t.focusedIndicatorID=o;var n=(null==e?void 0:e.parentID)||null;t.openIndicatorEditingDialog(o,n,e)})).catch((function(e){return console.log("error getting indicator information",e)}))},checkSensitive:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(1===parseInt(e.is_sensitive))return!0;var t=!1;if(e.child)for(var o in e.child)if(!0===(t=this.checkSensitive(e.child[o])||!1))break;return t},setIndicatorFocus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.focusedIndicatorID!==e&&(this.focusedIndicatorID=e)},toggleToolbars:function(){this.ariaStatusFormDisplay="",this.focusedIndicatorID=null,this.previewMode=!this.previewMode,this.updateKey+=1,this.usePreviewTree?this.getPreviewTree(this.focusedFormID):(this.previewTree=[],this.ariaStatusFormDisplay=this.previewMode?"Previewing form":"Editing form")},clickToMoveListItem:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.previewMode&&o===this.focusedIndicatorID){var i,r;32===(null==t?void 0:t.keyCode)&&t.preventDefault(),this.ariaStatusFormDisplay="",this.focusAfterFormUpdateSelector="#"+(null==t||null===(i=t.target)||void 0===i?void 0:i.id)||0;var a=null==t||null===(r=t.currentTarget)||void 0===r?void 0:r.closest("ul"),l=document.getElementById("".concat(this.dragLI_Prefix).concat(o)),s=Array.from(document.querySelectorAll("#".concat(a.id," > li"))),c=s.filter((function(e){return e!==l})),d=this.listTracker[o],u=!0===n?-1:1;if(!0===n?d.listIndex>0:d.listIndex<s.length-1){var p=d.listIndex;c.splice(p+u,0,l),s.forEach((function(e){return a.removeChild(e)})),c.forEach((function(t,o){var n=parseInt(t.id.replace(e.dragLI_Prefix,""));a.appendChild(t),e.listTracker[n].listIndex=o}))}}},applySortAndParentID_Updates:function(){var e=this,t=[];if(this.sortValuesToUpdate.length>0){var o=[];this.sortValuesToUpdate.forEach((function(t){o.push({indicatorID:t.indicatorID,sort:t.listIndex-e.sortOffset})})),t.push($.ajax({type:"POST",url:"".concat(this.APIroot,"formEditor/sort/batch"),data:{sortData:o,CSRFToken:this.CSRFToken},success:function(){},error:function(e){return console.log("ind sort post err",e)}}))}var n=[];this.parentIDsToUpdate.forEach((function(t){n.push($.ajax({type:"POST",url:"".concat(e.APIroot,"formEditor/").concat(t.indicatorID,"/parentID"),data:{parentID:t.newParentID,CSRFToken:e.CSRFToken},success:function(){},error:function(e){return console.log("ind parentID post err",e)}}))}));var i=t.concat(n);Promise.all(i).then((function(t){t.length>0&&(e.getFormByCategoryID(e.focusedFormID),e.showLastUpdate("form_properties_last_update"))})).catch((function(e){return console.log("an error has occurred",e)}))},clearListItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.listTracker[e]&&delete this.listTracker[e]},addToListTracker:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e.indicatorID,i={sort:e.sort,parentID:t,listIndex:o,newParentID:""};this.listTracker[n]=i},updateListTracker:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=C({},this.listTracker[e]);n.listIndex=o,n.newParentID=t,this.listTracker[e]=n},removeDragDropClasses:function(){Array.from(document.querySelectorAll("#base_drop_area_".concat(this.focusedFormID,' li[id^="').concat(this.dragLI_Prefix,'"],\n                #base_drop_area_').concat(this.focusedFormID,' ul[id^="').concat(this.dragUL_Prefix,'"]'))).forEach((function(e){e.classList.remove("entered-empty-ul-drop-zone"),e.classList.remove("entered-parent-ul-drop-zone"),e.classList.remove("entered-parent-ul-drop-zone-last"),e.classList.remove("drop_preview_visible")}))},startDrag:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((null==e?void 0:e.offsetX)>25||(null==e?void 0:e.offsetY)>78)e.preventDefault();else if(!this.previewMode&&null!=e&&e.dataTransfer){e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",e.target.id);var t=document.getElementById("form_entry_and_preview"),o=+t.getBoundingClientRect().height.toFixed(0);t.style.minHeight=o+"px",e.target.style.height="80px",e.target.classList.add("is_being_dragged");var n=document.getElementById("drag_drop_default_img_replacement");if(null!==n){var i;e.dataTransfer.setDragImage(n,0,0);var r=null===(i=document.querySelector("#".concat(e.target.id," .name")))||void 0===i?void 0:i.textContent;r=this.shortIndicatorNameStripped(r),null!==e.target.querySelector("ul > li")&&(r+=" (includes sub-questions)"),this.$refs.drag_drop_custom_display.textContent=r,this.draggedElID=e.target.id}}},endDrag:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$refs.drag_drop_custom_display.style.left="-9999px",this.$refs.drag_drop_custom_display.style.top="-1000px",this.$refs.drag_drop_custom_display.textContent="",e.target.style.height="auto",e.target.classList.remove("is_being_dragged")},handleOnDragCustomizations:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=+(null==t?void 0:t.clientY);if(o<75||o>window.innerHeight-75){var n=window.scrollX,i=window.scrollY,r=o<75?-4:4;window.scrollTo(n,i+r)}var a=(null===(e=this.$refs.drag_drop_custom_display)||void 0===e?void 0:e.parentElement)||null;if(null!==a){var l=a.getBoundingClientRect();this.$refs.drag_drop_custom_display.style.left=+(null==t?void 0:t.clientX)-l.x+2+"px",this.$refs.drag_drop_custom_display.style.top=+(null==t?void 0:t.clientY)-l.y+2+"px"}},onDrop:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.currentTarget;if("UL"===o.nodeName&&null!=t&&t.dataTransfer&&"move"===t.dataTransfer.effectAllowed){t.preventDefault();var n=t.dataTransfer.getData("text"),i=document.getElementById(n),r=parseInt(n.replace(this.dragLI_Prefix,"")),a=(o.id||"").includes("base_drop_area")?null:parseInt(o.id.replace(this.dragUL_Prefix,"")),l=Array.from(document.querySelectorAll("#".concat(o.id," > li")));if(0===l.length)try{o.append(i),this.updateListTracker(r,a,0)}catch(e){console.log(e)}else{var s=o.getBoundingClientRect().top,c=l.find((function(e){return t.clientY-s<=e.offsetTop+e.offsetHeight/2}))||null;if(c!==i)try{o.insertBefore(i,c),Array.from(document.querySelectorAll("#".concat(o.id," > li"))).forEach((function(t,o){var n=parseInt(t.id.replace(e.dragLI_Prefix,""));e.updateListTracker(n,a,o)}))}catch(e){console.log(e)}}this.removeDragDropClasses()}},onDragLeave:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null!=t&&null!==(e=t.target)&&void 0!==e&&e.classList.contains("form-index-listing-ul")&&this.removeDragDropClasses()},onDragEnter:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.removeDragDropClasses(),null!=t&&t.dataTransfer&&"move"===t.dataTransfer.effectAllowed&&null!=t&&null!==(e=t.target)&&void 0!==e&&e.classList.contains("form-index-listing-ul")){var o,n=Array.from(t.target.querySelectorAll("#"+t.target.id+"> li")),i=t.target.getBoundingClientRect().top,r=document.getElementById(this.draggedElID),a=n.indexOf(r),l=n.find((function(e){return t.clientY-i<=e.offsetTop+e.offsetHeight/2}))||null,s=a>-1,c=this.draggedElID===(null==l?void 0:l.id),d=s&&(null===l&&n.length-1===a||null!==l&&(null==n||null===(o=n[n.indexOf(r)+1])||void 0===o?void 0:o.id)===(null==l?void 0:l.id));if(!c&&!d)if(0===n.length)t.target.classList.add("entered-empty-ul-drop-zone");else{var u=null;if(null!==l)u=l,l.classList.add("entered-parent-ul-drop-zone");else{var p=n[n.length-1];u=p,p.classList.add("entered-parent-ul-drop-zone-last")}setTimeout((function(){u.classList.add("drop_preview_visible")}),150)}}},shortFormNameStripped:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:21,o=this.categories[e]||"",n=this.decodeAndStripHTML((null==o?void 0:o.categoryName)||"Untitled");return this.truncateText(n,t).trim()},shortIndicatorNameStripped:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35,o=this.decodeAndStripHTML(e);return this.truncateText(o,t).trim()||"[ blank ]"},makePreviewKey:function(e){var t;return"".concat(e.format).concat((null==e||null===(t=e.options)||void 0===t?void 0:t.join())||"","_").concat((null==e?void 0:e.default)||"")}},watch:{appIsLoadingCategories:function(e,t){!0===t&&this.queryID&&this.getFormFromQueryParam()},queryID:function(){this.appIsLoadingCategories||this.getFormFromQueryParam()},sortOrParentChanged:function(e,t){!0!==e||this.previewMode||this.applySortAndParentID_Updates()},focusedFormID:function(e,t){window.scrollTo(0,0),e&&setTimeout((function(){var t=document.querySelector('button[id$="form_'.concat(e,'"]'));null!==t&&t.focus()}))}},template:'<FormEditorMenu />\n    <section id="formEditor_content">\n        <div v-if="appIsLoadingForm || appIsLoadingCategories" class="page_loading">\n            Loading... \n            <img src="../images/largespinner.gif" alt="" />\n        </div>\n        <div v-else-if="noForm">\n            The form you are looking for ({{ queryID }}) was not found.\n            <router-link :to="{ name: \'browser\' }" class="router-link" style="display: inline-block;">\n                Back to&nbsp;<b>Form Browser</b>\n            </router-link>\n        </div>\n\n        <template v-else>\n            \x3c!-- admin home link, browser link, page title --\x3e\n            <h2 id="page_breadcrumbs">\n                <a href="../admin" class="leaf-crumb-link" title="to Admin Home">Admin</a>\n                <i class="fas fa-caret-right leaf-crumb-caret"></i>\n                <router-link :to="{ name: \'browser\' }" class="leaf-crumb-link" title="to Form Browser">Form Browser</router-link>\n                <i class="fas fa-caret-right leaf-crumb-caret"></i>Form Editor\n            </h2>\n            \x3c!-- TOP INFO PANEL --\x3e\n            <edit-properties-panel :key="\'panel_\' + focusedFormID"></edit-properties-panel>\n\n            <div id="form_index_and_editing" :data-focus="focusedIndicatorID">\n                \x3c!-- NOTE: INDEX (main + stapled forms, internals) --\x3e\n                <div id="form_index_display">\n                    <div role="status" style="position:absolute;opacity:0" aria-live="assertive" :aria-label="ariaStatusFormDisplay"></div>\n                    <button type="button" id="indicator_toolbar_toggle" class="btn-general preview"\n                        @click.stop="toggleToolbars()">\n                        <span role="img" aria-hidden="true" alt="">{{ previewMode ? \'📃\' : \'🔎\' }}&nbsp;</span>\n                        {{previewMode ? \'Edit this Form\' : \'Preview this Form\'}}\n                    </button>\n                    <template v-if="!previewMode">\n                        <button type="button" class="btn-general"\n                            :id="\'addInternalUse_\' + mainFormID"\n                            @click="openNewFormDialog(mainFormID)">\n                            <span role="img" aria-hidden="true" alt="">➕&nbsp;</span>\n                            Add Internal-Use\n                        </button>\n                        \x3c!-- staple options if main form is not itself a staple --\x3e\n                        <button v-if="!allStapledFormCatIDs?.[mainFormID] > 0"\n                            type="button" class="btn-general"\n                            :id="\'addStaple_\' + mainFormID"\n                            @click="openStapleFormsDialog(mainFormID)">\n                            <span role="img" aria-hidden="true" alt="">📌&nbsp;</span>Staple other form\n                        </button>\n                    </template>\n                    \x3c!-- LAYOUTS (FORMS AND INTERNAL/STAPLE OPTIONS) --\x3e\n                    <ul v-if="!previewMode && currentFormCollection.length > 0" :id="\'layoutFormRecords_\' + queryID" :class="{preview: previewMode}">\n                        <template v-for="form in currentFormCollection" :key="\'form_layout_item_\' + form.categoryID">\n                            <li :class="{selected: form.categoryID === focusedFormID}">\n                                <button type="button" :id="\'main_form_\' + form.categoryID" :title="form.categoryID === focusedFormID ? \'selected form\' : \'\'"\n                                    @click="form.stapledFormIDs.length > 0 && previewMode && form.categoryID === queryID ?\n                                        getPreviewTree(form.categoryID) : getFormByCategoryID(form.categoryID)"\n                                    class="layout-listitem"\n                                    :aria-label="shortFormNameStripped(form.categoryID, 30) + (form.formContextType === \'staple\' ? \', stapled form\' : \', main form\')">\n                                    <span v-if="form.formContextType === \'staple\'" role="img" aria-hidden="true" alt="">📌&nbsp;</span>\n                                    <span v-if="form.formContextType === \'main form\'" role="img" aria-hidden="true" alt="">📂&nbsp;</span>\n                                    <span :style="{textDecoration: form.categoryID === focusedFormID ? \'none\' : \'underline\'}">\n                                        {{shortFormNameStripped(form.categoryID, 30)}}&nbsp;\n                                    </span>\n                                </button>\n                                \x3c!-- INTERNAL FORMS --\x3e\n                                <div v-if="form.internalForms.length > 0"\n                                    class="internal_forms">\n                                    <ul :id="\'internalFormRecords_\' + form.categoryID">\n                                        <li v-for="i in form.internalForms" :key="\'internal_\' + i.categoryID">\n                                            <button type="button" :id="\'internal_form_\' + i.categoryID" @click="getFormByCategoryID(i.categoryID)"\n                                                :class="{selected: i.categoryID === focusedFormID}">\n                                                <span role="img" aria="" alt="">📃&nbsp;</span>\n                                                {{shortFormNameStripped(i.categoryID, 26)}}\n                                            </button>\n                                        </li>\n                                    </ul>\n                                </div>\n                            </li>\n                        </template>\n                    </ul>\n\n                    \x3c!-- FORM MENU PREVIEW --\x3e\n                    <ul v-if="previewMode && fullFormTree.length > 0">\n                        <li v-for="(page, i) in fullFormTree" :key="\'preview_\' + page.indicatorID + \'_\' + page.categoryID"\n                            class="form_menu_preview">\n                            {{ i + 1}}.\n                            <span v-if="page.categoryID !== focusedFormID" role="img" aria-hidden="true" alt="">📌</span>\n                            {{ shortIndicatorNameStripped(page.description || page.name) }}\n                        </li>\n                    </ul>\n                </div>\n\n                \x3c!-- FORM EDITING AND ENTRY PREVIEW --\x3e\n                <div id="form_entry_and_preview">\n                    \x3c!-- visually / access hidden elements used for the drag/drop display --\x3e\n                    <div id="drag_drop_default_img_replacement" aria-hidden="true"></div>\n                    <div id="drag_drop_custom_display" ref="drag_drop_custom_display" aria-hidden="true"></div>\n\n                    <div class="printformblock" :data-update-key="updateKey">\n\n                        \x3c!-- FORM DISPLAY WITH DRAG-DROP ZONE --\x3e\n                        <ul v-if="focusedFormTree.length > 0"\n                            :id="\'base_drop_area_\' + focusedFormRecord.categoryID"\n                            :key="\'drop_zone_collection_\' + focusedFormRecord.categoryID + \'_\' + updateKey"\n                            class="form-index-listing-ul"\n                            data-effect-allowed="move"\n                            @drop.stop="onDrop($event)"\n                            @dragover.prevent\n                            @dragenter.prevent="onDragEnter"\n                            @dragleave="onDragLeave">\n\n                            <form-index-listing v-for="(formSection, i) in fullFormTree"\n                                :id="dragLI_Prefix + formSection.indicatorID"\n                                :categoryID="formSection.categoryID"\n                                :formPage=i\n                                :depth=0\n                                :indicatorID="formSection.indicatorID"\n                                :formNode="formSection"\n                                :index=i\n                                :currentListLength="fullFormTree.length"\n                                :parentID=null\n                                :key="\'index_list_item_\' + formSection.indicatorID"\n                                :draggable="!previewMode"\n                                @dragstart.stop="startDrag"\n                                @dragend.stop="endDrag"\n                                @drag.stop="handleOnDragCustomizations">\n                            </form-index-listing>\n                        </ul>\n                    </div>\n                    <div v-if="!previewMode" id="blank_section_preview">\n                        <button type="button" class="btn-general"\n                            @click="newQuestion(null)"\n                            aria-label="Add Section">\n                            + Add Section\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </template>\n\n        \x3c!-- DIALOGS --\x3e\n        <leaf-form-dialog v-if="showFormDialog">\n            <template #dialog-content-slot>\n                <component :is="dialogFormContent" @get-form="getFormByCategoryID"></component>\n            </template>\n        </leaf-form-dialog>\n    </section>'}}}]);